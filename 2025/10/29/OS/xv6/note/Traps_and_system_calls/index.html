<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>xv6 traps and system callls | Hexo</title><meta name="author" content="John Doe"><meta name="copyright" content="John Doe"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="traptrap有三种类型  system call exception interrupt  每次触发trap的时候我们都会从用户态陷入到内核态, 并且这个过程对于用户程序来说应该是没有感知的, 在执行完trap以后, 从内核态回到用户态. 所有的trap都只在内核中执行, 这样能保证对物理设备访问的隔离性, 也能在处理异常的时候可以做出像kill用户进程这样的内核才有权限执行的响应方式 完成一">
<meta property="og:type" content="article">
<meta property="og:title" content="xv6 traps and system callls">
<meta property="og:url" content="https://functional.top/2025/10/29/OS/xv6/note/Traps_and_system_calls/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="traptrap有三种类型  system call exception interrupt  每次触发trap的时候我们都会从用户态陷入到内核态, 并且这个过程对于用户程序来说应该是没有感知的, 在执行完trap以后, 从内核态回到用户态. 所有的trap都只在内核中执行, 这样能保证对物理设备访问的隔离性, 也能在处理异常的时候可以做出像kill用户进程这样的内核才有权限执行的响应方式 完成一">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://functional.top/img/butterfly-icon.png">
<meta property="article:published_time" content="2025-10-29T00:00:00.000Z">
<meta property="article:modified_time" content="2026-02-08T11:04:02.565Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="Operating-System">
<meta property="article:tag" content="xv6">
<meta property="article:tag" content="syscall">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://functional.top/img/butterfly-icon.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "xv6 traps and system callls",
  "url": "https://functional.top/2025/10/29/OS/xv6/note/Traps_and_system_calls/",
  "image": "https://functional.top/img/butterfly-icon.png",
  "datePublished": "2025-10-29T00:00:00.000Z",
  "dateModified": "2026-02-08T11:04:02.565Z",
  "author": [
    {
      "@type": "Person",
      "name": "John Doe",
      "url": "https://functional.top"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://functional.top/2025/10/29/OS/xv6/note/Traps_and_system_calls/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'xv6 traps and system callls',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Hexo</span></a><a class="nav-page-title" href="/"><span class="site-name">xv6 traps and system callls</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"></div></nav><div id="post-info"><h1 class="post-title">xv6 traps and system callls</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2025-10-29T00:00:00.000Z" title="Created 2025-10-29 00:00:00">2025-10-29</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2026-02-08T11:04:02.565Z" title="Updated 2026-02-08 11:04:02">2026-02-08</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="trap"><a href="#trap" class="headerlink" title="trap"></a>trap</h1><p>trap有三种类型</p>
<ul>
<li>system call</li>
<li>exception</li>
<li>interrupt</li>
</ul>
<p>每次触发trap的时候我们都会从用户态陷入到内核态, 并且这个过程对于用户程序来说应该是没有感知的, 在执行完trap以后, 从内核态回到用户态.</p>
<p>所有的trap都只在内核中执行, 这样能保证对物理设备访问的隔离性, 也能在处理异常的时候可以做出像kill用户进程这样的内核才有权限执行的响应方式</p>
<p>完成一个trap需要四步</p>
<ol>
<li>硬件CPU上的动作</li>
<li>准备好的汇编代码, 用于进入到内核中对印的trap处理c函数上</li>
<li>处理这个trap的c函数</li>
<li>内核运行代码的内核进程</li>
</ol>
<h2 id="RISC-V寄存器"><a href="#RISC-V寄存器" class="headerlink" title="RISC-V寄存器"></a>RISC-V寄存器</h2><h3 id="指令"><a href="#指令" class="headerlink" title="指令"></a>指令</h3><ul>
<li>用于系统控制的特殊的寄存器, 不能随便地读写, 需要特殊的指令才能读写<ul>
<li><code>csrr</code>: CSR寄存器 read</li>
<li><code>csrw</code>: CSR寄存器 write</li>
</ul>
</li>
</ul>
<h3 id="寄存器"><a href="#寄存器" class="headerlink" title="寄存器"></a>寄存器</h3><ul>
<li>系统控制寄存器<ul>
<li><strong>sstatus: Supervisor Status Register</strong>监督者状态<ul>
<li>SPP: (bit 8, 1L&lt;&lt; 8) 记录异常发生前的CPU的特权级别, 1 &#x3D; 来自Supervisor, 0 &#x3D; 来自User</li>
<li>SIE: (bit 1, 1L&lt;&lt;1) Supervisor 中断使能 (0&#x3D;关闭, 1&#x3D;开启)</li>
<li>SPIE: (bit 5, 1L&lt;&lt;5) 陷阱前的中断使能状态</li>
</ul>
</li>
<li><strong>stvec: Supervisor Trap Vector</strong> 监督者陷阱向量<ul>
<li>指向发生trap的时候, CPU接下来要跳转到函数的地址</li>
</ul>
</li>
<li><strong>sepc: Supervisor Exception Program Counter</strong> 监督者异常pc<ul>
<li>保存发生trap的时候的指令地址, 以便异常处理完成以后能够返回</li>
</ul>
</li>
<li><strong>scause: Supervisor Cause Register</strong> 监督者原因<ul>
<li>记录陷入trap的原因<ul>
<li>8: 系统调用(ecall from U-mode)</li>
<li>13: Load page fault (读页面错误)</li>
<li>15: Store page fault (写页面错误)</li>
</ul>
</li>
</ul>
</li>
<li><strong>stval: Supervisor Trap Value</strong> 监督者陷阱值<ul>
<li>用于提供额外的信息, 对于页面错误会导致错误的虚拟地址, 对于非法指令, 会提供指令本身</li>
</ul>
</li>
<li><strong>satp: Supervisor Address Translation and Protection</strong> 监督者地址转换和保护<ul>
<li>控制页表的地址, 用于虚拟地址到物理地址的转换, 准备用户进程的页表地址, 用于返回用户态</li>
<li>访问函数: <code>#define MAKE_SATP(pagetable) (SATP_SV39 | (((uint64)pagetable) &gt;&gt; 12))</code></li>
<li>使用:  <code>uint64 satp = MAKE_SATP(p-&gt;pagetable)</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="xv6中进入到一个trap的过程讲解"><a href="#xv6中进入到一个trap的过程讲解" class="headerlink" title="xv6中进入到一个trap的过程讲解"></a>xv6中进入到一个trap的过程讲解</h1><h2 id="用户态陷入trap的处理函数"><a href="#用户态陷入trap的处理函数" class="headerlink" title="用户态陷入trap的处理函数"></a>用户态陷入trap的处理函数</h2><blockquote>
<p>kernel&#x2F;trap.c: usertra</p>
</blockquote>
<ul>
<li>校验此刻CPU是不是U-Mode</li>
<li>将kernelvec函数的地址写入到stvec, 接下来执行kernelvec代码(在下一个小部分)</li>
<li>保存用户进程的pc(从sepc读取)</li>
<li>处理不同的异常情况 (读取scause的值)<ul>
<li>8 -&gt; 来自系统调用: <ul>
<li>将sepc的值 +&#x3D; 4, 指向下一条指令, 从而在返回的时候是返回到出现trap的指令的下一条指令</li>
<li>Supervisor Interrupt Enable, 将sstatus的bit 1设置为1, 开启中断, 允许系统在处理系统调用时响应其他的中断(比如timer系统终中断)</li>
<li>执行syscall()函数, 调用对应的syscall函数</li>
</ul>
</li>
<li>13 &#x2F; 15 -&gt;</li>
</ul>
</li>
<li>如果这是个timer中断, 让出cpu</li>
<li>prepare_return()</li>
<li>切换到用户页表</li>
</ul>
<blockquote>
<p>kernel&#x2F;kernelvec.S</p>
</blockquote>
<ul>
<li>声明入口点</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.globl kerneltrap  # 将kerneltrap声明为全局的符号</span><br><span class="line">.globl kernelvec  # 同样申请成全局符号以供外部调用</span><br><span class="line">.align 4  # 将代码对齐到16字节边界, 提高性能</span><br><span class="line">kernelvec:  # kernelvec入口标签, 在usertrap的第二步就会进入到这个入口中执行接下来的汇编代码</span><br></pre></td></tr></table></figure>

<ul>
<li>向下增长栈, 为保存通用寄存器留出空间</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># make room to save registers.</span><br><span class="line">addi sp, sp, -256  # 栈指针向下移动256字节, 用于保存寄存器(RISC-V有32个通用寄存器=32*8 = 256字节)</span><br></pre></td></tr></table></figure>

<ul>
<li>保存用户态的寄存器</li>
</ul>
<blockquote>
<p>RISC-V调用约定中, 寄存器分成两类</p>
<ol>
<li>caller-saved registers: 调用函数前, 调用者必须保存这些寄存器</li>
<li>callee-saved registers: 被调用函数必须保存和恢复这些寄存器<br>这里我们只保存了caller-save register的原因是C函数会遵循RISC-V的约定, 保存callee-save register, 所以我们只用保存另一部分</li>
</ol>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># save caller-saved registers.</span><br><span class="line">sd ra, 0(sp)  # return address</span><br><span class="line"># sd sp, 8(sp)</span><br><span class="line">sd gp, 16(sp)  # global pointer</span><br><span class="line">sd tp, 24(sp)  # thread pointer</span><br><span class="line">sd t0, 32(sp)</span><br><span class="line">sd t1, 40(sp)</span><br><span class="line">sd t2, 48(sp)</span><br><span class="line">sd a0, 72(sp)</span><br><span class="line">sd a1, 80(sp)</span><br><span class="line">sd a2, 88(sp)</span><br><span class="line">sd a3, 96(sp)</span><br><span class="line">sd a4, 104(sp)</span><br><span class="line">sd a5, 112(sp)</span><br><span class="line">sd a6, 120(sp)</span><br><span class="line">sd a7, 128(sp)</span><br><span class="line">sd t3, 216(sp)</span><br><span class="line">sd t4, 224(sp)</span><br><span class="line">sd t5, 232(sp)</span><br><span class="line">sd t6, 240(sp)</span><br></pre></td></tr></table></figure>

<ul>
<li>调用kerneltrap C函数</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># call the C trap handler in trap.c</span></span><br><span class="line">call kerneltrap</span><br></pre></td></tr></table></figure>

<ul>
<li>恢复caller-saved寄存器</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># restore registers.</span><br><span class="line">ld ra, 0(sp)</span><br><span class="line"># ld sp, 8(sp)</span><br><span class="line">ld gp, 16(sp)</span><br><span class="line"># not tp (contains hartid), in case we moved CPUs</span><br><span class="line">ld t0, 32(sp)</span><br><span class="line">ld t1, 40(sp)</span><br><span class="line">ld t2, 48(sp)</span><br><span class="line">ld a0, 72(sp)</span><br><span class="line">ld a1, 80(sp)</span><br><span class="line">ld a2, 88(sp)</span><br><span class="line">ld a3, 96(sp)</span><br><span class="line">ld a4, 104(sp)</span><br><span class="line">ld a5, 112(sp)</span><br><span class="line">ld a6, 120(sp)</span><br><span class="line">ld a7, 128(sp)</span><br><span class="line">ld t3, 216(sp)</span><br><span class="line">ld t4, 224(sp)</span><br><span class="line">ld t5, 232(sp)</span><br><span class="line">ld t6, 240(sp)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">addi sp, sp, 256 # 将栈指针移回256字节前</span><br><span class="line"></span><br><span class="line"># return to whatever we were doing in the kernel.</span><br><span class="line">sret</span><br></pre></td></tr></table></figure>

<blockquote>
<p>sret指令: 行为</p>
<ol>
<li>将PC设置成sepc的值 (保存的是发生trap的时候的pc)</li>
<li>将特权级别恢复成sstatus.SPP中保存的值</li>
<li>将中断使能恢复成sstatus.SPIE中保存的值</li>
<li>继续执行被中断的代码</li>
</ol>
</blockquote>
<h2 id="trap-c-kerneltrap函数"><a href="#trap-c-kerneltrap函数" class="headerlink" title="trap.c&#x2F;kerneltrap函数"></a>trap.c&#x2F;kerneltrap函数</h2><h2 id="用户态trap处理函数的返回准备函数"><a href="#用户态trap处理函数的返回准备函数" class="headerlink" title="用户态trap处理函数的返回准备函数"></a>用户态trap处理函数的返回准备函数</h2><blockquote>
<p>kernel&#x2F;trap.c: prepare_return</p>
</blockquote>
<ul>
<li>intr_off(): 关闭中断</li>
</ul>
<h2 id="小结-trap的调用链全过程"><a href="#小结-trap的调用链全过程" class="headerlink" title="小结: trap的调用链全过程"></a>小结: trap的调用链全过程</h2><h2 id="为什么同时要有kerneltrap和usertrap"><a href="#为什么同时要有kerneltrap和usertrap" class="headerlink" title="为什么同时要有kerneltrap和usertrap"></a>为什么同时要有kerneltrap和usertrap</h2><p>关键点就在于我们同时有在kernel mode中和user mode中处理trap的需求, 而这两个mode执行环境存在不同</p>
<ul>
<li>页表不同<ul>
<li>最后要使用的都是内核页表<ul>
<li>kernel mode -&gt; 不用切换页表</li>
<li>user mode -&gt; 需要将页表切换成内核页表</li>
</ul>
</li>
</ul>
</li>
<li>栈不同<ul>
<li>需要使用内核栈<ul>
<li>kernel mode -&gt; 已经使用了内核栈</li>
<li>user mode -&gt; 需要切换到内核栈</li>
</ul>
</li>
</ul>
</li>
<li>保存的上下文不同<ul>
<li>kernel mode -&gt; 只需要保存几个关键寄存器 (如pc等), 其他的寄存器由调用约定保护</li>
<li>user mode -&gt; 需要保存完整的user mode的寄存器到 trapframe</li>
</ul>
</li>
<li>返回方式不同<ul>
<li>user mode -&gt; 需要切换页表和特区级别</li>
<li>kernel mode -&gt; 直接正常返回即可</li>
</ul>
</li>
</ul>
<blockquote>
</blockquote>
<p>trap的类型中的interrupt和exception是我们在执行内核代码的时候也会随时发生的事情(尤其是interrupt, 如时钟中断和设备中断)</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://functional.top">John Doe</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://functional.top/2025/10/29/OS/xv6/note/Traps_and_system_calls/">https://functional.top/2025/10/29/OS/xv6/note/Traps_and_system_calls/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Operating-System/">Operating-System</a><a class="post-meta__tags" href="/tags/xv6/">xv6</a><a class="post-meta__tags" href="/tags/syscall/">syscall</a></div><div class="post-share"><div class="social-share" data-image="/img/butterfly-icon.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related full-width" href="/2025/10/30/How/How_to_Learn_New_Project/" title="[How] 如何去了解和学习一个项目"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">[How] 如何去了解和学习一个项目</div></div><div class="info-2"><div class="info-item-1">如何了解一个项目如果我们要最快上手一个项目, 我们该从哪些地方入手, 如何渐进式地掌控这个项目, 这些问题会是无论是工作还是学习的的过程中都不得不面临的问题. 该篇文章对这个问题进行一些方法论上的总结. 了解项目的可选途径 源码 + AI IDE : 这个是最重要的资料, 可能在过去没有AI IDE的时候, 一本合适的入门书会是我更推荐的第一选择, 但是有了AI IDE以后, 源码阅读的解释性由AI补全, 配合直接阅读源码这个第一手资料带来的准确性, AI辅助阅读源码能在易读性和准确性上都有非常好的表现, 不过对于AI使用者有一定的要求, 能够问出合适而准确的问题, 也会在后续小节尤其说明应该问什么. 官方文档: TODO 书籍: TODO 博客: TODO  如何使用源码 + AI IDE快速了解一个项目 通过AI为自己建立需求: 并不是所有时候都是带着很明确的需求打开的这个项目, 这种时候去了解一个项目很容易漫无目的和失焦. 所以第一件事就是让AI为自己建立需求, 可选的路径有 让AI为自己生成一系列渐进的问题, 并给出探索的方式 你是这个组件的大师, 我的公司要使用这个组件...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2026/02/08/OS/xv6/xv6_Overview/" title="xv6 Overview"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-02-08</div><div class="info-item-2">xv6 Overview</div></div><div class="info-2"><div class="info-item-1">Chapter-1-Overview操作系统的目的 The job of an operating system is to share a computer among multiple programs and to provide a more useful set of services than the hardware alone supports. An operating system manages and abstracts the low-level hardware, so that, for example, a word processor need not concern itself with which type of disk hardware is being used. An operating system shares the hardware among multiple programs so that they run (or appear to run) at the same time. Finally, operating ...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/butterfly-icon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">John Doe</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">26</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">16</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#trap"><span class="toc-number">1.</span> <span class="toc-text">trap</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#RISC-V%E5%AF%84%E5%AD%98%E5%99%A8"><span class="toc-number">1.1.</span> <span class="toc-text">RISC-V寄存器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%87%E4%BB%A4"><span class="toc-number">1.1.1.</span> <span class="toc-text">指令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%84%E5%AD%98%E5%99%A8"><span class="toc-number">1.1.2.</span> <span class="toc-text">寄存器</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#xv6%E4%B8%AD%E8%BF%9B%E5%85%A5%E5%88%B0%E4%B8%80%E4%B8%AAtrap%E7%9A%84%E8%BF%87%E7%A8%8B%E8%AE%B2%E8%A7%A3"><span class="toc-number">2.</span> <span class="toc-text">xv6中进入到一个trap的过程讲解</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E6%80%81%E9%99%B7%E5%85%A5trap%E7%9A%84%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0"><span class="toc-number">2.1.</span> <span class="toc-text">用户态陷入trap的处理函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#trap-c-kerneltrap%E5%87%BD%E6%95%B0"><span class="toc-number">2.2.</span> <span class="toc-text">trap.c&#x2F;kerneltrap函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E6%80%81trap%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0%E7%9A%84%E8%BF%94%E5%9B%9E%E5%87%86%E5%A4%87%E5%87%BD%E6%95%B0"><span class="toc-number">2.3.</span> <span class="toc-text">用户态trap处理函数的返回准备函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93-trap%E7%9A%84%E8%B0%83%E7%94%A8%E9%93%BE%E5%85%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">2.4.</span> <span class="toc-text">小结: trap的调用链全过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E5%90%8C%E6%97%B6%E8%A6%81%E6%9C%89kerneltrap%E5%92%8Cusertrap"><span class="toc-number">2.5.</span> <span class="toc-text">为什么同时要有kerneltrap和usertrap</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/02/08/Git%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" title="Untitled">Untitled</a><time datetime="2026-02-08T11:04:02.565Z" title="Created 2026-02-08 11:04:02">2026-02-08</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/02/08/Big-Data/%E5%A4%A7%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E6%80%BB%E8%A7%88/" title="大数据结构总览">大数据结构总览</a><time datetime="2026-02-08T11:04:02.565Z" title="Created 2026-02-08 11:04:02">2026-02-08</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/02/08/How/How_to_Code/" title="Untitled">Untitled</a><time datetime="2026-02-08T11:04:02.565Z" title="Created 2026-02-08 11:04:02">2026-02-08</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/02/08/How/How_to_Learn_a_Language/" title="如何学习一门语言(以scala为例)">如何学习一门语言(以scala为例)</a><time datetime="2026-02-08T11:04:02.565Z" title="Created 2026-02-08 11:04:02">2026-02-08</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/02/08/Language/Scala%20Basic/" title="Scala基础语法">Scala基础语法</a><time datetime="2026-02-08T11:04:02.565Z" title="Created 2026-02-08 11:04:02">2026-02-08</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 - 2026 By John Doe</span><span class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.0</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>