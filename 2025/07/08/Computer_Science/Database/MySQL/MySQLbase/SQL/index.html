<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>窄门 | 窄门</title><meta name="author" content="Fun"><meta name="copyright" content="Fun"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="1. 数据库概述数据库相关概念DB: 数据库 DBMS: 数据库管理系统 (Database Management System) SQL: 结构化查询语言 (Structured Query Language) 关系型数据库设计规则 E - R (entity - relationship, 实体-联系) 模型中有三个主要概念是: 实体集, 属性, 联系集  表的关联关系 一对一关联  一般用于">
<meta property="og:type" content="article">
<meta property="og:title" content="窄门">
<meta property="og:url" content="https://fang-tech.github.io/2025/07/08/Computer_Science/Database/MySQL/MySQLbase/SQL/index.html">
<meta property="og:site_name" content="窄门">
<meta property="og:description" content="1. 数据库概述数据库相关概念DB: 数据库 DBMS: 数据库管理系统 (Database Management System) SQL: 结构化查询语言 (Structured Query Language) 关系型数据库设计规则 E - R (entity - relationship, 实体-联系) 模型中有三个主要概念是: 实体集, 属性, 联系集  表的关联关系 一对一关联  一般用于">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://fang-tech.github.io/img/butterfly-icon.png">
<meta property="article:published_time" content="2025-07-08T15:02:57.457Z">
<meta property="article:modified_time" content="2025-04-17T07:26:53.195Z">
<meta property="article:author" content="Fun">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://fang-tech.github.io/img/butterfly-icon.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "",
  "url": "https://fang-tech.github.io/2025/07/08/Computer_Science/Database/MySQL/MySQLbase/SQL/",
  "image": "https://fang-tech.github.io/img/butterfly-icon.png",
  "datePublished": "2025-07-08T15:02:57.457Z",
  "dateModified": "2025-04-17T07:26:53.195Z",
  "author": [
    {
      "@type": "Person",
      "name": "Fun",
      "url": "https://fang-tech.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://fang-tech.github.io/2025/07/08/Computer_Science/Database/MySQL/MySQLbase/SQL/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '窄门',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">窄门</span></a><a class="nav-page-title" href="/"><span class="site-name">窄门</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"></div></nav><div id="post-info"><h1 class="post-title">无标题</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-07-08T15:02:57.457Z" title="发表于 2025-07-08 23:02:57">2025-07-08</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-04-17T07:26:53.195Z" title="更新于 2025-04-17 15:26:53">2025-04-17</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="1-数据库概述"><a href="#1-数据库概述" class="headerlink" title="1. 数据库概述"></a>1. 数据库概述</h1><h2 id="数据库相关概念"><a href="#数据库相关概念" class="headerlink" title="数据库相关概念"></a>数据库相关概念</h2><p><strong>DB: 数据库</strong></p>
<p><strong>DBMS: 数据库管理系统 (Database Management System)</strong></p>
<p><strong>SQL: 结构化查询语言 (Structured Query Language)</strong></p>
<h2 id="关系型数据库设计规则"><a href="#关系型数据库设计规则" class="headerlink" title="关系型数据库设计规则"></a>关系型数据库设计规则</h2><ul>
<li>E - R (entity - relationship, 实体-联系) 模型中有三个主要概念是: <code>实体集</code>, <code>属性</code>, <code>联系集</code></li>
</ul>
<h3 id="表的关联关系"><a href="#表的关联关系" class="headerlink" title="表的关联关系"></a>表的关联关系</h3><ul>
<li><p>一对一关联</p>
<ul>
<li>一般用于将一张表拆成两张表, 一张存储常用的, 一张存储不常用的</li>
</ul>
</li>
<li><p>一对多关联</p>
</li>
<li><p>多对一关联</p>
</li>
<li><p>自我引用</p>
</li>
</ul>
<h1 id="2-MySQL环境搭建"><a href="#2-MySQL环境搭建" class="headerlink" title="2. MySQL环境搭建"></a>2. MySQL环境搭建</h1><h2 id="启动和关闭服务"><a href="#启动和关闭服务" class="headerlink" title="启动和关闭服务"></a>启动和关闭服务</h2><ul>
<li>使用命令行工具</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动SQL服务</span></span><br><span class="line">net start MySQL服务名(MySQL80)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭SQL服务</span></span><br><span class="line">net stop MySQL服务名(MySQL80)</span><br></pre></td></tr></table></figure>

<h2 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -h 主机名(localhost) -P 3306 -u root -p密码</span><br></pre></td></tr></table></figure>

<blockquote>
<p>client和server在同一台机器上的时候, host其实就是127.0.0.1或者localhost, 所以-hlocalhost可以不写, 同样的, 如果端口号没有做修改, -P 3006也可以不写</p>
</blockquote>
<h2 id="原来就有的库"><a href="#原来就有的库" class="headerlink" title="原来就有的库"></a>原来就有的库</h2><ul>
<li>information_schema<ul>
<li>是MySQL自带的数据库, 主要保存MySQL数据库服务器的系统信息, 比如数据库的名称, 数据库表的名称, 字段名称, 存取权限, 数据文件所在的文件夹和系统使用的文件夹等</li>
</ul>
</li>
<li>performance_schema<ul>
<li>是MySQL系统自带的数据库, 可以用来监控MySQL的各类性能指标</li>
</ul>
</li>
<li>sys<ul>
<li>主要作用是以一种更容易被理解的形式展示MySQL数据库服务器的各类性能指标, 帮助系统管理员和数据库管理人员监控MySQL的技术性能</li>
</ul>
</li>
<li>mysql<ul>
<li>数保存了MySQL数据库服务器运行时需要的系统信息, 比如数据文件夹, 当前使用的字符集, 约束检查信息等</li>
</ul>
</li>
</ul>
<h2 id="数据库的简单使用"><a href="#数据库的简单使用" class="headerlink" title="数据库的简单使用"></a>数据库的简单使用</h2><ol>
<li>创建自己的数据库</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> database 数据库的名称;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>该名称不能和存在的数据库重名</p>
</blockquote>
<ol start="2">
<li>查看所有的数据库</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> databases;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>数据库的名称是不区分大小写的</p>
</blockquote>
<ol start="3">
<li>使用数据库</li>
</ol>
 <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use 数据库名;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>输入同样是不区分大小写的</p>
</blockquote>
<ol start="4">
<li>查看某个库的所有表格</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> tables; #  use 到某个数据库中</span><br><span class="line"></span><br><span class="line"><span class="keyword">show</span> tables <span class="keyword">from</span> 数据库名称;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>创建新的表格</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> <span class="operator">&lt;</span><span class="keyword">table</span><span class="operator">-</span>name<span class="operator">&gt;</span>(</span><br><span class="line">	name type,</span><br><span class="line">    name type</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>最后的变量是不能加上” , “, 加上后会报错</p>
</blockquote>
<ol start="6">
<li>查看一个表的数据</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="operator">&lt;</span><span class="keyword">table</span><span class="operator">-</span>name<span class="operator">&gt;</span>;</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>添加一条记录</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert into</span> student <span class="keyword">value</span>(<span class="number">1</span>, <span class="string">&#x27;张三&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> student <span class="keyword">value</span>(<span class="number">2</span>, <span class="string">&#x27;李四&#x27;</span>);</span><br></pre></td></tr></table></figure>

<ol start="8">
<li>查看表的创建信息</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">create table</span> <span class="operator">&lt;</span><span class="keyword">table</span><span class="operator">-</span>name<span class="operator">&gt;</span>\G;</span><br><span class="line"></span><br><span class="line">#	查看student表的详细创建信息</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">create table</span> student\G;</span><br></pre></td></tr></table></figure>

<ol start="9">
<li>删除表格</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> <span class="operator">&lt;</span><span class="keyword">table</span><span class="operator">-</span>name<span class="operator">&gt;</span>;</span><br></pre></td></tr></table></figure>

<ol start="10">
<li>删除数据库</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> database <span class="operator">&lt;</span>database<span class="operator">-</span>name<span class="operator">&gt;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="编码问题的解决"><a href="#编码问题的解决" class="headerlink" title="编码问题的解决"></a>编码问题的解决</h2><ol>
<li>查看编码命令</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variable <span class="keyword">like</span> <span class="string">&#x27;character_%&#x27;</span>;</span><br><span class="line"><span class="keyword">show</span> variable <span class="keyword">like</span> <span class="string">&#x27;collation_%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>修改mysql的数据目录下的my.ini配置文件</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[mysql] #大概在<span class="number">63</span>行左右，在其下添加 ... </span><br><span class="line"><span class="keyword">default</span><span class="operator">-</span><span class="type">character</span><span class="operator">-</span><span class="keyword">set</span><span class="operator">=</span>utf8 #默认字符集 </span><br><span class="line">[mysqld] # 大概在<span class="number">76</span>行左右，在其下添加 ... <span class="type">character</span><span class="operator">-</span><span class="keyword">set</span><span class="operator">-</span>server<span class="operator">=</span>utf8</span><br><span class="line"><span class="keyword">collation</span><span class="operator">-</span>server<span class="operator">=</span>utf8_general_ci</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>重启服务</li>
</ol>
<blockquote>
<p>修改失败</p>
<p>在8.0版本之前, 默认字符集为latin1, utf8指向utf8mb3. 从8.0开始, 数据库的默认编码为utf8mb4</p>
</blockquote>
<h1 id="3-基础的SELECT语句"><a href="#3-基础的SELECT语句" class="headerlink" title="3. 基础的SELECT语句"></a>3. 基础的SELECT语句</h1><h3 id="SQL分类"><a href="#SQL分类" class="headerlink" title="SQL分类"></a>SQL分类</h3><p>SQL语言在功能上分为三大类</p>
<ul>
<li>DDL ( Data Definnition Languages - 数据定义语言) , 这些语言定义了不同的数据库, 表, 视图, 索引等数据库对象, 还可以用来创建, 删除和修改数据库和数据表的结构<ul>
<li>主要语句有 <code>CREATE</code>, <code>DROP</code>, <code>ALTER</code></li>
</ul>
</li>
<li>DML ( Data Manipulation Languages - 数据操作语言 ) , 用于添加, 删除, 更新和查询数据库记录, 并检查数据完整性<ul>
<li>主要语句关键词有<code>INSERT</code>, <code>DELETE</code>, <code>UPDATE</code>, <code>SELECT</code></li>
<li>SELECT是SQL语言的基础, 最为重要</li>
</ul>
</li>
<li>DCL ( Data Control Languages - 数据控制语言 ) , 用于定义数据库, 表, 字段, 用户的访问权限和安全级别<ul>
<li>主要的语句关键字包括<code>GRANT</code>, <code>REVOKE</code>, <code>COMMIT</code>, <code>ROLLBACK</code>, <code>SAVEPOINT</code>等.</li>
</ul>
</li>
</ul>
<h3 id="SQL语言的规则和规范"><a href="#SQL语言的规则和规范" class="headerlink" title="SQL语言的规则和规范"></a>SQL语言的规则和规范</h3><ul>
<li><p>列的别名, 尽量使用双引号 “” , 而且不建议省略as</p>
</li>
<li><p>关键字不能被缩写和分行</p>
</li>
</ul>
<h4 id="大小规范"><a href="#大小规范" class="headerlink" title="大小规范"></a>大小规范</h4><ul>
<li><p>MySQL 在Windows 环境是大小写不敏感的</p>
</li>
<li><p>MySQL 在Linux环境是大小写敏感的</p>
<ul>
<li>数据库名, 表名, 表的别名, 变量名是严格区分大小写的</li>
<li>关键字, 函数名, 列名(字段名), 列的别名是忽略大小写的</li>
</ul>
</li>
<li><p>推荐的统一书写规范</p>
<ul>
<li>数据库名, 表名, 表的别名, 字段名, 字段别名等都小写</li>
<li>SQL关键字, 函数名, 绑定变量等都大小写</li>
</ul>
</li>
</ul>
<h4 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#注释文字 (MySQL特有的方式) </span><br><span class="line"><span class="comment">-- 注释文字 (--后必须有一个空格) </span></span><br><span class="line"><span class="comment">/* 多行注释 */</span></span><br></pre></td></tr></table></figure>

<h4 id="命名规则"><a href="#命名规则" class="headerlink" title="命名规则"></a>命名规则</h4><ul>
<li>数据库, 表名不得超过30个字符, 变量名限制为29个</li>
<li>特殊字符里只有_</li>
<li>不能有任何形式的重名现象</li>
<li>保持字段名和类型的一致性, 在命名字段并其指定数据类型的时候一定要保证一致性</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> `<span class="keyword">order</span>`()</span><br><span class="line"># 其中<span class="keyword">order</span>使用``飘号, 因为<span class="keyword">order</span>和系统关键字或系统函数名等预定义标识符重名了</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id <span class="keyword">AS</span> &quot;编号&quot; <span class="keyword">from</span> t_stu;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>起别名的时候, as可以省略</p>
<p>如果字段别名中没有空格, 可以省略 “ “</p>
</blockquote>
<h4 id="数据导入指令"><a href="#数据导入指令" class="headerlink" title="数据导入指令"></a>数据导入指令</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> source <span class="operator">&lt;</span>path\<span class="operator">*</span><span class="operator">*</span>.<span class="keyword">sql</span><span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="基本的SELECT语句"><a href="#基本的SELECT语句" class="headerlink" title="基本的SELECT语句"></a>基本的SELECT语句</h2><h4 id="SELECT…"><a href="#SELECT…" class="headerlink" title="SELECT…."></a>SELECT….</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="number">1</span>; # 没有任何字句</span><br><span class="line"><span class="keyword">SELECT</span> <span class="number">9</span><span class="operator">/</span><span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"># 会返回一个一行一列的结果集, 常用来测试数据库链接是否正常, 是否可以正常使用</span><br></pre></td></tr></table></figure>

<h4 id="SELECT-…-FROM"><a href="#SELECT-…-FROM" class="headerlink" title="SELECT … FROM"></a>SELECT … FROM</h4><ul>
<li><p>语法 :</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>	标识选择哪些列</span><br><span class="line"><span class="keyword">FROM</span>	标识从哪个表中选择</span><br></pre></td></tr></table></figure>
</li>
<li><p>选择全部列 :</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> departments;</span><br></pre></td></tr></table></figure></li>
</ul>
<blockquote>
<p>一般情况下,  除非需要获取和使用表中的所有字段, 最好不要使用 * 通配符, 会查询到不必要的信息降低程序的运行效率, 优势是, 当不知道,所需要的列的名称的时候, 可以通过它们获取</p>
</blockquote>
<h4 id="列的别名"><a href="#列的别名" class="headerlink" title="列的别名"></a>列的别名</h4><ul>
<li><p>重命名一个列, 便于计算</p>
</li>
<li><p>紧跟列名, 也可以在列名和别名之间加入关键字AS, 别名使用双引号, 以便在别名中包含空格或特殊的字符并区分大小写</p>
</li>
<li><p>举例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name <span class="keyword">AS</span> name, commission_pct comm</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name &quot;Name&quot;, salary<span class="operator">*</span><span class="number">12</span> &quot;Annual Salary&quot;</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="去除重复行"><a href="#去除重复行" class="headerlink" title="去除重复行"></a>去除重复行</h4><p>默认情况下, 查询会返回全部行, 包括重复行.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> department_id</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<p>使用关键字DISTINCT去除重复行</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> department_id</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<p>对于双查询, 会有注意点:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> department_id, salary</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<blockquote>
<ol>
<li>DISTINCT 需要放在所有的列名的前面</li>
<li>DISTINCT其实是对后面所有的列名的组合去重</li>
</ol>
</blockquote>
<h4 id="空值参与运算"><a href="#空值参与运算" class="headerlink" title="空值参与运算"></a>空值参与运算</h4><ul>
<li>所有运算符或列值遇到null值, 运算的结果都为null</li>
</ul>
<h4 id="查询常数"><a href="#查询常数" class="headerlink" title="查询常数"></a>查询常数</h4><p>用于增加一个固定的常数列, 可以用这个列作为表的标记</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;尚硅谷&#x27;</span> <span class="keyword">AS</span> corporation, last_name <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<h2 id="显示表结构"><a href="#显示表结构" class="headerlink" title="显示表结构"></a>显示表结构</h2><p>使用DESCRIBE 或 DESC 命令, 表示表结构</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DESCRIBE</span> employees;</span><br><span class="line"># 或</span><br><span class="line"><span class="keyword">DESC</span> employees;</span><br></pre></td></tr></table></figure>

<p> 其中, 各个字段的含义分别解释如下:</p>
<ul>
<li>Field: 表示字段名称</li>
<li>Type: 表示字段类型</li>
<li>Null: 表示该列是否可以存储NULL值</li>
<li>Key: 表示该列是否已经编制索引, PRI表示该列是表主键的一部分, UNI表示该列是UNIQUE索引的一部分, MUL表示在列中某个给定值允许出现多次</li>
<li>Default: 表示该列是否有默认值, 如果有, 那么值是多少</li>
<li>Extra: 表示可以获取的与给定列有关的附加信息, 例如AUTO_INCREAMENT</li>
</ul>
<h2 id="过滤数据"><a href="#过滤数据" class="headerlink" title="过滤数据"></a>过滤数据</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">&lt;</span>Field1<span class="operator">&gt;</span>, <span class="operator">&lt;</span>Field2<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">FROM</span> <span class="operator">&lt;</span><span class="keyword">table</span><span class="operator">-</span>name<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">WHERE</span> <span class="operator">&lt;</span><span class="keyword">condition</span><span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>WHERE语句需要在FROM语句后面</p>
</blockquote>
<h1 id="4-运算符"><a href="#4-运算符" class="headerlink" title="4. 运算符"></a>4. 运算符</h1><ul>
<li>在Java中, +的左右两边如果有字符串, 那么表示字符串的拼接. 但是在MySQL中 + 只表示数值相加. 如果遇上非数值型, 会先尝试转成数值, 如果转失败, 则会以0为计算</li>
<li>一个数除以整数后, 不管是否能除尽, 结果都为一个浮点数</li>
<li>除不尽的时候, 小数位数保留四位</li>
<li>一个数除以0为NULL</li>
</ul>
<h2 id="比较运算符"><a href="#比较运算符" class="headerlink" title="比较运算符"></a>比较运算符</h2><h3 id="比较结果为NULL"><a href="#比较结果为NULL" class="headerlink" title="比较结果为NULL"></a>比较结果为NULL</h3><p>当普通的运算符, 有一个操作数为NULL的时候, 运算的结果为NULL</p>
<h3 id="安全等于运算符"><a href="#安全等于运算符" class="headerlink" title="安全等于运算符"></a>安全等于运算符</h3><p>安全等于运算符 ( &lt;&#x3D;&gt; ) 与等于运算符 (&#x3D;) 的作用是相似的, 唯一的区别是 ‘&lt;&#x3D;&gt;’ 可以用来对NULL进行判断. 当两个操作数都为NULL的时候, 返回1</p>
<h3 id="空运算符"><a href="#空运算符" class="headerlink" title="空运算符"></a>空运算符</h3><p>判断一个值是否为NULL, 是则返回1</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">NULL</span> <span class="keyword">IS</span> <span class="keyword">NULL</span>, ISNULL(<span class="keyword">NULL</span>);</span><br></pre></td></tr></table></figure>

<h3 id="非空运算符"><a href="#非空运算符" class="headerlink" title="非空运算符"></a>非空运算符</h3><p>与之相对的, 就有非空运算符(IS NOT NULL)</p>
<h3 id="最小值运算符"><a href="#最小值运算符" class="headerlink" title="最小值运算符"></a>最小值运算符</h3><p>语法格式为 : LEAST(值1, 值2, …, 值n).</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> LEAST(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>), LEAST(<span class="number">1</span>, <span class="number">2</span>,<span class="number">3</span>);</span><br></pre></td></tr></table></figure>

<h3 id="最大值运算符"><a href="#最大值运算符" class="headerlink" title="最大值运算符"></a>最大值运算符</h3><p>与最小值运算符相对的就是最大值运算符GREATEST(value1, value2, …,value_n)</p>
<h3 id="BETWEEN-AND运算符"><a href="#BETWEEN-AND运算符" class="headerlink" title="BETWEEN AND运算符"></a>BETWEEN AND运算符</h3><p>使用格式 : </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> D <span class="keyword">FROM</span> <span class="keyword">TABLE</span> <span class="keyword">WHERE</span> C <span class="keyword">BETWEEN</span> A <span class="keyword">AND</span> B;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="keyword">BETWEEN</span> <span class="number">2500</span> <span class="keyword">AND</span> <span class="number">3000</span>;</span><br></pre></td></tr></table></figure>

<h3 id="IN运算符"><a href="#IN运算符" class="headerlink" title="IN运算符"></a>IN运算符</h3><p>用于判定给定的值是否是IN列表中的一个值</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;a&#x27;</span> <span class="keyword">IN</span>(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">NULL</span> <span class="keyword">IN</span>(...) # 返回值一定是<span class="keyword">NULL</span></span><br></pre></td></tr></table></figure>

<h3 id="NOT-IN-运算符"><a href="#NOT-IN-运算符" class="headerlink" title="NOT IN 运算符"></a>NOT IN 运算符</h3><h3 id="LIKE-运算符"><a href="#LIKE-运算符" class="headerlink" title="LIKE 运算符"></a>LIKE 运算符</h3><p>主要用于匹配字符串, 通常用于模糊匹配, 如果给定的值或匹配条件为NULLL , 则返回条件为NULL</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;%&quot;: 匹配<span class="number">0</span>个或多个字符</span><br><span class="line">&quot;_&quot;: 只能匹配一个字符</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> first_name</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> first_name <span class="keyword">LIKE</span> <span class="string">&#x27;S%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> last_name</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> last_name <span class="keyword">LIKE</span> <span class="string">&#x27;_o%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="ESCAPE"><a href="#ESCAPE" class="headerlink" title="ESCAPE"></a>ESCAPE</h3><p>回避特殊符号可以使用转义符</p>
<ul>
<li>使用情景 : 我现在需要查名字里带有_的人, 这个时候, 我们如何表达_符号就是个问题</li>
</ul>
<ol>
<li>使用\作为转移符号的情况 -&gt; 这种情况下, 不需要使用ESCAPE</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> job_id</span><br><span class="line"><span class="keyword">FROM</span> jobs</span><br><span class="line"><span class="keyword">WHERE</span> job_id <span class="keyword">LIKE</span> <span class="string">&#x27;IT\_%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>没有使用\作为转义符号, 这个时候需要使用ESCAPE声明转义字符</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> job_id</span><br><span class="line"><span class="keyword">FROM</span> jobs</span><br><span class="line"><span class="keyword">WHERE</span> job_id <span class="keyword">LIKE</span> <span class="string">&#x27;IT$_%&#x27;</span> <span class="keyword">ESCAPE</span> <span class="string">&#x27;$&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="REGEXP运算符"><a href="#REGEXP运算符" class="headerlink" title="REGEXP运算符"></a>REGEXP运算符</h3><p>同样是用来匹配字符串的, 语法格式为<code>expr REGEXP 匹配条件</code>. 如果expr满足匹配条件, 返回1; 如果不满足, 则返回0. 若expr或匹配条件任意一个为NULL, 则结果为NULL</p>
<p>匹配规则</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(1)&#x27;^&#x27;匹配以该字符后面的字符开头的字符串</span><br><span class="line">(2)&#x27;$&#x27;匹配以该字符前面的字符结尾的字符串</span><br><span class="line">(3)&#x27;.&#x27;匹配任何一个单字符</span><br><span class="line">(4)&quot;[...]&quot;匹配在方括号内的任何字符. 例如, &quot;[abc]&quot;匹配&quot;a&quot;或&quot;b&quot;或&quot;c&quot;. </span><br><span class="line">为了命名字符的范围, 使用一个&#x27;-&#x27;. &quot;[a-z]&quot;匹配任何字母,&quot;[0-9]&quot;匹配任何数字</span><br><span class="line">(5)&#x27;*&#x27;匹配零个或多个在它前面的字符, 例如, &quot;x*&quot;匹配任何数量的&#x27;x&quot;字符, 如[0-9]*表示匹配任何数量数字</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;ssgaga&#x27;</span> REGEXP <span class="string">&#x27;^s&#x27;</span>, <span class="string">&#x27;shsada&#x27;</span> REGEXP <span class="string">&#x27;a$&#x27;</span>, <span class="string">&#x27;shsaga&#x27;</span> REGEXP <span class="string">&#x27;hs&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;atguigu&#x27;</span> REGEXP <span class="string">&#x27;gu.gu&#x27;</span>, <span class="string">&#x27;atguigu&#x27;</span> REGEXP <span class="string">&#x27;[ab]&#x27;</span>;</span><br><span class="line"># 结果全为<span class="number">1</span></span><br></pre></td></tr></table></figure>

<h2 id="逻辑运算符"><a href="#逻辑运算符" class="headerlink" title="逻辑运算符"></a>逻辑运算符</h2><table>
<thead>
<tr>
<th>运算符</th>
<th>作用</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>NOT 或 !</td>
<td>逻辑非</td>
<td>SELECT NOT A</td>
</tr>
<tr>
<td>AND 或 &amp;&amp;</td>
<td>逻辑与</td>
<td>SELECT A AND B</td>
</tr>
<tr>
<td>OR 或 ||</td>
<td>逻辑或</td>
<td>SELECT A OR B</td>
</tr>
<tr>
<td>XOR</td>
<td>逻辑异或</td>
<td>SELECT A XOR B</td>
</tr>
</tbody></table>
<blockquote>
<p>!NULL &#x3D;&gt; NULL</p>
<p>AND前后有NULL的时候返回NULL</p>
<p>OR当有一个值为NULL, 但另一个值为非0的时候, 返回1, 两个都为NULL的时候返回NULL</p>
</blockquote>
<blockquote>
<p>AND和OR可以一起使用, AND的优先级高于OR</p>
</blockquote>
<h2 id="位运算符"><a href="#位运算符" class="headerlink" title="位运算符"></a>位运算符</h2><p>和CPP中的一致, 不赘述</p>
<h1 id="5-排序和分页"><a href="#5-排序和分页" class="headerlink" title="5. 排序和分页"></a>5. 排序和分页</h1><h2 id="1-排序数据"><a href="#1-排序数据" class="headerlink" title="1. 排序数据"></a>1. 排序数据</h2><h3 id="排序规则"><a href="#排序规则" class="headerlink" title="排序规则"></a>排序规则</h3><ul>
<li><p>使用 <code>ORDER BY</code>子句排序</p>
<ul>
<li><p>ASC (ascend) :升序</p>
</li>
<li><p>DESC(descend) :降序</p>
</li>
<li><p><code>ORDER BY</code>子句在SELECT语句的结尾</p>
</li>
</ul>
</li>
</ul>
<h3 id="单列排序"><a href="#单列排序" class="headerlink" title="单列排序"></a>单列排序</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, job_id, department_id, hire_date</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> hire_date;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  last_name,</span><br><span class="line">  job_id,</span><br><span class="line">  department_id,</span><br><span class="line">  hire_date </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  employees </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> hire_date <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<ol>
<li><p>最后的降序还是升序模式, 在ORDER BY语句的末尾说明</p>
</li>
<li><p>默认升序</p>
</li>
</ol>
</blockquote>
<h3 id="多列排序"><a href="#多列排序" class="headerlink" title="多列排序"></a>多列排序</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, department_id, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> hire_date, salary <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>可以使用不再SELECT列表中的列排序</p>
<p>在对多列进行排序的时候, 首先排序的第一列必须有相同的值</p>
</blockquote>
<h2 id="2-分页"><a href="#2-分页" class="headerlink" title="2. 分页"></a>2. 分页</h2><h3 id="问题背景"><a href="#问题背景" class="headerlink" title="问题背景"></a>问题背景</h3><p>背景1: 查询返回的数据太多了, 查看起来很不方便</p>
<p>背景2: 表里又四条数据, 但是我们只想显示2, 3条数据</p>
<h3 id="实现规则"><a href="#实现规则" class="headerlink" title="实现规则"></a>实现规则</h3><ul>
<li><p>MySQL中使用LIMIT实现分页</p>
</li>
<li><p>格式 :</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LIMIT [位置偏移量, ] 行数</span><br></pre></td></tr></table></figure>

<p>第一个”位置偏移量参数”指示MysQL从哪一行开始显示, 是一个可选参数, 如果不指定, 默认从第一条开始; 第二个参数”行数”只是返回的记录条数</p>
</li>
<li><p>举例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 前十条记录</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line">LIMIT <span class="number">0</span>,<span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 或者</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line">LIMIT <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 11至20条记录</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line">LIMIT <span class="number">10</span>,<span class="number">10</span>;</span><br></pre></td></tr></table></figure></li>
</ul>
<blockquote>
<p>MySQL8.0中可以使用”LIMIT 3 OFFSET 4”, 意思是获取从第五条记录开始后面的三条记录, 和”LIMIT 4, 3;”返回的结果相同</p>
</blockquote>
<ul>
<li>分页显示公式: **(当前页数-1)*每页条数, 每页条数 **<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> <span class="operator">&lt;</span><span class="keyword">table</span><span class="operator">&gt;</span></span><br><span class="line">LIMIT(Pageno <span class="operator">-</span> <span class="number">1</span>)<span class="operator">*</span>PageSize, PageSize;</span><br></pre></td></tr></table></figure></li>
</ul>
<blockquote>
<p>LIMIT子句必须放在整个SELECT语句的最后</p>
</blockquote>
<ul>
<li>好处:<ol>
<li>减少数据表的网络传输量 </li>
<li>也可以提升查询效率</li>
<li>SELECT不需要扫描整张表, 只需要检索到一条符合条件的记录即可返回</li>
</ol>
</li>
</ul>
<h2 id="作业"><a href="#作业" class="headerlink" title="作业"></a>作业</h2><p>题目 :</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">1.</span> 查询员工的姓名和部门号和年薪，按年薪降序,按姓名升序显示 </span><br><span class="line">#<span class="number">2.</span> 选择工资不在 <span class="number">8000</span> 到 <span class="number">17000</span> 的员工的姓名和工资，按工资降序，显示第<span class="number">21</span>到<span class="number">40</span>位置的数据 </span><br><span class="line">#<span class="number">3.</span> 查询邮箱中包含 e 的员工信息，并先按邮箱的字节数降序，再按部门号升序</span><br></pre></td></tr></table></figure>

<p>答案 :</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, department_id, salary <span class="operator">*</span> <span class="number">12</span> <span class="keyword">AS</span> annual_salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> annual_salary <span class="keyword">DESC</span>, last_name <span class="keyword">ASC</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="keyword">NOT</span> <span class="keyword">BETWEEN</span> <span class="number">8000</span> <span class="keyword">AND</span> <span class="number">17000</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span></span><br><span class="line">LIMIT <span class="number">20</span>,<span class="number">20</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name,email,department_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"># <span class="keyword">where</span> email <span class="keyword">like</span> &quot;%e%&quot;</span><br><span class="line"><span class="keyword">WHERE</span> email REGEXP <span class="string">&#x27;[e]&#x27;</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> LENGTH(email) <span class="keyword">DESC</span>, department_id <span class="keyword">ASC</span>;</span><br></pre></td></tr></table></figure>

<h1 id="6-多表查询"><a href="#6-多表查询" class="headerlink" title="6. 多表查询"></a>6. 多表查询</h1><p>多表查询, 也称关联查询, 指两个或更多个表一起完成查询操作</p>
<p>前提条件: 这些一起查询的表之间是有关系的 (一对一, 一对多) , 它们之间一定是有关联字段的, 这个关联字段可能建立了外键, 也可能没有建立外键, 比如: 员工表和部门表, 这两个表依靠 “部门编号” 进行关联.</p>
<h2 id="1-多表连接-案例"><a href="#1-多表连接-案例" class="headerlink" title="1. 多表连接 (案例)"></a>1. 多表连接 (案例)</h2><h3 id="案例说明"><a href="#案例说明" class="headerlink" title="案例说明"></a>案例说明</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#案例: 查询员工的姓名及其部门</span><br><span class="line"><span class="keyword">SELECT</span> last_name, department_name</span><br><span class="line"><span class="keyword">FROM</span> employees, departments;</span><br><span class="line"># 返回的行数有<span class="number">2889</span>行</span><br></pre></td></tr></table></figure>

<p>分析错误情况:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(employee_id) <span class="keyword">FROM</span> employees; </span><br><span class="line">#输出<span class="number">107</span>行 </span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(department_id)<span class="keyword">FROM</span> departments; </span><br><span class="line">#输出<span class="number">27</span>行 </span><br><span class="line"><span class="keyword">SELECT</span> <span class="number">107</span><span class="operator">*</span><span class="number">27</span> <span class="keyword">FROM</span> dual;</span><br><span class="line"># <span class="number">107</span><span class="operator">*</span><span class="number">27</span> <span class="operator">=</span> <span class="number">2889</span></span><br></pre></td></tr></table></figure>

<p>该错误称为笛卡尔积的错误</p>
<h3 id="笛卡尔积"><a href="#笛卡尔积" class="headerlink" title="笛卡尔积"></a>笛卡尔积</h3><p>笛卡尔积的作用就是可以把任意表进行连接, 即使这两张不相关.</p>
<p>最后的结果就是两张表的内容, 两两组合</p>
<h3 id="案例分析和问题解决"><a href="#案例分析和问题解决" class="headerlink" title="案例分析和问题解决"></a>案例分析和问题解决</h3><ul>
<li><p>笛卡尔积的错误会在下面条件下产生</p>
<ul>
<li>省略了多个表的连接条件 (或关联条件)</li>
<li>连接条件无效</li>
<li>所有表中的所有行相互连接</li>
</ul>
</li>
<li><p>为了避开笛卡尔积, 可以<strong>在WHERE加入有效的连接条件</strong></p>
</li>
<li><p>加入连接条件后, 查询语法:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> table1.coolumn, table2.column</span><br><span class="line"><span class="keyword">FROM</span> table1, table2</span><br><span class="line"><span class="keyword">WHERE</span> table1.column1 <span class="operator">=</span> table2.column2; # 连接条件</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="2-多表查询分类讲解"><a href="#2-多表查询分类讲解" class="headerlink" title="2. 多表查询分类讲解"></a>2. 多表查询分类讲解</h2><h3 id="分类1-等值连接-vs-非等值连接"><a href="#分类1-等值连接-vs-非等值连接" class="headerlink" title="分类1: 等值连接 vs 非等值连接"></a>分类1: 等值连接 vs 非等值连接</h3><h4 id="等值连接"><a href="#等值连接" class="headerlink" title="等值连接"></a>等值连接</h4><p>简单来说, 就是利用两张不同的表中相等的关联字段连接在一起的就是等值连接, 一般表现形式为一张表的外键和另一张表的主键等值连接 </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employees.`employee_id`, employees.`last_name`</span><br><span class="line">	,employees.`department_id`, departments.`department_id`,</span><br><span class="line">	departments.`department_name`</span><br><span class="line"><span class="keyword">FROM</span> employees, departments</span><br><span class="line"><span class="keyword">WHERE</span> employees.`department_id` <span class="operator">=</span> departments.`department_id`;</span><br></pre></td></tr></table></figure>

<p>拓展1: 表的别名</p>
<ul>
<li><p>使用别名可以简化查询</p>
</li>
<li><p>列明前使用表名前缀可以提高查询效率</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> e.employee_id, e.last_name, e.department_id, </span><br><span class="line">	d.department_id, d.location_id </span><br><span class="line"><span class="keyword">FROM</span> employees e , departments d</span><br><span class="line"><span class="keyword">WHERE</span> e.department_id <span class="operator">=</span> d.department_id;</span><br></pre></td></tr></table></figure></li>
</ul>
<blockquote>
<p>需要说明的是, 如果我们使用了表的别名, 在查询字段, 过滤条件中就只能使用别名进行替代</p>
<p>不能使用原来的表名, 否则就会报错</p>
</blockquote>
<blockquote>
<p><code>阿里开发规范</code>:</p>
<p>[<code>强制</code>]: 对于数据库中表记录的查询和变更, 只要涉及多个表, 都需要在列名前加上表的别名(或表名) 进行限定</p>
</blockquote>
<p>拓展2: 连接多个表</p>
<blockquote>
<p>连接n个表, 至少需要n-1个连接条件</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> e.`last_name`, d.`department_name`, t.`city`</span><br><span class="line"><span class="keyword">FROM</span> employees e, departments d, locations t</span><br><span class="line"><span class="keyword">WHERE</span> e.`department_id` <span class="operator">=</span> d.`department_id` <span class="keyword">AND</span> d.`location_id` <span class="operator">=</span> t.`location_id`;</span><br></pre></td></tr></table></figure>

<h4 id="非等值连接"><a href="#非等值连接" class="headerlink" title="非等值连接"></a>非等值连接</h4><p>连接的<code>WHERE</code>条件不再是相等, 而是别的逻辑判断</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> e.`last_name`, e.`salary`, j.`grade_level`</span><br><span class="line"><span class="keyword">FROM</span> employees e, job_grades j</span><br><span class="line"><span class="keyword">WHERE</span> e.`salary` <span class="keyword">BETWEEN</span> j.`lowest_sal` <span class="keyword">AND</span> j.`highest_sal`;</span><br></pre></td></tr></table></figure>

<h3 id="分类2-自连接-vs-非自连接"><a href="#分类2-自连接-vs-非自连接" class="headerlink" title="分类2 : 自连接 vs 非自连接"></a>分类2 : 自连接 vs 非自连接</h3><ul>
<li>当table1和table2本质上是同一张表, 只是用取别名的方式虚拟成两张表以代表不同的意义. 然后两个表再进行内连接, 外连接等查询</li>
</ul>
<p>题目 : 查询employees表, 返回”Xxx works for Xxx”</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> CONCAT(worker.`last_name`, <span class="string">&#x27; works for &#x27;</span>, manager.`last_name`)</span><br><span class="line"><span class="keyword">FROM</span> employees worker, employees manager</span><br><span class="line"><span class="keyword">WHERE</span>	worker.`employee_id` <span class="operator">=</span> manager.`employee_id`;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>其实就是我们会为了方便理解, 将一张表虚拟成两张表以代表不同的含义, 然后这两个表, 再通过id等进行等值连接, 最后查询</p>
</blockquote>
<h3 id="分类3-内连接-vs-外连接"><a href="#分类3-内连接-vs-外连接" class="headerlink" title="分类3 : 内连接 vs 外连接"></a>分类3 : 内连接 vs 外连接</h3><ul>
<li><p>内连接: 合并具有同一列的两个以上的表的行, <strong>结果集中不包含一个表与另一个表不匹配的行</strong></p>
</li>
<li><p>外连接: 两个表在连接过程中, 除了返回满足连接条件的行以外<strong>还返回左 (或右) 表中布满足条件的行, 这种连接成为左 (右) 连接</strong>. 没有匹配的行时, 结果表中的相应的列为空(NULL)</p>
</li>
<li><p>如果是左外连接, 则连接条件中的左边的表也称为<code>主表</code>, 右边的表称为<code>从表</code></p>
</li>
<li><p>如果是右外连接, 则连接条件中的右边的表也称为<code>主表</code>, 左边的表称为<code>从表</code></p>
</li>
</ul>
<blockquote>
<p>内连接 : 返回满足连接条件的内容, 不满足连接条件的内容不会被返回, 和用WHERE实现的是一致的</p>
<p>外连接 : 不满足连接条件的内容同样会被返回, 其不满足的部分会填上NULL</p>
</blockquote>
<h4 id="SQL92-使用-创建连接"><a href="#SQL92-使用-创建连接" class="headerlink" title="SQL92: 使用(+)创建连接"></a>SQL92: 使用(+)创建连接</h4><ul>
<li><p>在SQL92中采用(+) 代表从表所在的位置, 即左或右外连接中, (+)表示哪个是从表</p>
</li>
<li><p>Oracle 对 SQL92 支持较好，而 MySQL 则不支持 SQL92 的外连接。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#左外连接 </span><br><span class="line"><span class="keyword">SELECT</span> last_name,department_name </span><br><span class="line"><span class="keyword">FROM</span> employees ,departments </span><br><span class="line"><span class="keyword">WHERE</span> employees.department_id <span class="operator">=</span> departments.department_id(<span class="operator">+</span>); </span><br><span class="line">#右外连接 </span><br><span class="line"><span class="keyword">SELECT</span> last_name,department_name </span><br><span class="line"><span class="keyword">FROM</span> employees ,departments </span><br><span class="line"><span class="keyword">WHERE</span> employees.department_id(<span class="operator">+</span>) <span class="operator">=</span> departments.department_id;</span><br></pre></td></tr></table></figure>
</li>
<li><p>而且在 SQL92 中，只有左外连接和右外连接，没有满（或全）外连接。</p>
</li>
</ul>
<h4 id="SQL99语法实现多表查询"><a href="#SQL99语法实现多表查询" class="headerlink" title="SQL99语法实现多表查询"></a>SQL99语法实现多表查询</h4><h4 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h4><ul>
<li><p>使用JOIN…ON子句创建连接的语法结构:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> table1.column, table2.column, table3.column</span><br><span class="line"><span class="keyword">FROM</span> table1</span><br><span class="line">	<span class="keyword">JOIN</span> table2 <span class="keyword">ON</span> table1 <span class="keyword">AND</span> table2 的连接条件</span><br><span class="line">		<span class="keyword">JOIN</span> table3 <span class="keyword">ON</span> table2 <span class="keyword">AND</span> table3 的连接条件</span><br></pre></td></tr></table></figure>

<p>嵌套逻辑类似FOR循环</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> t1 <span class="keyword">in</span> table1:</span><br><span class="line">	<span class="keyword">for</span> t2 <span class="keyword">in</span> table2: </span><br><span class="line">        	<span class="keyword">if</span> condition1:</span><br><span class="line">				<span class="keyword">for</span> t3 <span class="keyword">in</span> table3: </span><br><span class="line">                    <span class="keyword">if</span> condition2: </span><br><span class="line">                        	output t1 + t2 + t3</span><br></pre></td></tr></table></figure>
</li>
<li><p>语法说明:</p>
<ul>
<li><strong>可以使用ON子句指定额外的连接条件</strong></li>
<li>这个连接条件是与其他条件分开的</li>
<li><strong>ON 子句使语句具有更高的易读性</strong></li>
<li>关键字 JOIN, INNER JOIN, CORSS JOIN的含义是一样的, 都表示内连接</li>
</ul>
</li>
</ul>
<h4 id="内连接的实现"><a href="#内连接的实现" class="headerlink" title="内连接的实现"></a>内连接的实现</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> 字段列表</span><br><span class="line"><span class="keyword">FROM</span> <span class="operator">&lt;</span><span class="keyword">table</span><span class="operator">-</span>a<span class="operator">&gt;</span> <span class="keyword">INNER</span> <span class="keyword">JOIN</span> <span class="operator">&lt;</span><span class="keyword">table</span><span class="operator">-</span>b<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">ON</span> 关联条件</span><br><span class="line"><span class="keyword">WHERE</span> .....;</span><br></pre></td></tr></table></figure>

<p>题目1 :</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> e.`employee_id`, e.`last_name`, e.`department_id`,</span><br><span class="line">	d.`department_id`, d.`location_id`</span><br><span class="line"><span class="keyword">FROM</span> 	employees e <span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">ON</span> 	(e.`department_id` <span class="operator">=</span> d.`department_id`);</span><br></pre></td></tr></table></figure>

<p>题目2 :</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> e.`last_name`, d.`department_name`, l.`city`</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">ON</span> e.`department_id` <span class="operator">=</span> d.`department_id`</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> locations l</span><br><span class="line"><span class="keyword">ON</span> d.`location_id` <span class="operator">=</span> l.`location_id`;</span><br></pre></td></tr></table></figure>

<h4 id="外连接"><a href="#外连接" class="headerlink" title="外连接"></a>外连接</h4><h5 id="左外连接"><a href="#左外连接" class="headerlink" title="左外连接"></a>左外连接</h5><ul>
<li><p>语法 :</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 实现查询结果是A</span><br><span class="line"><span class="keyword">SELECT</span> 字段列表</span><br><span class="line"><span class="keyword">FROM</span> <span class="operator">&lt;</span><span class="keyword">table</span><span class="operator">-</span>a<span class="operator">&gt;</span> <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> <span class="operator">&lt;</span><span class="keyword">table</span><span class="operator">-</span>b<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">ON</span> 关联条件</span><br><span class="line"><span class="keyword">WHERE</span> 等其他子句;</span><br></pre></td></tr></table></figure>
</li>
<li><p>举例: </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> e.`last_name`, d.`department_name`, d.`department_id`</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">ON</span> e.department_id <span class="operator">=</span> d.`department_id`;</span><br></pre></td></tr></table></figure></li>
</ul>
<blockquote>
<p>左(右) 外连接的特点就是, 从主表(左\右表)取到的字段名是不会为NULL的, 但是从表的内容可以为NULL</p>
</blockquote>
<h5 id="右外连接"><a href="#右外连接" class="headerlink" title="右外连接"></a>右外连接</h5><p>和左外连接是一样的, 就是换了主表的方向</p>
<blockquote>
<p>LEFT JOIN 和 RIGHT JOIN 只存在SQL99及以后的标准中, 在SQL92中不存在, 只能用 (+) 表示</p>
</blockquote>
<h4 id="满外连接-FULL-OUTER-JOIN"><a href="#满外连接-FULL-OUTER-JOIN" class="headerlink" title="满外连接 ( FULL OUTER JOIN)"></a>满外连接 ( FULL OUTER JOIN)</h4><ul>
<li>满外连接的结果 &#x3D; 左右表匹配的数据 + 左表没有匹配到的数据 + 右表没有匹配到的数据</li>
<li>MySQL不支持FULL JOIN, 但是可以用<code>LEFT JOIN UNION RIGHT JOIN</code>代替</li>
</ul>
<h2 id="7-UNUON的使用"><a href="#7-UNUON的使用" class="headerlink" title="7. UNUON的使用"></a>7. UNUON的使用</h2><p><strong>合并查询的结果</strong>利用UNION关键字, 可以给出多条SELECT语句, 并将它们的结果组合成单个结果集. 合并时, 两个表对应的列数和数据类型必须相同, 并且相互对应. 各个SELECT语句之间使用UNION或UNION ALL关键字分隔</p>
<p>语法格式:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">column</span>,... <span class="keyword">FROM</span> <span class="operator">&lt;</span>table1<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">UNION</span> [<span class="keyword">ALL</span>]</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">column</span>,... <span class="keyword">FROM</span> <span class="operator">&lt;</span>table2<span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>UNION 操作符返回两个查询的结果集的并集, 去掉重复的记录</li>
<li>UNION ALL操作符返回两个查询的结果集的并集, 不去除重复</li>
</ul>
<blockquote>
<p>执行UNION ALL语句时所需要的资源比UNION语句少, 如果明确知道合并数据后的结果数据不存在重复数据, 或不需要去除重复的数据, 尽量使用UNION ALL, 提高数据查询的效率</p>
</blockquote>
<p>举例 : 查询部门编号&gt;90或邮箱包含a的员工信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> e.`last_name`, e.`salary`</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">WHERE</span> e.`department_id` <span class="operator">&gt;</span> <span class="number">90</span> <span class="keyword">OR</span> e.`email` REGEXP &quot;[a]&quot;</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> e.salary <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> e.`last_name`, e.`salary`</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">WHERE</span> e.`department_id` <span class="operator">&gt;</span> <span class="number">90</span></span><br><span class="line"><span class="keyword">UNION</span> </span><br><span class="line"><span class="keyword">SELECT</span> e.`last_name`, e.`salary`</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">WHERE</span> e.`email` REGEXP &quot;[a]&quot;</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<h2 id="8-7种SQL-JOINS的实现"><a href="#8-7种SQL-JOINS的实现" class="headerlink" title="8. 7种SQL JOINS的实现"></a>8. 7种SQL JOINS的实现</h2><p><img src="/.%5Cimgs%5CJOINS.png" alt="JOINS"></p>
<p>实现七种集合关系</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 中图 A∩B</span><br><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, department_name</span><br><span class="line"><span class="keyword">FROM</span> employees e <span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">ON</span> e.`department_id` <span class="operator">=</span> d.`department_id`;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 左上图</span><br><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, department_name</span><br><span class="line"><span class="keyword">FROM</span> employees e <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">ON</span> e.`department_id` <span class="operator">=</span> d.`department_id`;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 右上图</span><br><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, department_name</span><br><span class="line"><span class="keyword">FROM</span> employees e <span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">ON</span> e.`department_id` <span class="operator">=</span> d.`department_id`;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 左中图 A <span class="operator">-</span> A∩B</span><br><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, department_name</span><br><span class="line"><span class="keyword">FROM</span> employees e <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">ON</span> e.`department_id` <span class="operator">=</span> d.`department_id`</span><br><span class="line"><span class="keyword">WHERE</span> d.`department_id` <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 右中图: B<span class="operator">-</span>A∩B</span><br><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, department_name</span><br><span class="line"><span class="keyword">FROM</span> employees e <span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">ON</span> e.`department_id` <span class="operator">=</span> d.`department_id`</span><br><span class="line"><span class="keyword">WHERE</span> e.`department_id` <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 左下图: 满外连接</span><br><span class="line"># 左中图 <span class="operator">+</span> 右上图  A∪B</span><br><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, department_name</span><br><span class="line"><span class="keyword">FROM</span> employees e <span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">ON</span> e.`department_id` <span class="operator">=</span> d.`department_id`</span><br><span class="line"><span class="keyword">WHERE</span> e.`department_id` <span class="keyword">IS</span> <span class="keyword">NULL</span></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span> </span><br><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, department_name</span><br><span class="line"><span class="keyword">FROM</span> employees e <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">ON</span> e.`department_id` <span class="operator">=</span> d.`department_id`;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 右下图</span><br><span class="line"># 左中图 <span class="operator">+</span> 右真图 A∪B<span class="operator">-</span> A∩B</span><br><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, department_name</span><br><span class="line"><span class="keyword">FROM</span> employees e <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">ON</span> e.`department_id` <span class="operator">=</span> d.`department_id`</span><br><span class="line"><span class="keyword">WHERE</span> d.`department_id` <span class="keyword">IS</span> <span class="keyword">NULL</span></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, department_name</span><br><span class="line"><span class="keyword">FROM</span> employees e <span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">ON</span> e.`department_id` <span class="operator">=</span> d.`department_id`</span><br><span class="line"><span class="keyword">WHERE</span> e.`department_id` <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>

<h2 id="9-SQL99语法新特性"><a href="#9-SQL99语法新特性" class="headerlink" title="9. SQL99语法新特性"></a>9. SQL99语法新特性</h2><h3 id="自然连接"><a href="#自然连接" class="headerlink" title="自然连接"></a>自然连接</h3><p>SQL99 在SQL92 的基础上提供了一些特殊语法, 比如 <code>NATURAL JOIN</code>用来表示自然连接, 我们可以把自然连接理解为SQL92中的等值连接. 会帮你自动查询两张连接表中的 <strong>所有相同字段</strong> , 然后进行 <strong>等值连接</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, department_name</span><br><span class="line"><span class="keyword">FROM</span> employees e <span class="keyword">NATURAL</span> <span class="keyword">JOIN</span> departments d;</span><br></pre></td></tr></table></figure>

<h3 id="USING连接"><a href="#USING连接" class="headerlink" title="USING连接"></a>USING连接</h3><p>当我们进行连接的时候, SQL99还支持使用USING指定数据表里的 <strong>同名字段</strong> 进行等值连接. 但是只能配合JOIN一起使用 : </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, department_name</span><br><span class="line"><span class="keyword">FROM</span> employees e <span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">USING</span> (department_id);</span><br></pre></td></tr></table></figure>

<h2 id="10-章节小结"><a href="#10-章节小结" class="headerlink" title="10. 章节小结"></a>10. 章节小结</h2><p>我们要 <strong>控制连接表的数量</strong>. 多表连接就相当于嵌套for循环一样, 非常消耗资源, 会让SQL查询性能下降得很严重, 因此不要连接不必要得表. 在许多DBMS中, 也都会有最大连接表的限制</p>
<blockquote>
<p>[强制]  超过三个表禁止join. 需要join的字段, 数据类型保持绝对一致; 多表关联查询时, 保证被关联的字段需要有索引</p>
<p>即使双表 join 也能注意表索引, SQL性能.</p>
</blockquote>
<h2 id="作业-1"><a href="#作业-1" class="headerlink" title="作业"></a>作业</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">【题目】 </span><br><span class="line"># <span class="number">1.</span>显示所有员工的姓名，部门号和部门名称。 </span><br><span class="line"># <span class="number">2.</span>查询<span class="number">90</span>号部门员工的job_id和<span class="number">90</span>号部门的location_id </span><br><span class="line"># <span class="number">3.</span>选择所有有奖金的员工的 last_name , department_name , location_id , city</span><br><span class="line"># <span class="number">4.</span>选择city在Toronto工作的员工的 last_name , job_id , department_id , department_name </span><br><span class="line"># <span class="number">5.</span>查询员工所在的部门名称、部门地址、姓名、工作、工资，其中员工所在部门的部门名称为’Executive’ </span><br><span class="line"># <span class="number">6.</span>选择指定员工的姓名，员工号，以及他的管理者的姓名和员工号，结果类似于下面的格式 employees Emp# manager Mgr# kochhar <span class="number">101</span> king <span class="number">100</span> </span><br><span class="line"># <span class="number">7.</span>查询哪些部门没有员工 </span><br><span class="line"># <span class="number">8.</span> 查询哪个城市没有部门 </span><br><span class="line"># <span class="number">9.</span> 查询部门名为 Sales 或 IT 的员工信息</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">1</span> </span><br><span class="line"><span class="keyword">SELECT</span> e.`last_name`, e.`department_id`, d.`department_name`</span><br><span class="line"><span class="keyword">FROM</span> employees e <span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">ON</span> e.`department_id` <span class="operator">=</span> d.`department_id`;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">2</span></span><br><span class="line"><span class="keyword">SELECT</span> e.`job_id`, d.`location_id`</span><br><span class="line"><span class="keyword">FROM</span> employees e <span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">ON</span> e.`department_id` <span class="operator">=</span> d.`department_id`</span><br><span class="line"><span class="keyword">WHERE</span> e.`department_id` <span class="operator">=</span> <span class="number">90</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">3</span></span><br><span class="line"><span class="keyword">SELECT</span> e.`last_name`, d.`department_name`, l.`location_id`, l.`city`</span><br><span class="line"><span class="keyword">FROM</span> employees e, departments d, locations l</span><br><span class="line"><span class="keyword">WHERE</span> e.`department_id` <span class="operator">=</span> d.`department_id`</span><br><span class="line"><span class="keyword">AND</span> d.`location_id` <span class="operator">=</span> l.`location_id`</span><br><span class="line"><span class="keyword">AND</span> e.`commission_pct` <span class="keyword">IS</span> <span class="keyword">NOT NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> e.`last_name`, d.`department_name`, l.`location_id`, l.`city`</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> departments d </span><br><span class="line"><span class="keyword">ON</span> e.`department_id` <span class="operator">=</span> d.`department_id`</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> locations l</span><br><span class="line"><span class="keyword">ON</span> d.`location_id` <span class="operator">=</span> l.`location_id`</span><br><span class="line"><span class="keyword">WHERE</span> e.`commission_pct` <span class="keyword">IS</span> <span class="keyword">NOT NULL</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">4</span></span><br><span class="line"><span class="keyword">SELECT</span> e.`last_name`, e.`employee_id`, d.`department_id`, d.`department_name`, l.`city`</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> departments d </span><br><span class="line"><span class="keyword">ON</span> e.`department_id` <span class="operator">=</span> d.`department_id`</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> locations l</span><br><span class="line"><span class="keyword">ON</span> d.`location_id` <span class="operator">=</span> l.`location_id`</span><br><span class="line"><span class="keyword">WHERE</span> l.`city` <span class="operator">=</span> <span class="string">&#x27;Toronto&#x27;</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">5</span></span><br><span class="line"><span class="keyword">SELECT</span> d.`department_name`, l.`street_address`, e.`last_name`, e.`job_id`, e.`salary`</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> departments d </span><br><span class="line"><span class="keyword">ON</span> e.`department_id` <span class="operator">=</span> d.`department_id`</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> locations l</span><br><span class="line"><span class="keyword">ON</span> l.`location_id` <span class="operator">=</span> d.`location_id`</span><br><span class="line"><span class="keyword">WHERE</span> d.`department_name` <span class="operator">=</span> <span class="string">&#x27;Executive&#x27;</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">6</span></span><br><span class="line"><span class="keyword">SELECT</span> worker.`last_name` employees, worker.`employee_id` <span class="keyword">AS</span> <span class="string">&#x27;Emp#&#x27;</span>, mgr.last_name manager, mgr.employee_id &quot;Mgr#&quot;</span><br><span class="line"><span class="keyword">FROM</span> employees worker</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> employees mgr</span><br><span class="line"><span class="keyword">ON</span> worker.`manager_id` <span class="operator">=</span> mgr.`employee_id`;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">7</span></span><br><span class="line"><span class="keyword">SELECT</span> d.`department_name`</span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> employees e</span><br><span class="line"><span class="keyword">ON</span> d.`department_id` <span class="operator">=</span> e.`department_id`</span><br><span class="line"><span class="keyword">WHERE</span> e.`department_id` <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>

<h1 id="7-单行函数"><a href="#7-单行函数" class="headerlink" title="7. 单行函数"></a>7. 单行函数</h1><h2 id="1-函数的理解"><a href="#1-函数的理解" class="headerlink" title="1. 函数的理解"></a>1. 函数的理解</h2><p>本章及下一章讲解的是SQL的内置函数</p>
<blockquote>
<p>DBMS 之间的差异性很大, 远大于同一个语言不同版本之间的差异. 实际上, 只有很少的函数是被DBMS同时支持的. 大部分DBMS会有自己特定的函数, 这就意味着采用SQL函数的代码可移植性是很差的, 因此在使用函数的时候需要特别注意</p>
</blockquote>
<h3 id="函数的分类"><a href="#函数的分类" class="headerlink" title="函数的分类"></a>函数的分类</h3><p>函数分为 <code>单行函数</code>, <code>聚合函数 (分组函数)</code></p>
<p>单行函数</p>
<ul>
<li>操作数据对象</li>
<li>接受参数返回一个结果</li>
<li>只对一行进行变换</li>
<li>每行返回一个结果</li>
<li>可以嵌套</li>
<li>参数可以是一列或一个值</li>
</ul>
<h2 id="2-数值函数"><a href="#2-数值函数" class="headerlink" title="2. 数值函数"></a>2. 数值函数</h2><h3 id="基本函数"><a href="#基本函数" class="headerlink" title="基本函数"></a>基本函数</h3><table>
<thead>
<tr>
<th>函数</th>
<th>用法</th>
</tr>
</thead>
<tbody><tr>
<td>ABS(x)</td>
<td>返回x的绝对值</td>
</tr>
<tr>
<td>SIGN(X)</td>
<td>返回X的符号. 正数返回1, 负数返回-1, 0返回0</td>
</tr>
<tr>
<td>PI()</td>
<td>返回圆周率的值</td>
</tr>
<tr>
<td>CEIL(x), CEILING(x)</td>
<td>返回大于或等于某个值的最小整数 : 向上取整</td>
</tr>
<tr>
<td>FLOOR(x)</td>
<td>返回小于或等于某个值的最大整数 : 向下取整</td>
</tr>
<tr>
<td>LEAST(e1, e2, e3….)</td>
<td>返回列表中的最小值</td>
</tr>
<tr>
<td>GREATEST(e1,e2,e3…)</td>
<td>返回列表中的</td>
</tr>
<tr>
<td>MOD(x,y)</td>
<td>返回x除以y后的余数</td>
</tr>
<tr>
<td>RAND()</td>
<td>返回0 ~ 1的随机值</td>
</tr>
<tr>
<td>RAND(x)</td>
<td>返回0~1的随机值, 其中x的值用作种子值, 相同的x值会产生相同的随机数</td>
</tr>
<tr>
<td>ROUND(x)</td>
<td>返回一个x进行了四舍五入后, 最接近于x的整数</td>
</tr>
<tr>
<td>ROUND(x,y)</td>
<td>返回一个对x进行了四舍五入后, 最接近x的值, 保留到小数点后y位</td>
</tr>
<tr>
<td>TRUNCATE(x,y)</td>
<td>返回数字x截断为y位小数的结果</td>
</tr>
<tr>
<td>SQRT(x)</td>
<td>返回x的平方根. 当x的值为负数时, 返回NULL</td>
</tr>
</tbody></table>
<p>举例 :</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line"><span class="built_in">ABS</span>(<span class="number">-2</span>), <span class="built_in">ABS</span>(<span class="number">1</span>), SIGN(<span class="number">-2</span>), SIGN(<span class="number">0</span>), PI(), <span class="built_in">CEIL</span>(<span class="number">9.3</span>), <span class="built_in">FLOOR</span>(<span class="number">9.3</span>), <span class="built_in">CEIL</span>(<span class="number">-9.3</span>), <span class="built_in">FLOOR</span>(<span class="number">-9.3</span>), <span class="built_in">MOD</span>(<span class="number">12</span>,<span class="number">5</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">LEAST(<span class="number">1</span>,<span class="number">2</span>,<span class="number">23</span>,<span class="number">4</span>,<span class="number">5</span>), GREATEST(<span class="number">1</span>,<span class="number">23</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">52</span>,<span class="number">151</span>), </span><br><span class="line">RAND(), RAND(<span class="number">2</span>), RAND(<span class="number">2</span>), RAND(<span class="number">3</span>), ROUND(PI()),ROUND(PI(), <span class="number">2</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">TRUNCATE</span>(PI(), <span class="number">5</span>), PI(), <span class="built_in">SQRT</span>(<span class="number">3</span>), <span class="built_in">SQRT</span>(<span class="number">-3</span>);</span><br></pre></td></tr></table></figure>

<h3 id="角度和弧度互换函数"><a href="#角度和弧度互换函数" class="headerlink" title="角度和弧度互换函数"></a>角度和弧度互换函数</h3><table>
<thead>
<tr>
<th>函数</th>
<th>用法</th>
</tr>
</thead>
<tbody><tr>
<td>RADIANS(x)</td>
<td>将角度转换弧度, 其中, x为角度值</td>
</tr>
<tr>
<td>DEGREES(x)</td>
<td>将弧度转换为角度, 其中, x为弧度值</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> RADIANS(<span class="number">180</span>), DEGREES(PI());</span><br></pre></td></tr></table></figure>

<h3 id="三角函数"><a href="#三角函数" class="headerlink" title="三角函数"></a>三角函数</h3><table>
<thead>
<tr>
<th>函数</th>
<th>用法</th>
</tr>
</thead>
<tbody><tr>
<td>SIN(x)</td>
<td>返回x的正弦值, 其中, x为弧度制</td>
</tr>
<tr>
<td>ASIN(x)</td>
<td>反三角函数, 如果x的值不在-1到1之间, 则返回NULL</td>
</tr>
<tr>
<td>COS(x)</td>
<td>余弦函数</td>
</tr>
<tr>
<td>ACOS(x)</td>
<td>反余弦函数, 如果x的值不在-1到1之间, 则返回NULL</td>
</tr>
<tr>
<td>TAN(x)</td>
<td>返回x的正切值, 即返回正切值为x的值</td>
</tr>
<tr>
<td>ATAN(x)</td>
<td>返回反正切函数的值</td>
</tr>
<tr>
<td>ATAN2(m,n)</td>
<td>返回两个参数的反正切值</td>
</tr>
<tr>
<td>COT(x)</td>
<td>返回余切值, 其中, x为弧度制</td>
</tr>
</tbody></table>
<blockquote>
<p>三角函数其中的参数都是弧度制参数</p>
</blockquote>
<p>针对ATAN2(m,n)的说明, 例如, 有两个点,point(x1,y1)和point(x2,y2), 使用ATAN函数计算反正切值为ATAN((y2-y1)&#x2F;(x2-x1)),  使用ATAN2(M,N)计算反正切值则为(y2-y1, x2-x1). 由使用方式可以看出, 当x2-x1等于0的时候, ATAN(x)函数会报错, 而ATAN2(m,n)函数则仍可以计算</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line"><span class="built_in">SIN</span>(RADIANS(<span class="number">30</span>)), DEGREES(<span class="built_in">ASIN</span>(<span class="number">1</span>)), <span class="built_in">TAN</span>(RADIANS(<span class="number">45</span>)), DEGREES(<span class="built_in">ATAN</span>(<span class="number">1</span>)), DEGREES(ATAN2(<span class="number">1</span>,<span class="number">1</span>));</span><br></pre></td></tr></table></figure>

<h3 id="指数与对数"><a href="#指数与对数" class="headerlink" title="指数与对数"></a>指数与对数</h3><table>
<thead>
<tr>
<th>函数</th>
<th>用法</th>
</tr>
</thead>
<tbody><tr>
<td>POW(x,y), POWER(x,y)</td>
<td>返回x的y次方</td>
</tr>
<tr>
<td>EXP(x)</td>
<td>e^x</td>
</tr>
<tr>
<td>LN(x), LOG(x)</td>
<td>返回以e为底的x的对数</td>
</tr>
<tr>
<td>LOG10(x)</td>
<td>返回以10为底的x的对数</td>
</tr>
<tr>
<td>LOG2(x)</td>
<td>返回以2为底的x的对数</td>
</tr>
</tbody></table>
<h3 id="进制之间的转换"><a href="#进制之间的转换" class="headerlink" title="进制之间的转换"></a>进制之间的转换</h3><table>
<thead>
<tr>
<th>函数</th>
<th>用法</th>
</tr>
</thead>
<tbody><tr>
<td>BIN(X)</td>
<td>返回X的二进制编码</td>
</tr>
<tr>
<td>HEX(x)</td>
<td>十六进制</td>
</tr>
<tr>
<td>OCT(x)</td>
<td>八进制</td>
</tr>
<tr>
<td>CONV(x,f1,f2)</td>
<td>返回f1进制数变成f2进制数</td>
</tr>
</tbody></table>
<p>CONV(10,2,8) -&gt; 将二进制数(10)转化为八进制数</p>
<h2 id="3-字符串函数"><a href="#3-字符串函数" class="headerlink" title="3. 字符串函数"></a>3. 字符串函数</h2><table>
<thead>
<tr>
<th>函数</th>
<th>用法</th>
</tr>
</thead>
<tbody><tr>
<td>LENGTH(s)</td>
<td>返回字符串s的字节数, 和字符集有关</td>
</tr>
<tr>
<td>CONCAT(s1,s2,s3…)</td>
<td>连接s1,s2,…..,sn为一个字符串函数</td>
</tr>
<tr>
<td>UPEER(s)</td>
<td>所有字母大写</td>
</tr>
<tr>
<td>LOWER(s)</td>
<td>所有字母小写</td>
</tr>
<tr>
<td>REVERSE(s)</td>
<td>返回s反转后的字符串</td>
</tr>
<tr>
<td>NULLIF(value1, value2)</td>
<td>比较两个字符串, 如果value1和value2相等, 则返回NULL, 否则返回value1</td>
</tr>
<tr>
<td>FIND_IN_SET(s1,s2)</td>
<td>返回字符串s1在字符串s2中出现的位置, s2以逗号为分隔</td>
</tr>
<tr>
<td>FILED(s,s1,…)</td>
<td>返回字符串s在字符串列表中第一次出现的位置</td>
</tr>
</tbody></table>
<blockquote>
<p>注意 : MySQL中, 字符串的位置是从1开始的</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> FIELD(<span class="string">&#x27;mm&#x27;</span>, <span class="string">&#x27;hello&#x27;</span>, <span class="string">&#x27;msm&#x27;</span>, <span class="string">&#x27;ammma&#x27;</span>), FIND_IN_SET(<span class="string">&#x27;mm&#x27;</span>,<span class="string">&#x27;hello,mm,amma&#x27;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">NULLIF</span>(<span class="string">&#x27;mysql&#x27;</span>,<span class="string">&#x27;mysql&#x27;</span>), <span class="built_in">NULLIF</span>(<span class="string">&#x27;mysql&#x27;</span>, <span class="string">&#x27;&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="4-日期和时间函数"><a href="#4-日期和时间函数" class="headerlink" title="4. 日期和时间函数"></a>4. 日期和时间函数</h2><h3 id="获取日期-时间"><a href="#获取日期-时间" class="headerlink" title="获取日期, 时间"></a>获取日期, 时间</h3><table>
<thead>
<tr>
<th>函数</th>
<th>用法</th>
</tr>
</thead>
<tbody><tr>
<td><strong>CURDATE()</strong>, CURRENT_DATE()</td>
<td>返回当前日期, 只包含年, 月, 日</td>
</tr>
<tr>
<td><strong>CURTIME()</strong>, CURRENT_TIME()</td>
<td>返回当前时间, 只包含时分秒</td>
</tr>
<tr>
<td><strong>NOW()</strong> &#x2F; SYSDATE() &#x2F; CURRENT_TIMESTAMP() &#x2F; LOCALTIME() &#x2F; LOCALTIMESTAMP()</td>
<td>返回当前系统日期和时间</td>
</tr>
<tr>
<td>UTC_DATE()</td>
<td>返回UTC (世界标准时间) 日期</td>
</tr>
<tr>
<td>UTC_TIME()</td>
<td>返回UTC (世界标准时间) 时间</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">CURDATE(), CURTIME(), NOW(), UTC_DATE(), UTC_TIME();</span><br></pre></td></tr></table></figure>

<blockquote>
<p>可以通过 + 0, 将时间类型转化为数字, 比如2021-10-25 + 0 -&gt; 20211025, 以此可以比较时间?</p>
</blockquote>
<h3 id="日期和时间戳的转换"><a href="#日期和时间戳的转换" class="headerlink" title="日期和时间戳的转换"></a>日期和时间戳的转换</h3><table>
<thead>
<tr>
<th>函数</th>
<th>用法</th>
</tr>
</thead>
<tbody><tr>
<td>UNIX_TIMESTAMP()</td>
<td>以UNIX时间戳的形式返回当前时间</td>
</tr>
<tr>
<td>UNIX_TIMESTAMP(date)</td>
<td>将时间date以UNIX时间戳的形式返回</td>
</tr>
<tr>
<td>FROM_UNIXTIME(timestamp)</td>
<td>jiangUNIX时间戳的时间转换为普通格式的时间</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">UNIX_TIMESTAMP(), FROM_UNIXTIME(UNIX_TIMESTAMP(NOW()));</span><br></pre></td></tr></table></figure>

<h3 id="获取月份-星期-星期数-天数等函数"><a href="#获取月份-星期-星期数-天数等函数" class="headerlink" title="获取月份, 星期, 星期数, 天数等函数"></a>获取月份, 星期, 星期数, 天数等函数</h3><table>
<thead>
<tr>
<th>函数</th>
<th>用法</th>
</tr>
</thead>
<tbody><tr>
<td>YEAR(date) &#x2F; MONTH(date) &#x2F; DAY(date)</td>
<td>返回具体的日期值</td>
</tr>
<tr>
<td>HOUR(time)&#x2F; MINUTE(time) &#x2F; SECOND(time)</td>
<td>返回具体的时间</td>
</tr>
<tr>
<td>MONTHNAME(date)</td>
<td>返回月份: January</td>
</tr>
<tr>
<td>DAYNAME(date)</td>
<td>返回星期几: MONDAY…</td>
</tr>
<tr>
<td>WEEKDAY(date)</td>
<td>返回周几, 周一是0, 周二是1…</td>
</tr>
<tr>
<td>QUARTER(date)</td>
<td>返回日期对应的季度, 范围为1 ~ 4</td>
</tr>
<tr>
<td>WEEK(date) , WEEKOFYEAR(date)</td>
<td>返回一年中的第几周</td>
</tr>
<tr>
<td>DAYOFYEAR(date)</td>
<td>返回一年中的第几天</td>
</tr>
<tr>
<td>DAYOFMONTH(date)</td>
<td>返回日期位于所在月份的第几天</td>
</tr>
<tr>
<td>DAYOFWEEK(date)</td>
<td>返回周几, 注意周日是1, 周一是2</td>
</tr>
</tbody></table>
<h3 id="日期的操作函数"><a href="#日期的操作函数" class="headerlink" title="日期的操作函数"></a>日期的操作函数</h3><table>
<thead>
<tr>
<th>函数</th>
<th>用法</th>
</tr>
</thead>
<tbody><tr>
<td>EXTRACT(type FROM date)</td>
<td>返回指定日期中特定的部分, type指定返回的值</td>
</tr>
</tbody></table>
<p><img src="/.%5Cimgs%5CTYPEOFDATE.png" alt="TYPEOFDATE"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">EXTRACT</span>(<span class="keyword">MINUTE</span> <span class="keyword">FROM</span> NOW());</span><br></pre></td></tr></table></figure>

<h3 id="时间和秒钟转换的函数"><a href="#时间和秒钟转换的函数" class="headerlink" title="时间和秒钟转换的函数"></a>时间和秒钟转换的函数</h3><table>
<thead>
<tr>
<th>函数</th>
<th>用法</th>
</tr>
</thead>
<tbody><tr>
<td>TIME_TO_SEC(time)</td>
<td>将time转化为秒并返回结果值, 转化公式为: <code>小时*3600 + 分钟*60 + 秒</code></td>
</tr>
<tr>
<td>SEC_TO_TIME(seconds)</td>
<td>将seconds描述转化为包含小时, 分钟和秒的时间</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> TIME_TO_SEC(CURTIME()), CURTIME();</span><br></pre></td></tr></table></figure>

<h3 id="计算日期和时间的函数"><a href="#计算日期和时间的函数" class="headerlink" title="计算日期和时间的函数"></a>计算日期和时间的函数</h3><table>
<thead>
<tr>
<th>函数</th>
<th>用法</th>
</tr>
</thead>
<tbody><tr>
<td>DATE_ADD(datetime, INTERVAL expr type), ADDDATE(date, INTERVAL expr type)</td>
<td>返回与给定日期时间相差INTERVAL时间段的日期时间</td>
</tr>
<tr>
<td>DATE_SUB(date, INTERVAL expr type), SUBDATE(date, INTERRVAL expr type) , SUBDATE(….)</td>
<td>返回与date相差INTERVAL时间间隔的日期</td>
</tr>
</tbody></table>
<p><img src="/.%5Cimgs%5CINTERVALTYPE.png" alt="INTERVALTYPE"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> DATE_ADD(NOW(), <span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">DAY</span>) <span class="keyword">AS</span> col1, DATE_ADD(<span class="string">&#x27;2021-10-21 23:32:12&#x27;</span>, <span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">SECOND</span>) <span class="keyword">AS</span> col2,</span><br><span class="line">ADDDATE(<span class="string">&#x27;2021-10-21 23:32:12&#x27;</span>,<span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">SECOND</span>) <span class="keyword">AS</span> col3, </span><br><span class="line">DATE_ADD(<span class="string">&#x27;2021-10-21 23:32:12&#x27;</span>,<span class="type">INTERVAL</span> <span class="string">&#x27;1_1&#x27;</span> MINUTE_SECOND) <span class="keyword">AS</span> col4, </span><br><span class="line">DATE_ADD(NOW(), <span class="type">INTERVAL</span> <span class="number">-1</span> <span class="keyword">YEAR</span>) <span class="keyword">AS</span> col5, #可以是负数 </span><br><span class="line">DATE_ADD(NOW(), <span class="type">INTERVAL</span> <span class="string">&#x27;1_1&#x27;</span> YEAR_MONTH) <span class="keyword">AS</span> col6; #需要单引号</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> DATE_SUB(<span class="string">&#x27;2021-01-21&#x27;</span>,<span class="type">INTERVAL</span> <span class="number">31</span> <span class="keyword">DAY</span>) <span class="keyword">AS</span> col1, </span><br><span class="line">SUBDATE(<span class="string">&#x27;2021-01-21&#x27;</span>,<span class="type">INTERVAL</span> <span class="number">31</span> <span class="keyword">DAY</span>) <span class="keyword">AS</span> col2, </span><br><span class="line">DATE_SUB(<span class="string">&#x27;2021-01-21 02:01:01&#x27;</span>,<span class="type">INTERVAL</span> <span class="string">&#x27;1 1&#x27;</span> DAY_HOUR) <span class="keyword">AS</span> col3 <span class="keyword">FROM</span> DUAL;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ADDDATE是向前 “+” 上指定的时间</p>
<p>SUBDATE是向后 “-“ 上指定的时间</p>
</blockquote>
<table>
<thead>
<tr>
<th>函数</th>
<th>用法</th>
</tr>
</thead>
<tbody><tr>
<td>ADDTIME(time1, time2)</td>
<td>返回time1加上time2的时间, 当time2为一个数字时, 代表的是<code>秒</code>, 可以为负数</td>
</tr>
<tr>
<td>SUBTIME(time1, time2)</td>
<td>返回time1减去time2后的时间, 当time2为一个数字的时候,代表的是<code>秒</code>, 可以为负数</td>
</tr>
<tr>
<td>DATEDIFF(time1, time2)</td>
<td>返回date1 - date2 的日期间隔天数</td>
</tr>
<tr>
<td>TIMEDIFF(time1, time2)</td>
<td>返回time1 - time 的时间间隔</td>
</tr>
<tr>
<td>FROM_DAYS(n)</td>
<td>返回从0000年1月1日起, n天以后的日期</td>
</tr>
<tr>
<td>TO_DAYS(date)</td>
<td>返回date距离0000年1月1日的天数</td>
</tr>
<tr>
<td>LAST_DAY(date)</td>
<td>返回date所在月份的最后一天的日期</td>
</tr>
<tr>
<td>MAKEDATE(year, n)</td>
<td>针对给定年根与所在年份中的天数返还一个日期</td>
</tr>
<tr>
<td>MAKETIME(hour, minute, second)</td>
<td>将给定的小时, 分钟和秒组合成时间并返回</td>
</tr>
<tr>
<td>PERIOD_ADD(time, n)</td>
<td>返回time加上n后的时间</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">ADDTIME(NOW(), <span class="number">20</span>), NOW(), SUBTIME(NOW(), <span class="number">30</span>) , SUBTIME(NOW(), <span class="string">&#x27;1:1:3&#x27;</span>), </span><br><span class="line">DATEDIFF(NOW(), <span class="string">&#x27;2021-10-01&#x27;</span>), TIMEDIFF(NOW(), <span class="string">&#x27;2021-10-01 22:10:20&#x27;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> SUBTIME(NOW(), <span class="string">&#x27;-1:-1:-1&#x27;</span>);</span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------------+</span></span><br><span class="line"><span class="operator">|</span> SUBTIME(NOW(), <span class="string">&#x27;-1:-1:-1&#x27;</span>) <span class="operator">|</span> </span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2019</span><span class="number">-12</span><span class="number">-15</span> <span class="number">22</span>:<span class="number">25</span>:<span class="number">11</span> 		 <span class="operator">|</span> </span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------------+</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> MAKEDATE(<span class="number">2020</span>,<span class="number">32</span>); </span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------+</span></span><br><span class="line"><span class="operator">|</span> MAKEDATE(<span class="number">2020</span>,<span class="number">32</span>) <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2020</span><span class="number">-02</span><span class="number">-01</span> 		<span class="operator">|</span> </span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------+</span></span><br></pre></td></tr></table></figure>

<p>举例 : 查询七天内新增用户的数量由多少</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> num</span><br><span class="line"><span class="keyword">FROM</span> new_user</span><br><span class="line"><span class="keyword">WHERE</span> TO_DAYS(NOW()) <span class="operator">-</span> TO_DAYS(regist_time) <span class="operator">&lt;=</span> <span class="number">7</span>;</span><br></pre></td></tr></table></figure>

<h3 id="日期的格式化与解析"><a href="#日期的格式化与解析" class="headerlink" title="日期的格式化与解析"></a>日期的格式化与解析</h3><table>
<thead>
<tr>
<th>函数</th>
<th>方法</th>
</tr>
</thead>
<tbody><tr>
<td>DATE_FORMAT(date, fmt)</td>
<td>按照字符串fmt格式化日期date</td>
</tr>
<tr>
<td>TIME_FORMAT(time, fmt)</td>
<td>按照字符串fmt格式化时间time</td>
</tr>
<tr>
<td>GET_FORMAT(date_type, format_type)</td>
<td>返回日期字符串的显示格式</td>
</tr>
<tr>
<td>STR_TO_DATE(str, fmt)</td>
<td>按照字符串fmt对str进行解析, 解析为一个日期</td>
</tr>
</tbody></table>
<p>上述<code>非GET_FORMAT</code>函数中fmt参数常用的格式符:</p>
<table>
<thead>
<tr>
<th>格式符</th>
<th>说明</th>
<th>格式符</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>%Y</td>
<td>4位数字表示数字</td>
<td>%y</td>
<td>两位数字表示年份</td>
</tr>
<tr>
<td>%M</td>
<td>月名表示月份</td>
<td>%m</td>
<td>两位数字表示月份(01,02,03)</td>
</tr>
<tr>
<td>%b</td>
<td>缩写的月名</td>
<td>%c</td>
<td>数字表示月份 (1,2,3..)</td>
</tr>
<tr>
<td>%D</td>
<td>英文后缀表示月中的天数(1st, 2nd, 3rd…)</td>
<td>%d</td>
<td>两位数字表示月中的天数(01, 02..)</td>
</tr>
<tr>
<td>%e</td>
<td>数字形式表示月中的天数</td>
<td></td>
<td></td>
</tr>
<tr>
<td>%H</td>
<td>两位数字表示小时, 24小时制 (01,02…)</td>
<td>%h或%l</td>
<td>两位数字表示小时, 12小时制</td>
</tr>
<tr>
<td>%i</td>
<td>两位数字表示分钟</td>
<td>%S和%s</td>
<td>两位数字表示秒</td>
</tr>
<tr>
<td>%W</td>
<td>一周中的星期名称</td>
<td>%a</td>
<td>星期的缩写</td>
</tr>
<tr>
<td>%w</td>
<td>数字表示周 (Sun &#x3D; 0)</td>
<td></td>
<td></td>
</tr>
<tr>
<td>%j</td>
<td>以3位数字表示年终的天数(001, 002…)</td>
<td>%U</td>
<td>以数字表示年中的第几周, (1,2,3..), 其中Sun为周中的第一天</td>
</tr>
<tr>
<td>%u</td>
<td>以数字表示年中的第几周</td>
<td></td>
<td></td>
</tr>
<tr>
<td>%T</td>
<td>24小时制</td>
<td>%r</td>
<td>12小时制</td>
</tr>
<tr>
<td>%p</td>
<td>AM或PM</td>
<td>%%</td>
<td>表示%</td>
</tr>
</tbody></table>
<p>GET_FORMAT函数中date_type和format_type参数的取值如下:</p>
<p><img src="E:\Desktop\imgs\tpye.png" alt="tpye"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> DATE_FORMAT(NOW(), <span class="string">&#x27;%H:%i:%s&#x27;</span>);</span><br><span class="line"><span class="comment">-- 21:18:03</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> STR_TO_DATE(<span class="string">&#x27;09/01/2009&#x27;</span>, <span class="string">&#x27;%m/%d/%Y&#x27;</span>);</span><br><span class="line"></span><br><span class="line">str_to_date(<span class="string">&#x27;09/01/2009&#x27;</span>, <span class="string">&#x27;%m/%d/%Y&#x27;</span>)</span><br><span class="line"><span class="number">2009</span><span class="number">-09</span><span class="number">-01</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> GET_FORMAT(<span class="type">DATE</span>, <span class="string">&#x27;USA&#x27;</span>);</span><br><span class="line"></span><br><span class="line"># <span class="operator">%</span>m.<span class="operator">%</span>d.<span class="operator">%</span>Y</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> DATE_FORMAT(NOW(), GET_FORMAT(<span class="type">DATE</span>, <span class="string">&#x27;USA&#x27;</span>));</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> STR_TO_DATE(<span class="string">&#x27;2020-01-01 00:00:00&#x27;</span>, <span class="string">&#x27;%Y-%m-%d&#x27;</span>);</span><br><span class="line"># <span class="number">2020</span><span class="number">-01</span><span class="number">-01</span></span><br></pre></td></tr></table></figure>

<h2 id="5-流程控制函数"><a href="#5-流程控制函数" class="headerlink" title="5. 流程控制函数"></a>5. 流程控制函数</h2><p>流程处理函数可以根据不同的条件, 执行不同的处理流程, 类似与CPP中的条件控制语句</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>用法</th>
</tr>
</thead>
<tbody><tr>
<td>IF(value, value1, value2)</td>
<td>如果value的值为TRUE, 返回value1, 否则返回value2 : 就像 ? :语句</td>
</tr>
<tr>
<td>IFNULL(value1, value2)</td>
<td>如果value1不为NULL返回value1,否则返回value2</td>
</tr>
<tr>
<td>CASE WHEN 条件1 THEN 结果1 WHEN 条件2 THEN 结果2…[ELSE resultn] END</td>
<td>相当于Java的if … <strong>else if</strong> … else …</td>
</tr>
<tr>
<td>CASE expr WHEN 常量1 THEN 值1 WHEN 常量值2 THEN 值1 … [ELSE值n] END</td>
<td>相当于Java的switch … case …</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> IF(<span class="number">1</span> <span class="operator">&gt;</span> <span class="number">0</span>, <span class="string">&#x27;正确&#x27;</span>, <span class="string">&#x27;错误&#x27;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> IFNULL(<span class="keyword">NULL</span>, <span class="string">&#x27;Hello&#x27;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CASE</span></span><br><span class="line">	<span class="keyword">WHEN</span> <span class="number">1</span> <span class="operator">&gt;</span> <span class="number">0</span></span><br><span class="line">	<span class="keyword">THEN</span> <span class="string">&#x27;1&gt;0&#x27;</span></span><br><span class="line">	<span class="keyword">WHEN</span> <span class="number">2</span> <span class="operator">&gt;</span> <span class="number">0</span></span><br><span class="line">	<span class="keyword">THEN</span> <span class="string">&#x27;2&gt;0&#x27;</span></span><br><span class="line">	<span class="keyword">ELSE</span> <span class="string">&#x27;3&gt;0&#x27;</span></span><br><span class="line">	<span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CASE</span> <span class="number">2</span></span><br><span class="line">	<span class="keyword">WHEN</span> <span class="number">1</span> <span class="keyword">THEN</span>  <span class="string">&#x27;我是1&#x27;</span></span><br><span class="line">	<span class="keyword">WHEN</span> <span class="number">2</span> <span class="keyword">THEN</span>  <span class="string">&#x27;我是2&#x27;</span></span><br><span class="line">	<span class="keyword">ELSE</span> <span class="string">&#x27;你是谁&#x27;</span></span><br><span class="line">	<span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, salary, <span class="keyword">CASE</span> <span class="keyword">WHEN</span> salary <span class="operator">&gt;=</span> <span class="number">15000</span> <span class="keyword">THEN</span> <span class="string">&#x27;高薪&#x27;</span></span><br><span class="line">			<span class="keyword">WHEN</span> salary <span class="operator">&gt;=</span> <span class="number">10000</span> <span class="keyword">THEN</span> <span class="string">&#x27;潜力股&#x27;</span></span><br><span class="line">			<span class="keyword">WHEN</span> salary <span class="operator">&gt;=</span><span class="number">8000</span>   <span class="keyword">THEN</span> <span class="string">&#x27;屌丝&#x27;</span></span><br><span class="line">			<span class="keyword">ELSE</span> <span class="string">&#x27;草根&#x27;</span> <span class="keyword">END</span> <span class="string">&#x27;描述&#x27;</span></span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CASE</span> <span class="keyword">WHEN</span> <span class="number">1</span> <span class="operator">&gt;</span> <span class="number">0</span> <span class="keyword">THEN</span> <span class="string">&#x27;yes&#x27;</span></span><br><span class="line">		<span class="keyword">WHEN</span> <span class="number">1</span> <span class="operator">&lt;=</span> <span class="number">0</span> <span class="keyword">THEN</span> <span class="string">&#x27;no&#x27;</span></span><br><span class="line">		<span class="keyword">ELSE</span> <span class="string">&#x27;unknow&#x27;</span></span><br><span class="line">		<span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, <span class="number">12</span> <span class="operator">*</span> salary <span class="operator">*</span> (<span class="number">1</span> <span class="operator">+</span> IFNULL(commission_pct, <span class="number">0</span>))</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, job_id, salary,</span><br><span class="line">	<span class="keyword">CASE</span> job_id <span class="keyword">WHEN</span> <span class="string">&#x27;IT_PROG&#x27;</span> <span class="keyword">THEN</span> <span class="number">1.10</span><span class="operator">*</span>salary</span><br><span class="line">		    <span class="keyword">WHEN</span> <span class="string">&#x27;ST_CLERK&#x27;</span><span class="keyword">THEN</span> <span class="number">1.15</span><span class="operator">*</span>salary</span><br><span class="line">		    <span class="keyword">WHEN</span> <span class="string">&#x27;SA_REP&#x27;</span>  <span class="keyword">THEN</span> <span class="number">1.20</span><span class="operator">*</span>salary</span><br><span class="line">		    <span class="keyword">ELSE</span> salary	   <span class="keyword">END</span>  &quot;REVISD_SALARY&quot;</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<h2 id="6-加密和解密函数"><a href="#6-加密和解密函数" class="headerlink" title="6. 加密和解密函数"></a>6. 加密和解密函数</h2><p>可以保证数据库的安全</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>用法</th>
</tr>
</thead>
<tbody><tr>
<td>PASSWORD(str)</td>
<td>加密str, 41位长的字符串, 加密结果不可逆, 常用于用户密码的加密</td>
</tr>
<tr>
<td>MD5(str)</td>
<td>返回字符串str的md5加密后的值, 也是一种加密方式, 若参数为NULL, 则会返回NULL</td>
</tr>
<tr>
<td>SHA(str)</td>
<td>从原明文密码str计算并返回加密后的密码字符串, 当参数为NULL时, 返回NULL. <code>SHA加密算法比MD5更加安全</code></td>
</tr>
<tr>
<td>ENCODE(value, password_seed)</td>
<td>返回使用password_seed作为加密密码加密value</td>
</tr>
<tr>
<td>DECODE(value, password_seed)</td>
<td>返回使用password_seed作为加密密码解密value</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> PASSWORD(<span class="string">&#x27;mysql&#x27;</span>), PASSWORD(<span class="keyword">NULL</span>);</span><br><span class="line"># PASSWORD()函数在<span class="number">5.7</span>版本以后已经弃用了</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> MD5(<span class="string">&#x27;123&#x27;</span>), SHA(<span class="string">&#x27;maysql&#x27;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> AES_DECRYPT(AES_ENCRYPT(<span class="string">&#x27;str&#x27;</span>,<span class="string">&#x27;str&#x27;</span>),<span class="string">&#x27;str&#x27;</span>);</span><br><span class="line"># ENCODE已经被弃用</span><br></pre></td></tr></table></figure>

<h2 id="7-MySQL信息函数"><a href="#7-MySQL信息函数" class="headerlink" title="7. MySQL信息函数"></a>7. MySQL信息函数</h2><p>内置查看MySQL信息的函数</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>用法</th>
</tr>
</thead>
<tbody><tr>
<td>VERSION()</td>
<td>返回当前MySQL的版本号</td>
</tr>
<tr>
<td>CONNECTIUON_ID()</td>
<td>返回当前MySQL服务器的连接数</td>
</tr>
<tr>
<td>DATABASE(), SCHEMA()</td>
<td>返回MySQL命令当前所在的数据库</td>
</tr>
<tr>
<td>USER(), CURRENT_USER(), SYSTEM_USER(), SESSION_USER()</td>
<td>返回当前连接MySQL的用户名, 返回格式为”主机名@用户名”</td>
</tr>
<tr>
<td>CHARsET(value)</td>
<td>返回字符集value自变量的字符集</td>
</tr>
<tr>
<td>COLLATION(value)</td>
<td>返回字符串value的比较规则</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> VERSION(), CONNECTION_ID(), DATABASE(), <span class="keyword">USER</span>(), CHARSET(<span class="string">&#x27;abc&#x27;</span>), <span class="keyword">COLLATION</span>(<span class="string">&#x27;abc&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="8-其他函数"><a href="#8-其他函数" class="headerlink" title="8. 其他函数"></a>8. 其他函数</h2><p>一些难以分类但是重要的函数</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>用法</th>
</tr>
</thead>
<tbody><tr>
<td>FORMAT(value, n)</td>
<td>n表示<code>四舍五入</code>后保留到小数点后n位</td>
</tr>
<tr>
<td>INET_ATON(ipvalue)</td>
<td>将以点分隔的IP地址转化为一个数字</td>
</tr>
<tr>
<td>INET_NTOA(value)</td>
<td>将数字形式的IP地址转化为以点为分隔的IP地址</td>
</tr>
<tr>
<td>BENCHMARK(n, expr)</td>
<td>将表达式expr重复执行n次, 用于测试MySQL处理expr表达式所耗费的时间</td>
</tr>
<tr>
<td>CONVERT(value USING char_code)</td>
<td>将value所使用的字符编码修改为char_code</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> FORMAT(<span class="number">123.123</span>, <span class="number">2</span>), </span><br><span class="line">INET_ATON(<span class="string">&#x27;192.168.21&#x27;</span>), INET_NTOA(INET_ATON(<span class="string">&#x27;192.168.21&#x27;</span>)), </span><br><span class="line">BENCHMARK(<span class="number">12000</span>, MD5(<span class="string">&#x27;mysql&#x27;</span>));</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> CHARSET(<span class="string">&#x27;mysql&#x27;</span>), CHARSET(<span class="keyword">CONVERT</span>(<span class="string">&#x27;mysql&#x27;</span> <span class="keyword">USING</span> <span class="string">&#x27;utf8&#x27;</span>));</span><br></pre></td></tr></table></figure>

<h2 id="作业-2"><a href="#作业-2" class="headerlink" title="作业"></a>作业</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">【题目】 # <span class="number">1.</span>显示系统时间(注：日期<span class="operator">+</span>时间) </span><br><span class="line"># <span class="number">2.</span>查询员工号，姓名，工资，以及工资提高百分之<span class="number">20</span><span class="operator">%</span>后的结果（<span class="keyword">new</span> salary） </span><br><span class="line"># <span class="number">3.</span>将员工的姓名按首字母排序，并写出姓名的长度（length） </span><br><span class="line"># <span class="number">4.</span>查询员工id,last_name,salary，并作为一个列输出，别名为OUT_PUT </span><br><span class="line"># <span class="number">5.</span>查询公司各员工工作的年数、工作的天数，并按工作年数的降序排序 </span><br><span class="line"># <span class="number">6.</span>查询员工姓名，hire_date , department_id，满足以下条件：雇用时间在<span class="number">1997</span>年之后，department_id 为<span class="number">80</span> 或 <span class="number">90</span> 或<span class="number">110</span>, commission_pct不为空 </span><br><span class="line"># <span class="number">7.</span>查询公司中入职超过<span class="number">10000</span>天的员工姓名、入职时间 </span><br><span class="line"># <span class="number">8.</span>做一个查询，产生下面的结果 <span class="operator">&lt;</span>last_name<span class="operator">&gt;</span> earns <span class="operator">&lt;</span>salary<span class="operator">&gt;</span> monthly but wants <span class="operator">&lt;</span>salary<span class="operator">*</span><span class="number">3</span><span class="operator">&gt;</span></span><br><span class="line"># <span class="number">9.</span>使用<span class="keyword">case</span><span class="operator">-</span><span class="keyword">when</span>，按照下面的条件： </span><br><span class="line">job grade </span><br><span class="line">AD_PRES A </span><br><span class="line">ST_MAN B </span><br><span class="line">IT_PROG C </span><br><span class="line">SA_REP D </span><br><span class="line">ST_CLERK E</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">1</span></span><br><span class="line"><span class="keyword">SELECT</span> NOW();</span><br><span class="line"></span><br><span class="line"># <span class="number">2</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name, employee_id, salary, salary <span class="operator">*</span> <span class="number">1.2</span> <span class="keyword">AS</span> &quot;new salary&quot;</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br><span class="line"># <span class="number">3</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name, LENGTH(last_name) <span class="keyword">AS</span> LENGTH</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> last_name;</span><br><span class="line"></span><br><span class="line"># <span class="number">4</span></span><br><span class="line"><span class="keyword">SELECT</span> CONCAT(employee_id, <span class="string">&#x27;,&#x27;</span>,  last_name, <span class="string">&#x27;,&#x27;</span>,  salary) <span class="keyword">AS</span> OUT_PUT</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"># <span class="number">5</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name, <span class="keyword">YEAR</span>(NOW()) <span class="operator">-</span> <span class="keyword">YEAR</span>(hire_date) years, DATEDIFF(NOW(), hire_date)</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> years <span class="keyword">DESC</span>;</span><br><span class="line"></span><br><span class="line"># <span class="number">6</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name, hire_date, department_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"># <span class="keyword">where</span> <span class="keyword">year</span>(hire_date) <span class="operator">&gt;</span> <span class="number">1997</span> </span><br><span class="line"><span class="keyword">WHERE</span> DATE_FORMAT(hire_date,<span class="string">&#x27;%Y&#x27;</span>) <span class="operator">&gt;=</span> <span class="string">&#x27;1997&#x27;</span></span><br><span class="line"><span class="keyword">AND</span> department_id <span class="keyword">IN</span> (<span class="number">80</span>, <span class="number">90</span>, <span class="number">110</span>) </span><br><span class="line"><span class="keyword">AND</span> commission_pct <span class="keyword">IS</span> <span class="keyword">NOT NULL</span>;</span><br><span class="line"></span><br><span class="line"># <span class="number">7</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name, hire_date, DATEDIFF(NOW(), hire_date)</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> DATEDIFF(NOW(), hire_date) <span class="operator">&gt;</span> <span class="number">10000</span>;</span><br><span class="line"></span><br><span class="line"># <span class="number">8</span></span><br><span class="line"><span class="keyword">SELECT</span> CONCAT(<span class="string">&#x27;&lt;&#x27;</span>, last_name, <span class="string">&#x27;&gt; &#x27;</span>, <span class="string">&#x27;earns &lt;&#x27;</span>, <span class="keyword">TRUNCATE</span>(salary,<span class="number">0</span>), <span class="string">&#x27;&gt; monthly but wants &lt;&#x27;</span>, salary<span class="operator">*</span><span class="number">3</span>, <span class="string">&#x27;&gt;&#x27;</span>) <span class="keyword">AS</span> &quot;Dream Salary&quot;</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"># <span class="number">9</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name, job_id, <span class="keyword">CASE</span> job_id</span><br><span class="line">	<span class="keyword">WHEN</span> <span class="string">&#x27;AD_PRES&#x27;</span> <span class="keyword">THEN</span> <span class="string">&#x27;A&#x27;</span></span><br><span class="line">	<span class="keyword">WHEN</span> <span class="string">&#x27;ST_MAN&#x27;</span>  <span class="keyword">THEN</span> <span class="string">&#x27;B&#x27;</span></span><br><span class="line">	<span class="keyword">WHEN</span> <span class="string">&#x27;IT_PROG&#x27;</span> <span class="keyword">THEN</span> <span class="string">&#x27;C&#x27;</span></span><br><span class="line">	<span class="keyword">WHEN</span> <span class="string">&#x27;SA_REP&#x27;</span>  <span class="keyword">THEN</span> <span class="string">&#x27;D&#x27;</span></span><br><span class="line">	<span class="keyword">WHEN</span> <span class="string">&#x27;ST_CLERK&#x27;</span><span class="keyword">THEN</span> <span class="string">&#x27;E&#x27;</span></span><br><span class="line">	<span class="keyword">END</span> <span class="keyword">AS</span> &quot;Grade&quot;</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<h1 id="8-聚合函数"><a href="#8-聚合函数" class="headerlink" title="8. 聚合函数"></a>8. 聚合函数</h1><p>对数据进行汇总的函数</p>
<h2 id="聚合函数介绍"><a href="#聚合函数介绍" class="headerlink" title="聚合函数介绍"></a>聚合函数介绍</h2><ul>
<li><strong>什么是聚合函数</strong></li>
</ul>
<p>聚合函数作用于一组数据, 并对一组数据返回一个值</p>
<ul>
<li><strong>聚合函数类型</strong><ul>
<li>AVG()</li>
<li>SUM()</li>
<li>MAX()</li>
<li>MIN()</li>
<li>COUNT()</li>
</ul>
</li>
<li>聚合函数不能嵌套使用</li>
</ul>
<h3 id="AVG-SUM"><a href="#AVG-SUM" class="headerlink" title="AVG, SUM"></a>AVG, SUM</h3><p>可以对数值类数据使用</p>
<p>比如, 不能对varchar()类型的使用</p>
<h3 id="MIN和MAX函数"><a href="#MIN和MAX函数" class="headerlink" title="MIN和MAX函数"></a>MIN和MAX函数</h3><p>可以对任意数据类型的数据使用</p>
<p>可以比较日期</p>
<h3 id="COUNT函数"><a href="#COUNT函数" class="headerlink" title="COUNT函数"></a>COUNT函数</h3><ul>
<li>COUNT(*)返回表中记录总数, 适用于<strong>任何数据类型</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>)</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="operator">=</span> <span class="number">90</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>COUNT(expr)返回expr不为空的记录总数</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(commission_pct)</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="operator">=</span> <span class="number">90</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>问题: 用count(*), count(1), count(列名)谁好呢?</p>
<p>count(*), count(1)比count(列名)</p>
</li>
<li><p>问题: 能不能使用count(列名)替换count(*)?</p>
<p>不要使用 count(列名)来替代 <code>count(*)</code> ， <code>count(*)</code> 是 SQL92 定义的标准统计行数的语法，跟数</p>
<p>据库无关，跟 NULL 和非 NULL 无关。</p>
<p>说明：count(*)会统计值为 NULL 的行，而 count(列名)不会统计此列为 NULL 值的行。</p>
</li>
</ul>
<h2 id="GROUP-BY"><a href="#GROUP-BY" class="headerlink" title="GROUP BY"></a>GROUP BY</h2><h3 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h3><p><strong>可以使用GROUP BY子句将表中的数据分为若干组</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">column</span>, group_function(<span class="keyword">column</span>)</span><br><span class="line"><span class="keyword">FROM</span> <span class="operator">&lt;</span><span class="keyword">table</span><span class="operator">&gt;</span></span><br><span class="line">[<span class="keyword">WHERE</span> <span class="keyword">condition</span>]</span><br><span class="line">[<span class="keyword">GROUP</span> <span class="keyword">BY</span> group_by_expression]</span><br><span class="line">[<span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">column</span>]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>WHERE一定放在FROM后面</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> department_id, <span class="built_in">AVG</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id;</span><br></pre></td></tr></table></figure>

<p>包含在 GROUP BY子句中的列不必包含在SELECT列表中</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  <span class="built_in">AVG</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id;</span><br></pre></td></tr></table></figure>

<h3 id="使用多个列分组"><a href="#使用多个列分组" class="headerlink" title="使用多个列分组"></a>使用多个列分组</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> department_id, job_id, <span class="built_in">SUM</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id, job_id;</span><br></pre></td></tr></table></figure>

<h3 id="GROUP-BY中使用WITH-ROLLUP"><a href="#GROUP-BY中使用WITH-ROLLUP" class="headerlink" title="GROUP BY中使用WITH ROLLUP"></a>GROUP BY中使用WITH ROLLUP</h3><p>使用这个关键字以后, 能计算查询出的所有记录的综合, 即统计记录数量</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> department_id,job_id , <span class="built_in">AVG</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id, job_id <span class="keyword">WITH</span> <span class="keyword">ROLLUP</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>表示’小计’, 我们有一个销售数据表，包含年份、季度和销售额，</p>
<p>年份   季度   总销售额</p>
<p>2023   Q1     1000<br>2023   Q2     1200<br>2023   Q3     1100<br>2023   Q4     1300<br>2023   NULL   4600    – 2023年的小计<br>2024   Q1     1100<br>2024   Q2     1300<br>2024   NULL   2400    – 2024年的小计<br>NULL   NULL   7000    – 总计</p>
<p>年度小计 : 当季度列为NULL时, 对应行显示该年度的总销售额</p>
<p>总计行 : 当年份和季度都为NULL时, 显示所有年份和季度的总销售额</p>
</blockquote>
<blockquote>
<p>当使用ROLLUP时, 不能同时使用ERDER BY子句进行结果排序, 即两个语句是互斥语句</p>
</blockquote>
<h2 id="HAVING语句"><a href="#HAVING语句" class="headerlink" title="HAVING语句"></a>HAVING语句</h2><h3 id="基本使用-1"><a href="#基本使用-1" class="headerlink" title="基本使用"></a>基本使用</h3><p>过滤分组: HAVING子句</p>
<p>适用情况:</p>
<ol>
<li>行已经被分组</li>
<li>使用了聚合函数</li>
<li>满足HAVING子句中条件的分组将被显示</li>
<li>HAVING 不能单独使用, 必须要跟 GROUP BY一起使用</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> department_id, <span class="built_in">MAX</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line"><span class="keyword">HAVING</span>	<span class="built_in">MAX</span>(salary)<span class="operator">&gt;</span><span class="number">10000</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>其实就是针对GROUP BY + WHERE后面条件语句不能使用聚合函数的补充</p>
</blockquote>
<h3 id="WHERE和HAVING的对比"><a href="#WHERE和HAVING的对比" class="headerlink" title="WHERE和HAVING的对比"></a>WHERE和HAVING的对比</h3><p><strong>区别1 : WHERE可以直接使用表中的字段作为筛选条件, 但不能使用分组中的计算函数作为筛选条件; HAVING 必须要和GROUP BY配合使用, 可以把分组计算的函数和分组作为筛选条件</strong></p>
<p>在查询语法结构中, WHERE语句在GROUP BY之前, 无法对分组结果进行筛选. 另外, WHERE排除的记录不再包括在分组中</p>
<p><strong>区别2 : 如果需要通过连接从关联表中获取需要的数据, WHERE是先筛选后连接, 而HAVING是先连接后筛选</strong></p>
<table>
<thead>
<tr>
<th></th>
<th>优点</th>
<th>缺点</th>
</tr>
</thead>
<tbody><tr>
<td>WHERE</td>
<td>先筛选数据再关联, 执行效率高</td>
<td>不能对分组中的计算函数进行筛选</td>
</tr>
<tr>
<td>HAVING</td>
<td>可以使用分组中的计算函数</td>
<td>在最后的结果集中进行筛选, 执行效率较低</td>
</tr>
</tbody></table>
<p><strong>开发中的选择:</strong></p>
<p>两者并不是相互排斥的, 我们可以在一个查询中同时使用WHERE和HAVING. 包含分组统计函数的条件使用HAVING, 普通条件使用WHERE</p>
<h2 id="SELECT的执行过程"><a href="#SELECT的执行过程" class="headerlink" title="SELECT的执行过程"></a>SELECT的执行过程</h2><h3 id="查询的结构"><a href="#查询的结构" class="headerlink" title="查询的结构"></a>查询的结构</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 方式<span class="number">1</span>:</span><br><span class="line"><span class="keyword">SELECT</span> ...</span><br><span class="line"><span class="keyword">FROM</span> ...</span><br><span class="line"><span class="keyword">WHERE</span> 多表的连接条件</span><br><span class="line"><span class="keyword">AND</span>  不包含组函数的过滤条件</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> ...</span><br><span class="line"><span class="keyword">HAVING</span> 包含组函数的过滤条件</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> ... <span class="keyword">ASC</span><span class="operator">/</span><span class="keyword">DESC</span></span><br><span class="line">LIMIT ...</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 方式<span class="number">2</span>:</span><br><span class="line"><span class="keyword">SELECT</span> ...</span><br><span class="line"><span class="keyword">FROM</span> ... <span class="keyword">JOIN</span> ...</span><br><span class="line"><span class="keyword">ON</span> 多表连接的条件</span><br><span class="line"><span class="keyword">JOIN</span> ...</span><br><span class="line"><span class="keyword">ON</span> ...</span><br><span class="line"><span class="keyword">WHERE</span> 不包含组函数的过滤条件</span><br><span class="line"><span class="keyword">AND</span><span class="operator">/</span><span class="keyword">OR</span> 不包含组函数的过滤条件</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> ...</span><br><span class="line"><span class="keyword">HAVING</span> 包含组函数的过滤条件</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> .... <span class="keyword">ASC</span>?<span class="keyword">DEsC</span></span><br><span class="line">LIMIT ...</span><br></pre></td></tr></table></figure>

<h3 id="SELECT-的执行顺序"><a href="#SELECT-的执行顺序" class="headerlink" title="SELECT 的执行顺序"></a>SELECT 的执行顺序</h3><p><strong>1. 关键字的顺序是不能颠倒的</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ... <span class="keyword">FROM</span> ... <span class="keyword">WHERE</span> ... <span class="keyword">GROUP</span> <span class="keyword">BY</span> ... <span class="keyword">HAVING</span> ... <span class="keyword">ORDER</span> <span class="keyword">BY</span> ... LIMIT</span><br></pre></td></tr></table></figure>

<p><strong>2. SELECT语句的执行顺序</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">WHERE</span> <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">HAVING</span> <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">SELECT</span> 字段 <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">DISTINCT</span> <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="operator">-</span><span class="operator">&gt;</span> LIMIT</span><br></pre></td></tr></table></figure>

<p>在SELECT语句执行这些步骤的时候, 每个步骤都会产生一个<code>虚拟表</code>, 然后将这个虚拟表传入下一个步骤中作为输入, 需要注意的是, 这些步骤隐含在SQL的执行过程中, 对于我们来说是不可见的</p>
<h3 id="SQL的执行原理"><a href="#SQL的执行原理" class="headerlink" title="SQL的执行原理"></a>SQL的执行原理</h3><p>SELECT 是先执行 FROM 这一步的。在这个阶段，如果是多张表联查，还会经历下面的几个步骤：</p>
<p>​	1. 首先先通过 CROSS JOIN 求笛卡尔积，相当于得到虚拟表 <code>vt（virtual table）1-1</code>； </p>
<p>​	2. 通过 ON 进行筛选，在虚拟表 <code>vt1-1</code> 的基础上进行筛选，得到虚拟表 <code>vt1-2</code>； </p>
<p>​	3. 添加外部行。如果我们使用的是左连接、右链接或者全连接，就会涉及到外部行，也就是在虚拟</p>
<p>表 <code>vt1-2</code> 的基础上增加外部行，得到虚拟表 <code>vt1-3</code>。</p>
<p>当然如果我们操作的是两张以上的表，还会重复上面的步骤，直到所有表都被处理完为止。这个过程得</p>
<p>到是我们的原始数据。</p>
<p>当我们拿到了查询数据表的原始数据，也就是最终的虚拟表 <code>vt1</code> ，就可以在此基础上再进行 WHERE 阶 </p>
<p>段 。在这个阶段中，会根据 vt1 表的结果进行筛选过滤，得到虚拟表 <code>vt2</code> 。</p>
<p>然后进入第三步和第四步，也就是 GROUP 和 HAVING 阶段 。在这个阶段中，实际上是在虚拟表<code> vt2</code> 的</p>
<p>基础上进行分组和分组过滤，得到中间的虚拟表 <code>vt3</code> 和 <code>vt4</code> 。</p>
<p>当我们完成了条件筛选部分之后，就可以筛选表中提取的字段，也就是进入到 SELECT 和 DISTINCT </p>
<p>阶段 。</p>
<p>首先在 SELECT 阶段会提取想要的字段，然后在 DISTINCT 阶段过滤掉重复的行，分别得到中间的虚拟表</p>
<p><code>vt5-1</code> 和 <code>vt5-2</code> 。</p>
<p>当我们提取了想要的字段数据之后，就可以按照指定的字段进行排序，也就是 ORDER BY 阶段 ，得到</p>
<p>虚拟表<code> vt6</code> 。</p>
<p>最后在<code>vt6</code>的基础上，取出指定行的记录，也就是 LIMIT 阶段 ，得到最终的结果，对应的是虚拟表</p>
<p><code>vt7 </code>。</p>
<p>当然我们在写 SELECT 语句的时候，不一定存在所有的关键字，相应的阶段就会省略。</p>
<p>同时因为 SQL 是一门类似英语的结构化查询语言，所以我们在写 SELECT 语句的时候，还要注意相应的</p>
<p>关键字顺序，<strong>所谓底层运行的原理，就是我们刚才讲到的执行顺序</strong></p>
<h2 id="作业-3"><a href="#作业-3" class="headerlink" title="作业"></a>作业</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">【题目】 </span><br><span class="line">#<span class="number">1.</span><span class="keyword">where</span>子句可否使用组函数进行过滤? </span><br><span class="line">#<span class="number">2.</span>查询公司员工工资的最大值，最小值，平均值，总和 </span><br><span class="line">#<span class="number">3.</span>查询各job_id的员工工资的最大值，最小值，平均值，总和 </span><br><span class="line">#<span class="number">4.</span>选择具有各个job_id的员工人数 </span><br><span class="line"># <span class="number">5.</span>查询员工最高工资和最低工资的差距（DIFFERENCE） </span><br><span class="line"># <span class="number">6.</span>查询各个管理者手下员工的最低工资，其中最低工资不能低于<span class="number">6000</span>，没有管理者的员工不计算在内 </span><br><span class="line"># <span class="number">7.</span>查询所有部门的名字，location_id，员工数量和平均工资，并按平均工资降序 </span><br><span class="line"># <span class="number">8.</span>查询每个工种、每个部门的部门名、工种名和最低工资</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">2</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MAX</span>(salary), <span class="built_in">MIN</span>(salary), <span class="built_in">AVG</span>(salary), <span class="built_in">SUM</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">3</span></span><br><span class="line"><span class="keyword">SELECT</span> job_id, <span class="built_in">MAX</span>(salary), <span class="built_in">MIN</span>(salary), <span class="built_in">AVG</span>(salary), <span class="built_in">SUM</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> job_id;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">4</span></span><br><span class="line"><span class="keyword">SELECT</span> job_id, <span class="built_in">MAX</span>(salary), <span class="built_in">MIN</span>(salary), <span class="built_in">AVG</span>(salary), <span class="built_in">SUM</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> job_id;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">5</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MAX</span>(salary) <span class="operator">-</span> <span class="built_in">MIN</span>(salary) DIFFERENCE</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">6</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MAX</span>(salary) <span class="operator">-</span> <span class="built_in">MIN</span>(salary) DIFFERENCE</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">7</span></span><br><span class="line"><span class="keyword">SELECT</span> d.`department_name`, d.`location_id`, <span class="built_in">COUNT</span>(employee_id), <span class="built_in">AVG</span>(e.`salary`)</span><br><span class="line"><span class="keyword">FROM</span> employees e <span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">ON</span> e.`department_id` <span class="operator">=</span> d.`department_id`</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_name, location_id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="built_in">MIN</span>(e.`salary`) <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>当SELECT 语句中同时有聚合列和非聚合列的时候一定要有GROUP BY</p>
<p>因为这个时候, 非聚合列的一行数据是无法和聚合列的一行数据对应的</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">8</span></span><br><span class="line"><span class="keyword">SELECT</span> e.`job_id`, d.`department_name`, <span class="built_in">MIN</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span> employees e <span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">ON</span> e.`department_id` <span class="operator">=</span> d.`department_id`</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span>  d.`department_name`, e.`job_id`;</span><br></pre></td></tr></table></figure>

<h1 id="9-子查询"><a href="#9-子查询" class="headerlink" title="9. 子查询"></a>9. 子查询</h1><h2 id="需求分析与问题解决"><a href="#需求分析与问题解决" class="headerlink" title="需求分析与问题解决"></a>需求分析与问题解决</h2><h3 id="实际问题"><a href="#实际问题" class="headerlink" title="实际问题"></a>实际问题</h3><p>谁的工资比 Abel 高 ? &#x3D;&gt; Abel 的工资是多少</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 自连接</span><br><span class="line"><span class="keyword">SELECT</span> e2.`salary`, e1.`salary`</span><br><span class="line"><span class="keyword">FROM</span> employees e1, employees e2</span><br><span class="line"><span class="keyword">WHERE</span> e1.`last_name` <span class="operator">=</span> <span class="string">&#x27;Abel&#x27;</span></span><br><span class="line"><span class="keyword">AND</span> e2.`salary` <span class="operator">&gt;</span> e1.salary</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 子查询</span><br><span class="line"><span class="keyword">SELECT</span> salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> salary</span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">	<span class="keyword">WHERE</span> last_name <span class="operator">=</span> <span class="string">&#x27;Abel&#x27;</span></span><br><span class="line">	);</span><br></pre></td></tr></table></figure>

<h3 id="子查询的基本使用"><a href="#子查询的基本使用" class="headerlink" title="子查询的基本使用"></a>子查询的基本使用</h3><ul>
<li><p>子查询的基本语法结构</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> select_list</span><br><span class="line"><span class="keyword">FROM</span> <span class="operator">&lt;</span><span class="keyword">table</span><span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">WHERE</span> expr operator</span><br><span class="line">				(<span class="keyword">SELECT</span> select_list</span><br><span class="line">                <span class="keyword">FROM</span> <span class="operator">&lt;</span><span class="keyword">table</span><span class="operator">&gt;</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>子查询 (内查询) 在主查询之前一次执行完成</p>
</li>
<li><p>子查询的结果被主查询 (外查询) 使用</p>
</li>
<li><p><strong>注意事项</strong></p>
<ul>
<li>子查询要包含在括号内</li>
<li>将子查询放在比较条件的右侧</li>
<li>单行操作符对应单行子查询, 多行操作符对应多行子查询</li>
</ul>
</li>
</ul>
<h3 id="子查询的分类"><a href="#子查询的分类" class="headerlink" title="子查询的分类"></a>子查询的分类</h3><p><strong>分类方式1:</strong></p>
<p>按查询的结果返回一条还是多条记录, 将子查询分为<code>单行子查询</code>, <code>多行子查询</code></p>
<p><strong>分类方式2:</strong></p>
<p>按内查询是否被执行多次, 将子查询划分为<code>相关(或关联)子查询</code>和<code>不相关(或非关联)子查询</code></p>
<p>子查询只是作为条件进行执行, 只运行一次, 这种查询叫做不相关子查询</p>
<p>采用循环的方式, 先从外部查询开始, 每次都传入子查询进行查询, 然后再将结果反馈给外部, 这种嵌套的执行方式就是相关子查询</p>
<h2 id="单行子查询"><a href="#单行子查询" class="headerlink" title="单行子查询"></a>单行子查询</h2><p><strong>题目: 查询工资大于149号员工工资的员工的信息</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> salary</span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">	<span class="keyword">WHERE</span> employee_id <span class="operator">=</span> <span class="number">149</span>); </span><br></pre></td></tr></table></figure>

<p><strong>题目: 返回job_id与141号员工相同, salary比143员工多的员工姓名, job_id和工资</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, job_id, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> job_id <span class="operator">=</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> job_id</span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">	<span class="keyword">WHERE</span> employee_id <span class="operator">=</span> <span class="number">141</span>)</span><br><span class="line"><span class="keyword">AND</span> salary <span class="operator">&gt;</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> salary</span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">	<span class="keyword">WHERE</span> employee_id <span class="operator">=</span> <span class="number">143</span>);</span><br></pre></td></tr></table></figure>

<p><strong>题目 : 查询与141号或174员工的manager_id和department_id相同的其他员工的employee_id, manager_id, department_id</strong></p>
<p>不成对比较 : </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, manager_id, department_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> manager_id <span class="keyword">IN</span></span><br><span class="line">	(<span class="keyword">SELECT</span> manager_id</span><br><span class="line">		<span class="keyword">FROM</span> employees</span><br><span class="line">		<span class="keyword">WHERE</span> employee_id <span class="keyword">IN</span> (<span class="number">141</span>,<span class="number">174</span>))</span><br><span class="line"><span class="keyword">AND</span> department_id <span class="keyword">IN</span></span><br><span class="line">	(<span class="keyword">SELECT</span> department_id</span><br><span class="line">		<span class="keyword">FROM</span> employees</span><br><span class="line">		<span class="keyword">WHERE</span> employee_id <span class="keyword">IN</span> (<span class="number">141</span>,<span class="number">174</span>));</span><br></pre></td></tr></table></figure>

<p>成对比较 :</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, manager_id, department_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> (manager_id, department_id) <span class="keyword">IN</span></span><br><span class="line">	(<span class="keyword">SELECT</span> manager_id, department_id</span><br><span class="line">		<span class="keyword">FROM</span> employees</span><br><span class="line">		<span class="keyword">WHERE</span> employee_id <span class="keyword">IN</span> (<span class="number">141</span>, <span class="number">174</span>))</span><br><span class="line"><span class="keyword">AND</span> employee_id <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="number">141</span>, <span class="number">174</span>);</span><br></pre></td></tr></table></figure>

<h3 id="HAVING-中的子查询"><a href="#HAVING-中的子查询" class="headerlink" title="HAVING 中的子查询"></a>HAVING 中的子查询</h3><ul>
<li>首先执行子查询</li>
<li>向主查询中的HAVING子句返回结果</li>
</ul>
<p><strong>题目: 擦汗寻最低工资大于50号部门最低工资的部门id和其他最低工资</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> department_id, <span class="built_in">MIN</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">MIN</span>(salary) <span class="operator">&gt;</span></span><br><span class="line">	(<span class="keyword">SELECT</span> <span class="built_in">MIN</span>(salary)</span><br><span class="line">		<span class="keyword">FROM</span> employees</span><br><span class="line">		<span class="keyword">WHERE</span> department_id <span class="operator">=</span> <span class="number">50</span>);</span><br></pre></td></tr></table></figure>

<h3 id="CASE中的子查询"><a href="#CASE中的子查询" class="headerlink" title="CASE中的子查询"></a>CASE中的子查询</h3><p><strong>题目：显式员工的employee_id,last_name和location。其中，若员工department_id与location_id为1800</strong> </p>
<p><strong>的department_id相同，则location为’Canada’，其余则为’USA’</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, </span><br><span class="line">	(<span class="keyword">CASE</span> department_id</span><br><span class="line">	<span class="keyword">WHEN</span> (<span class="keyword">SELECT</span> department_id</span><br><span class="line">		<span class="keyword">FROM</span> departments</span><br><span class="line">		<span class="keyword">WHERE</span> location_id <span class="operator">=</span> <span class="number">18000</span>)</span><br><span class="line">	<span class="keyword">THEN</span> <span class="string">&#x27;Canada&#x27;</span></span><br><span class="line">	<span class="keyword">ELSE</span> <span class="string">&#x27;USA&#x27;</span> <span class="keyword">END</span>) location	</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br></pre></td></tr></table></figure>

<h3 id="子查询中的空值问题"><a href="#子查询中的空值问题" class="headerlink" title="子查询中的空值问题"></a>子查询中的空值问题</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, job_id </span><br><span class="line"><span class="keyword">FROM</span> employees </span><br><span class="line"><span class="keyword">WHERE</span> job_id <span class="operator">=</span> </span><br><span class="line">    (<span class="keyword">SELECT</span> job_id </span><br><span class="line">        <span class="keyword">FROM</span> employees </span><br><span class="line">        <span class="keyword">WHERE</span> last_name <span class="operator">=</span> <span class="string">&#x27;Haas&#x27;</span>);</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>子查询不返回任何行</strong></p>
</blockquote>
<h3 id="非法使用子查询"><a href="#非法使用子查询" class="headerlink" title="非法使用子查询"></a>非法使用子查询</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, last_name </span><br><span class="line"><span class="keyword">FROM</span> employees </span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">=</span> </span><br><span class="line">    (<span class="keyword">SELECT</span> <span class="built_in">MIN</span>(salary) <span class="keyword">FROM</span> employees </span><br><span class="line">     <span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>错误代码 : 1241<br>Subquery returns more than 1 row</p>
</blockquote>
<blockquote>
<p>多行子查询使用单行比较符</p>
</blockquote>
<h2 id="多行子查询"><a href="#多行子查询" class="headerlink" title="多行子查询"></a>多行子查询</h2><ul>
<li>也称为集合比较子查询</li>
<li>内查询返回多行</li>
<li>使用多行比较操作符</li>
</ul>
<h3 id="多行比较操作符"><a href="#多行比较操作符" class="headerlink" title="多行比较操作符"></a>多行比较操作符</h3><table>
<thead>
<tr>
<th>操作符</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>IN</td>
<td>等于列表中的任何一个</td>
</tr>
<tr>
<td>ANY</td>
<td>需要和单行比较操作符一起使用, 和子查询返回的某个值进行比较</td>
</tr>
<tr>
<td>ALL</td>
<td>需要和单行比较操作符一起使用, 和子查询返回的所有值比较</td>
</tr>
<tr>
<td>SOME</td>
<td>实际上式ANY的别名, 作用相同, 一般常使用ANY</td>
</tr>
</tbody></table>
<blockquote>
<p>ANY操作符: ANY表示”与子查询返回的任何一个值比较”。如果比较结果有一个为真，则整个表达式为真。</p>
<p>ALL操作符: ALL表示”与子查询返回的所有值比较”。只有当比较结果对所有值都为真时，整个表达式才为真。</p>
</blockquote>
<p><strong>题目：返回其它job_id中比job_id为‘IT_PROG’部门任一工资低的员工的员工号、姓名、job_id 以及salary</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, job_id, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&lt;</span> <span class="keyword">ANY</span></span><br><span class="line">    (<span class="keyword">SELECT</span> salary</span><br><span class="line">        <span class="keyword">FROM</span> employees</span><br><span class="line">        <span class="keyword">WHERE</span> job_id <span class="operator">=</span> <span class="string">&#x27;IT_PROG&#x27;</span>)</span><br><span class="line"><span class="keyword">AND</span> job_id <span class="operator">&lt;&gt;</span> <span class="string">&#x27;IT_PROG&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><strong>题目：返回其它job_id中比job_id为‘IT_PROG’部门所有工资都低的员工的员工号、姓名、job_id以及salary</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, job_id, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&lt;</span> <span class="keyword">ALL</span></span><br><span class="line">    (<span class="keyword">SELECT</span> salary</span><br><span class="line">        <span class="keyword">FROM</span> employees</span><br><span class="line">        <span class="keyword">WHERE</span> job_id <span class="operator">=</span> <span class="string">&#x27;IT_PROG&#x27;</span>)</span><br><span class="line"><span class="keyword">AND</span> job_id <span class="operator">&lt;&gt;</span> <span class="string">&#x27;IT_PROG&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><strong>题目：查询平均工资最低的部门id</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> department_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id </span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">AVG</span>(salary) <span class="operator">&lt;=</span> <span class="keyword">ALL</span>(</span><br><span class="line">        <span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary)</span><br><span class="line">        <span class="keyword">FROM</span> employees</span><br><span class="line">        <span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id);</span><br></pre></td></tr></table></figure>

<h2 id="相关子查询执行流程"><a href="#相关子查询执行流程" class="headerlink" title="相关子查询执行流程"></a>相关子查询执行流程</h2><p>相关子查询就是, 子查询中引用了外部表, 比如, 我们想查员工中工资大于本部门平均工资的员工, department_id &#x3D; e.<code>department_id</code>,</p>
<p> 我们每计算一行的时候, 外部查询产生的结果集都会发生变化, 这个时候对应的子查询也需要重复计算一次, 因为它引用了外部表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column1, column2, ...</span><br><span class="line"><span class="keyword">FROM</span> <span class="operator">&lt;</span>table1<span class="operator">&gt;</span> <span class="keyword">outer</span></span><br><span class="line"><span class="keyword">WHERE</span> column1 operator</span><br><span class="line">					(<span class="keyword">SELECT</span> column1, column2</span><br><span class="line">                    	<span class="keyword">FROM</span> <span class="operator">&lt;</span>table2<span class="operator">&gt;</span></span><br><span class="line">                    	<span class="keyword">WHERE</span> expr1 <span class="operator">=</span> </span><br><span class="line">                    				outer.expr2)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这里的outer是&lt;table1&gt; 的别名</p>
</blockquote>
<p><strong>题目：查询员工中工资大于本部门平均工资的员工的last_name,salary和其department_id</strong></p>
<p>使用相关子查询</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, salary, department_id</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">WHERE</span> e.salary <span class="operator">&gt;</span> </span><br><span class="line">            (<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary)</span><br><span class="line">            <span class="keyword">FROM</span> employees</span><br><span class="line">            <span class="keyword">WHERE</span>  department_id <span class="operator">=</span> e.`department_id`);</span><br></pre></td></tr></table></figure>

<p>FROM中使用子查询</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, salary, e1.department_id</span><br><span class="line"><span class="keyword">FROM</span> employees e1, (<span class="keyword">SELECT</span> department_id, <span class="built_in">AVG</span>(salary) dept_avg_sal <span class="keyword">FROM</span> employees <span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id) e2</span><br><span class="line"><span class="keyword">WHERE</span> e1.`department_id` <span class="operator">=</span> e2.department_id</span><br><span class="line"><span class="keyword">AND</span> e2.dept_avg_sal <span class="operator">&lt;</span> e1.`salary`;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>FROM型的子查询: 子查询是作为FROM的一部分, 子查询要用()引起来, 并且要给这个子查询取别名, 把它当成一张”临时的虚拟的表”来使用</p>
</blockquote>
<p>在ORDER BY中使用子查询:</p>
<p><strong>题目：查询员工的id,salary,按照department_name 排序</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, salary</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> (</span><br><span class="line">          <span class="keyword">SELECT</span> department_name</span><br><span class="line">          <span class="keyword">FROM</span> departments d</span><br><span class="line">          <span class="keyword">WHERE</span> e.`department_id` <span class="operator">=</span> d.`department_id`</span><br><span class="line">) <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<p><strong>题目：若employees表中employee_id与job_history表中employee_id相同的数目不小于2，输出这些相同</strong></p>
<p><strong>id的员工的employee_id,last_name和其job_id</strong> </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> e.employee_id, last_name, e.job_id</span><br><span class="line"><span class="keyword">FROM</span> employees e </span><br><span class="line"><span class="keyword">WHERE</span> <span class="number">2</span> <span class="operator">&lt;=</span> (<span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) num <span class="keyword">FROM</span> job_history j <span class="keyword">WHERE</span> j.`employee_id` <span class="operator">=</span> e.`employee_id`);</span><br></pre></td></tr></table></figure>

<h3 id="EXISTS-与-NOT-EXISTS关键字"><a href="#EXISTS-与-NOT-EXISTS关键字" class="headerlink" title="EXISTS 与 NOT EXISTS关键字"></a>EXISTS 与 NOT EXISTS关键字</h3><ul>
<li>关联子查询通常也会和 EXISTS 操作符一起使用, 用来检查在子查询中是否存在满足条件的行</li>
<li><strong>如果在子查询中不存在满足条件的行:</strong><ul>
<li>返回FALSE</li>
<li>继续在子查询中查找</li>
</ul>
</li>
<li><strong>如果在子查询中存在满足条件的行:</strong><ul>
<li>不在子查询中继续查找</li>
<li>条件返回TRUE</li>
</ul>
</li>
<li>NOT EXISTS关键字表示如果不存在某种条件, 则返回TRUE, 否则返回FALSE</li>
</ul>
<p><strong>题目：查询公司管理者的employee_id，last_name，job_id，department_id信息</strong></p>
<p>方式一:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, job_id, department_id</span><br><span class="line"><span class="keyword">FROM</span> employees e1</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">EXISTS</span> (<span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line">            <span class="keyword">FROM</span> employees e2</span><br><span class="line">            <span class="keyword">WHERE</span> e1.`employee_id` <span class="operator">=</span> e2.`manager_id`);</span><br></pre></td></tr></table></figure>

<p>方式二:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> e1.employee_id, e1.last_name, e1.job_id, e1.department_id</span><br><span class="line"><span class="keyword">FROM</span> employees e1 <span class="keyword">JOIN</span> employees e2</span><br><span class="line"><span class="keyword">WHERE</span> e1.`manager_id` <span class="operator">=</span> e2.`employee_id`</span><br></pre></td></tr></table></figure>

<p>方式三:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> e1.employee_id, e1.last_name, e1.job_id, e1.department_id</span><br><span class="line"><span class="keyword">FROM</span> employees e1 </span><br><span class="line"><span class="keyword">WHERE</span> employee_id <span class="keyword">IN</span> (</span><br><span class="line">                <span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> manager_id</span><br><span class="line">                <span class="keyword">FROM</span> employees</span><br><span class="line">                );</span><br></pre></td></tr></table></figure>

<p><strong>题目：查询departments表中，不存在于employees表中的部门的department_id和department_name</strong> </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> department_id, department_name</span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> (<span class="keyword">SELECT</span> <span class="number">1</span></span><br><span class="line">                    <span class="keyword">FROM</span> employees e</span><br><span class="line">                    <span class="keyword">WHERE</span> e.`department_id` <span class="operator">=</span> d.`department_id`);</span><br></pre></td></tr></table></figure>

<h3 id="相关更新"><a href="#相关更新" class="headerlink" title="相关更新"></a>相关更新</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> <span class="operator">&lt;</span>table1<span class="operator">&gt;</span> alias1</span><br><span class="line"><span class="keyword">SET</span>		<span class="keyword">column</span> <span class="operator">=</span> (<span class="keyword">SELECT</span> expression</span><br><span class="line">                 <span class="keyword">FROM</span> <span class="operator">&lt;</span>table2<span class="operator">&gt;</span> <span class="operator">&lt;</span>alias2<span class="operator">&gt;</span></span><br><span class="line">                 <span class="keyword">WHERE</span> alias1.column <span class="operator">=</span> alias2.column)</span><br></pre></td></tr></table></figure>

<p>使用相关子查询一个表中的数据更新另一个表的数据</p>
<p><strong>题目：在employees中增加一个department_name字段，数据为员工对应的部门名称</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">1</span>)</span><br><span class="line"><span class="keyword">ALTER TABLE</span> employees</span><br><span class="line"><span class="keyword">ADD</span>(department_name VARCHAR2(<span class="number">14</span>));</span><br><span class="line"></span><br><span class="line"># <span class="number">2</span>)</span><br><span class="line"><span class="keyword">UPDATE</span> employees e</span><br><span class="line"><span class="keyword">SET</span>  department_name <span class="operator">=</span> (<span class="keyword">SELECT</span> department_name</span><br><span class="line">                        <span class="keyword">FROM</span> departments d</span><br><span class="line">                        <span class="keyword">WHERE</span> e.`department_id` <span class="operator">=</span> d.`department_id`);</span><br></pre></td></tr></table></figure>

<h3 id="相关删除"><a href="#相关删除" class="headerlink" title="相关删除"></a>相关删除</h3><p>….</p>
<h2 id="思考题"><a href="#思考题" class="headerlink" title="思考题"></a>思考题</h2><p>自连接和子查询哪个更好</p>
<p>自连接方式好</p>
<p>题目中可以使用子查询，也可以使用自连接。一般情况建议你使用自连接，因为在许多 DBMS 的处理过</p>
<p>程中，对于自连接的处理速度要比子查询快得多。</p>
<p>可以这样理解：子查询实际上是通过未知表进行查询后的条件判断，而自连接是通过已知的自身数据表</p>
<p>进行条件判断，因此在大部分 DBMS 中都对自连接处理进行了优化。</p>
<h2 id="作业-4"><a href="#作业-4" class="headerlink" title="作业"></a>作业</h2><blockquote>
<p>每个派生表都必须有自己的别名</p>
<p>派生表(Derived table): 这是指在SQL查询中通过子查询创建的临时表。它不是数据库中实际存在的表,而是查询过程中临时生成的结果集。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">1</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name, salary</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="operator">=</span> </span><br><span class="line">            (<span class="keyword">SELECT</span> department_id</span><br><span class="line">              <span class="keyword">FROM</span> employees</span><br><span class="line">              <span class="keyword">WHERE</span> last_name <span class="operator">=</span> <span class="string">&#x27;Zlotkey&#x27;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">2</span></span><br><span class="line"><span class="keyword">SELECT</span> salary, employee_id, last_name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> (</span><br><span class="line">            <span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary)</span><br><span class="line">            <span class="keyword">FROM</span> employees</span><br><span class="line">            );</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">3</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name, job_id, salary</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> <span class="keyword">ALL</span> (</span><br><span class="line">                <span class="keyword">SELECT</span> salary</span><br><span class="line">                <span class="keyword">FROM</span> employees</span><br><span class="line">                <span class="keyword">WHERE</span> job_id <span class="operator">=</span> <span class="string">&#x27;SA_MAN&#x27;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">4</span></span><br><span class="line"><span class="keyword">SELECT</span> employee_id, last_name </span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="keyword">IN</span> </span><br><span class="line">            (<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> department_id</span><br><span class="line">            <span class="keyword">FROM</span> employees</span><br><span class="line">            <span class="keyword">WHERE</span>  last_name REGEXP <span class="string">&#x27;[u]&#x27;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">5</span></span><br><span class="line"><span class="keyword">SELECT</span> employee_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="operator">=</span> <span class="keyword">ANY</span>(</span><br><span class="line">            <span class="keyword">SELECT</span> department_id</span><br><span class="line">            <span class="keyword">FROM</span> departments</span><br><span class="line">            <span class="keyword">WHERE</span> location_id <span class="operator">=</span> <span class="number">1700</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">6</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name, salary, manager_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> manager_id <span class="keyword">IN</span> (</span><br><span class="line">            <span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> employee_id</span><br><span class="line">            <span class="keyword">FROM</span> employees</span><br><span class="line">            <span class="keyword">WHERE</span> last_name <span class="operator">=</span> <span class="string">&#x27;King&#x27;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">7</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">=</span> (</span><br><span class="line">            <span class="keyword">SELECT</span> <span class="built_in">MIN</span>(salary)</span><br><span class="line">            <span class="keyword">FROM</span> employees);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">8</span></span><br><span class="line"><span class="keyword">SELECT</span> department_id ,department_name</span><br><span class="line"><span class="keyword">FROM</span> departments</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="operator">=</span> (</span><br><span class="line">        <span class="keyword">SELECT</span> department_id </span><br><span class="line">        <span class="keyword">FROM</span> employees</span><br><span class="line">        <span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line">        <span class="keyword">HAVING</span> <span class="built_in">AVG</span>(salary) <span class="operator">&lt;=</span> <span class="keyword">ALL</span> </span><br><span class="line">                    (<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary)</span><br><span class="line">                        <span class="keyword">FROM</span> employees</span><br><span class="line">                        <span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id)</span><br><span class="line">            );</span><br><span class="line">                </span><br><span class="line"># 方式<span class="number">2</span>: </span><br><span class="line"><span class="keyword">SELECT</span> department_id ,department_name</span><br><span class="line"><span class="keyword">FROM</span> departments</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="operator">=</span> (</span><br><span class="line">        <span class="keyword">SELECT</span> department_id </span><br><span class="line">        <span class="keyword">FROM</span> employees</span><br><span class="line">        <span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line">        <span class="keyword">HAVING</span> <span class="built_in">AVG</span>(salary) <span class="operator">=</span> </span><br><span class="line">                    (<span class="keyword">SELECT</span> <span class="built_in">MIN</span>(dept_avgsal)</span><br><span class="line">                        <span class="keyword">FROM</span> (</span><br><span class="line">                            <span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary) dept_avgsal</span><br><span class="line">                            <span class="keyword">FROM</span> employees</span><br><span class="line">                            <span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id) avg_sal</span><br><span class="line">                            )</span><br><span class="line">            );</span><br><span class="line">        </span><br><span class="line"># 方式<span class="number">3</span>:</span><br><span class="line"><span class="keyword">SELECT</span> d.<span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> departments d, (</span><br><span class="line">        <span class="keyword">SELECT</span> department_id, <span class="built_in">AVG</span>(salary) avg_sal</span><br><span class="line">        <span class="keyword">FROM</span> employees</span><br><span class="line">        <span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line">        <span class="keyword">ORDER</span> <span class="keyword">BY</span> avg_sal</span><br><span class="line">        LIMIT <span class="number">0</span>,<span class="number">1</span>) dept_avg_sal</span><br><span class="line"><span class="keyword">WHERE</span> d.`department_id` <span class="operator">=</span> dept_avg_sal.department_id;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">9</span></span><br><span class="line"><span class="keyword">SELECT</span> d.<span class="operator">*</span>, (<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary) <span class="keyword">FROM</span> employees e <span class="keyword">WHERE</span> e.department_id <span class="operator">=</span> d.department_id) </span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="operator">=</span> (</span><br><span class="line">        <span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> department_id</span><br><span class="line">        <span class="keyword">FROM</span> employees e</span><br><span class="line">        <span class="keyword">WHERE</span> e.`department_id` <span class="operator">=</span> d.`department_id`</span><br><span class="line">        <span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line">        <span class="keyword">HAVING</span> <span class="built_in">AVG</span>(e.`salary`) <span class="operator">=</span> (</span><br><span class="line">            <span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary) avgasl</span><br><span class="line">            <span class="keyword">FROM</span> employees</span><br><span class="line">            <span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line">            <span class="keyword">ORDER</span> <span class="keyword">BY</span> avgasl</span><br><span class="line">            LIMIT <span class="number">0</span>,<span class="number">1</span>));</span><br><span class="line">            </span><br><span class="line"># 方式<span class="number">2</span>: </span><br><span class="line"><span class="keyword">SELECT</span> d.<span class="operator">*</span>, (<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary) <span class="keyword">FROM</span> employees e <span class="keyword">WHERE</span> e.department_id <span class="operator">=</span> d.department_id) </span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="operator">=</span> (</span><br><span class="line">        <span class="keyword">SELECT</span> department_id</span><br><span class="line">        <span class="keyword">FROM</span> employees e</span><br><span class="line">        <span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line">        <span class="keyword">HAVING</span> <span class="built_in">AVG</span>(e.`salary`) <span class="operator">=</span> (</span><br><span class="line">            <span class="keyword">SELECT</span> <span class="built_in">MIN</span>(dept_avgsal)</span><br><span class="line">            <span class="keyword">FROM</span> (</span><br><span class="line">                <span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary) dept_avgsal</span><br><span class="line">                <span class="keyword">FROM</span> employees</span><br><span class="line">                <span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line">                )  avg_sal</span><br><span class="line">            ) </span><br><span class="line">        );</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">10</span></span><br><span class="line"><span class="keyword">SELECT</span> job_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> job_id <span class="operator">=</span> (</span><br><span class="line">        <span class="keyword">SELECT</span> job_id</span><br><span class="line">        <span class="keyword">FROM</span> employees</span><br><span class="line">        <span class="keyword">GROUP</span> <span class="keyword">BY</span> job_id</span><br><span class="line">        <span class="keyword">HAVING</span> <span class="built_in">AVG</span>(salary) <span class="operator">=</span> (</span><br><span class="line">            <span class="keyword">SELECT</span> <span class="built_in">MAX</span>(job_avgsal)</span><br><span class="line">            <span class="keyword">FROM</span> (</span><br><span class="line">                <span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary) job_avgsal</span><br><span class="line">                <span class="keyword">FROM</span> employees</span><br><span class="line">                <span class="keyword">GROUP</span> <span class="keyword">BY</span>  job_id</span><br><span class="line">            ) avg_sal</span><br><span class="line">        )</span><br><span class="line">    );</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">11</span></span><br><span class="line"><span class="keyword">SELECT</span> department_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="keyword">IS</span> <span class="keyword">NOT NULL</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">AVG</span>(salary) <span class="operator">&gt;</span> (</span><br><span class="line">        <span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary)</span><br><span class="line">        <span class="keyword">FROM</span> employees);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">12</span></span><br><span class="line"><span class="keyword">SELECT</span> department_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="keyword">IS</span> <span class="keyword">NOT NULL</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">AVG</span>(salary) <span class="operator">&gt;</span> (</span><br><span class="line">        <span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary)</span><br><span class="line">        <span class="keyword">FROM</span> employees);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">13</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MIN</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line"><span class="keyword">HAVING</span> department_id <span class="operator">=</span> (</span><br><span class="line">        <span class="keyword">SELECT</span> department_id</span><br><span class="line">        <span class="keyword">FROM</span> employees</span><br><span class="line">        <span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line">        <span class="keyword">HAVING</span> <span class="built_in">MAX</span>(salary) <span class="operator">=</span> (</span><br><span class="line">                <span class="keyword">SELECT</span> <span class="built_in">MIN</span>(max_sal) </span><br><span class="line">                <span class="keyword">FROM</span> (</span><br><span class="line">                    <span class="keyword">SELECT</span> <span class="built_in">MAX</span>(salary) max_sal</span><br><span class="line">                    <span class="keyword">FROM</span> employees</span><br><span class="line">                    <span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line">                ) max_sal</span><br><span class="line">            )</span><br><span class="line">        );</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">14</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name, department_id, email, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> employee_id <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> manager_id</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">WHERE</span> department_id <span class="operator">=</span> (</span><br><span class="line">        <span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> department_id</span><br><span class="line">        <span class="keyword">FROM</span> employees</span><br><span class="line">        <span class="keyword">WHERE</span> manager_id <span class="keyword">IS</span> <span class="keyword">NOT NULL</span></span><br><span class="line">        <span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line">        <span class="keyword">HAVING</span> department_id <span class="operator">=</span> (</span><br><span class="line">            <span class="keyword">SELECT</span> department_id</span><br><span class="line">            <span class="keyword">FROM</span> employees</span><br><span class="line">            <span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line">            <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="built_in">AVG</span>(salary) <span class="keyword">DESC</span></span><br><span class="line">            LIMIT <span class="number">0</span>,<span class="number">1</span></span><br><span class="line">        )</span><br><span class="line">    )</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"># 方式<span class="number">2</span>:</span><br><span class="line"><span class="keyword">SELECT</span> last_name, department_id, email, salary</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">WHERE</span>  employee_id <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> manager_id</span><br><span class="line">    <span class="keyword">FROM</span> employees e, (</span><br><span class="line">        <span class="keyword">SELECT</span> department_id, <span class="built_in">AVG</span>(salary) avg_sal</span><br><span class="line">        <span class="keyword">FROM</span> employees</span><br><span class="line">        <span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line">        <span class="keyword">ORDER</span> <span class="keyword">BY</span> avg_sal <span class="keyword">DESC</span></span><br><span class="line">        LIMIT <span class="number">0</span>,<span class="number">1</span></span><br><span class="line">        )dept_avg_sal</span><br><span class="line">    <span class="keyword">WHERE</span> dept_avg_sal.department_id <span class="operator">=</span> e.department_id</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">18</span></span><br><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, salary</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary) avg_sal</span><br><span class="line">    <span class="keyword">FROM</span> employees e1</span><br><span class="line">    <span class="keyword">WHERE</span> e.`department_id` <span class="operator">=</span> e1.`department_id`</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h1 id="创建和管理表"><a href="#创建和管理表" class="headerlink" title="创建和管理表"></a>创建和管理表</h1><h2 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h2><h3 id="一条数据的存储过程"><a href="#一条数据的存储过程" class="headerlink" title="一条数据的存储过程"></a>一条数据的存储过程</h3><ul>
<li>创建数据库 -&gt; 确认字段 -&gt; 创建数据表  -&gt; 插入数据</li>
<li>从系统架构来看 : <code>数据库服务器</code> -&gt; <code>数据库</code>  -&gt; <code>数据表的行与列</code></li>
</ul>
<h3 id="标识符命名规则"><a href="#标识符命名规则" class="headerlink" title="标识符命名规则"></a>标识符命名规则</h3><ul>
<li>数据库名, 表名不得超过30个字符, 变量名限制为29个</li>
<li>不能有重名现象</li>
<li>保证字段名和类型的一致性</li>
</ul>
<h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3><table>
<thead>
<tr>
<th>类型</th>
<th>类型举例</th>
</tr>
</thead>
<tbody><tr>
<td>整数类型</td>
<td>TINYINT, SMALLINT, MEDIUMINT, INT(或INTERGER), BIGINT</td>
</tr>
<tr>
<td>浮点类型</td>
<td>FLOAT, DOUBLE</td>
</tr>
<tr>
<td>定点数类型</td>
<td>DECIMAL</td>
</tr>
<tr>
<td>位类型</td>
<td>BIT</td>
</tr>
<tr>
<td>日期时间类型</td>
<td>YEAR, TIME, DATE, DATETIME, TIMESTAMP</td>
</tr>
<tr>
<td>文本字符串类型</td>
<td>CHAR, VARCHAR, TINYTEXT, TEXT, MEDIUMTEXT, LONGTEXT</td>
</tr>
<tr>
<td>枚举类型</td>
<td>ENUM</td>
</tr>
<tr>
<td>集合类型</td>
<td>SET</td>
</tr>
<tr>
<td>二进制字符串类型</td>
<td>BINARY, VARBINARY, TINYBLOB, MEDIUMBLOB, LONGBLOB</td>
</tr>
<tr>
<td>JSON类型</td>
<td>JSON对象, JSON数组</td>
</tr>
<tr>
<td>空间数据类型</td>
<td>单值：GEOMETRY、POINT、LINESTRING、POLYGON；集合：MULTIPOINT、MULTILINESTRING、GEOMETRYCOLLECTION</td>
</tr>
</tbody></table>
<p>常用数据类型</p>
<table>
<thead>
<tr>
<th>数据类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>INT</td>
<td>从-2^31 ~ 2^31-1的整数类型, 存储大小位4个字节</td>
</tr>
<tr>
<td>CHAR(size)</td>
<td>定长字符类型, 若未指定, 默认为1个字符, 最大长度为2</td>
</tr>
<tr>
<td>VARCHAR(size)</td>
<td>可变长字符数据, 根据字符串实际长度保存, 必须指定长度</td>
</tr>
<tr>
<td>FLOAT(M,D)</td>
<td>单精度, 占用4个字节, M&#x3D;整数位+小数位, D&#x3D;小数位. D&lt;&#x3D;M&lt;&#x3D;255, 0&lt;&#x3D;D&lt;&#x3D;30, 默认M+D&lt;&#x3D;6</td>
</tr>
<tr>
<td>DOUBLE(M,D)</td>
<td>双精度, 占用8个字节, D&lt;&#x3D;M&lt;&#x3D;255, 0&lt;&#x3D;D&lt;&#x3D;30, 默认M+D&lt;&#x3D;15</td>
</tr>
<tr>
<td>DECIMAL(M,D)</td>
<td>高精度小数, 占用M+2个字节, D&lt;&#x3D;M&lt;&#x3D;65, 0&lt;&#x3D;D&lt;&#x3D;30, 最大取值范围和DOUBLE相同</td>
</tr>
<tr>
<td>DATE</td>
<td>日期类型, 格式’YYYY-MM-DD’</td>
</tr>
<tr>
<td>BLOB</td>
<td>二进制形式的长文本数据, 最大可达4G</td>
</tr>
<tr>
<td>TEXT</td>
<td>长文本数据, 最大可达4G</td>
</tr>
</tbody></table>
<h2 id="创建和管理数据库"><a href="#创建和管理数据库" class="headerlink" title="创建和管理数据库"></a>创建和管理数据库</h2><h3 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 创建数据库</span><br><span class="line"><span class="keyword">CREATE</span> DATABASE 数据库名;</span><br><span class="line"></span><br><span class="line"># 创建数据库, 并指定使用的字符集</span><br><span class="line"><span class="keyword">CREATE</span> DATABASE 数据库名 <span class="keyword">CHARACTER SET</span> 字符集;</span><br><span class="line"></span><br><span class="line"># 判断数据库是否存在,如果不存在则创建数据库</span><br><span class="line"><span class="keyword">CREATE</span> DATABASE IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> 数据库名;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意: DATABASE不能改名, 一些可视化工具可以改名, 它是建立新库, 把所有的表复制到新库, 再删去原先的库</p>
</blockquote>
<h3 id="使用数据库"><a href="#使用数据库" class="headerlink" title="使用数据库"></a>使用数据库</h3><ul>
<li><p>查看当前所有的数据库</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> DATABASES;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看当前正在使用的数据库</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> DATABASE():</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看指定库下所有的表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> TABLES <span class="keyword">FROM</span> 数据库名;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看数据库的创建信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> DATABASE 数据库名;</span><br><span class="line"># 或者</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> DATABASE 数据库名\G</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用&#x2F;切换数据库</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">USE 数据库名;</span><br></pre></td></tr></table></figure></li>
</ul>
<blockquote>
<p>操作表和数据之前需要指定数据库, 否则就要对所有对象加上”数据库名”</p>
</blockquote>
<h3 id="修改数据库"><a href="#修改数据库" class="headerlink" title="修改数据库"></a>修改数据库</h3><ul>
<li>更改数据库字符集<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> DATABASE 数据库名 <span class="keyword">CHARACTER SET</span> 字符集; # 比如: gbk, utf8等</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="删除数据库"><a href="#删除数据库" class="headerlink" title="删除数据库"></a>删除数据库</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> DATABASE 数据库名;</span><br><span class="line"></span><br><span class="line"># 推荐</span><br><span class="line"><span class="keyword">DROP</span> DATABASE IF <span class="keyword">EXISTS</span> 数据库名;</span><br></pre></td></tr></table></figure>

<h2 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h2><h3 id="创建方式"><a href="#创建方式" class="headerlink" title="创建方式"></a>创建方式</h3><ul>
<li>创建表的前提 :<ul>
<li>CRAETE TABLE权限</li>
<li>存储空间</li>
</ul>
</li>
<li>语法格式:</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> [IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span>] 表名(</span><br><span class="line">	字段<span class="number">1</span>, 数据类型 [约束条件] [默认值],</span><br><span class="line">    ....</span><br><span class="line">    [表约束条件]</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<ul>
<li>必须指定:<ul>
<li>表名</li>
<li>字段名, 数据类型, 长度</li>
</ul>
</li>
<li>可选指定<ul>
<li>约束条件</li>
<li>默认值</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> emp(</span><br><span class="line">    emp_id <span class="type">INT</span>,</span><br><span class="line">    emp_name <span class="type">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">    salary <span class="keyword">DOUBLE</span>,</span><br><span class="line">    birthday <span class="type">DATE</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">DESC</span> emp;a</span><br></pre></td></tr></table></figure>

<blockquote>
<p>可以将id字段设置为INT(11), 这里的11实际上是INT类型指定的显示类型, 默认为11, 创建时可以使用INT(2)指定显示宽度</p>
<p>这个属性在8.x版本后不再被推荐使用, 少用</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> dept(</span><br><span class="line">    <span class="comment">-- int类型, 自增</span></span><br><span class="line">    deptno <span class="type">INT</span>(<span class="number">2</span>) AUTO_INCREMENT,</span><br><span class="line">    dname <span class="type">VARCHAR</span>(<span class="number">14</span>),</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 主键</span></span><br><span class="line">    <span class="keyword">PRIMARY KEY</span> (deptno)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">DESC</span> dept;</span><br></pre></td></tr></table></figure>

<h3 id="创建方式2"><a href="#创建方式2" class="headerlink" title="创建方式2"></a>创建方式2</h3><ul>
<li>使用AS subquery选项, 将创建表和插入数据结合起来</li>
<li>指定的列和子查询种的列要一一对应</li>
<li>通过列名和默认值定义列</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> emp1 <span class="keyword">AS</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE TABLE</span> emp2 <span class="keyword">AS</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> <span class="number">1</span><span class="operator">=</span><span class="number">2</span>; <span class="comment">-- 创建的emp2是空表</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> dept80 </span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, salary<span class="operator">*</span><span class="number">12</span> ANNSAL, hire_date </span><br><span class="line"><span class="keyword">FROM</span> employees </span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="operator">=</span> <span class="number">80</span>;</span><br></pre></td></tr></table></figure>

<h3 id="查看数据表结构"><a href="#查看数据表结构" class="headerlink" title="查看数据表结构"></a>查看数据表结构</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE TABLE</span> 表名\G</span><br><span class="line"></span><br><span class="line"><span class="keyword">DESC</span> 表名;</span><br></pre></td></tr></table></figure>

<p>使用SHOW CREATE TABLE语句不仅能看到表创建时的详细语句, 还可以查看存储引擎和字符编码</p>
<h2 id="修改表"><a href="#修改表" class="headerlink" title="修改表"></a>修改表</h2><p>使用ALTER TABLE语句能做到</p>
<ul>
<li>向已有的表中添加列</li>
<li>修改现有表中的列</li>
<li>删除现有表中的列</li>
<li>重命名现有表中的列</li>
</ul>
<h3 id="追加一个列"><a href="#追加一个列" class="headerlink" title="追加一个列"></a>追加一个列</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> 表名 <span class="keyword">ADD</span> [<span class="keyword">column</span>] 字段名 字段类型 [<span class="keyword">FIRST</span><span class="operator">|</span>AFTER字段名] ;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> DEPT80</span><br><span class="line"><span class="keyword">ADD</span> job_id <span class="type">varchar</span>(<span class="number">15</span>);	</span><br></pre></td></tr></table></figure>

<h3 id="修改一个列"><a href="#修改一个列" class="headerlink" title="修改一个列"></a>修改一个列</h3><ul>
<li>修改列的数据类型, 长度, 默认值和位置</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> 表名, MODIFY [<span class="keyword">COLUMN</span>] 字段名<span class="number">1</span> 字段类型 [<span class="keyword">DEFAULT</span>] [<span class="keyword">FIRST</span><span class="operator">|</span>AFTER 字段名<span class="number">2</span>]</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> dept80</span><br><span class="line">MODIFY salary <span class="keyword">DOUBLE</span>(<span class="number">9</span>,<span class="number">2</span>) <span class="keyword">DEFAULT</span> <span class="number">1000</span>; </span><br></pre></td></tr></table></figure>

<ul>
<li>对默认值的修改, 只影响今后对表的修改</li>
<li>这种方式还能修改列的约束</li>
</ul>
<h3 id="重命名一个列"><a href="#重命名一个列" class="headerlink" title="重命名一个列"></a>重命名一个列</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> 表名</span><br><span class="line">CHANGE 列名 新列名 新数据类型</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> dept80</span><br><span class="line">CHANGE last_name dept_name <span class="type">VARCHAR</span>(<span class="number">15</span>);</span><br></pre></td></tr></table></figure>

<h3 id="删除一个列"><a href="#删除一个列" class="headerlink" title="删除一个列"></a>删除一个列</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> 表名 <span class="keyword">DROP</span> [<span class="keyword">COLUMN</span>] 字段名</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> dept80</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">COLUMN</span> salary;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>COLUMN是可选项, 可以写也可以不写</p>
</blockquote>
<h2 id="重命名表"><a href="#重命名表" class="headerlink" title="重命名表"></a>重命名表</h2><ul>
<li><p>方式一 : 使用RENAME</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RENAME <span class="keyword">TABLE</span> emp</span><br><span class="line"><span class="keyword">TO</span> myemp;</span><br></pre></td></tr></table></figure>
</li>
<li><p>方式二:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> dept</span><br><span class="line">RENAME  [<span class="keyword">TO</span>] detail_dept;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="删除表"><a href="#删除表" class="headerlink" title="删除表"></a>删除表</h2><ul>
<li><p>当一张数据表<code>没有与其他任何数据表形成关联关系</code>时, 可以将当前数据表直接删除</p>
</li>
<li><p>数据和结构都被删除</p>
</li>
<li><p>所有正在运行的相关事务被提交</p>
</li>
<li><p>所有相关索引被删除</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> [IF <span class="keyword">EXISTS</span>]  数据表<span class="number">1</span>, 数据表<span class="number">2</span> ,....</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除语句不能回滚</p>
</li>
</ul>
<h2 id="清空表"><a href="#清空表" class="headerlink" title="清空表"></a>清空表</h2><ul>
<li>TRUNCATE TABLE语句<ul>
<li>删除表中的所有数据</li>
<li>释放表的存储空间</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> detail_dept</span><br></pre></td></tr></table></figure>

<ul>
<li>TRUNCATE语句不能回滚, 而使用DELETE语句删除数据, 可以回滚</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> autocommit <span class="operator">=</span> <span class="literal">FALSE</span>; </span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> emp2; </span><br><span class="line">#<span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> emp2; </span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp2; </span><br><span class="line"><span class="keyword">ROLLBACK</span>; </span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp2;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>阿里开发规范:</p>
<p>[参考] TRUNCATE TABLE 比 DELETE 速度快, 且使用的系统和事务日志资源少, 但是TRUNCATE无事务, 且不触发 TRIGGER, 有可能造成事故, 故不建议在开发代码中使用次语句</p>
</blockquote>
<h2 id="内容拓展"><a href="#内容拓展" class="headerlink" title="内容拓展"></a>内容拓展</h2><h3 id="阿里巴巴开发手册之MySQL字段命名"><a href="#阿里巴巴开发手册之MySQL字段命名" class="headerlink" title="阿里巴巴开发手册之MySQL字段命名"></a>阿里巴巴开发手册之MySQL字段命名</h3><ul>
<li>[强制] 表名字段名, 必须小写字母和数字, 禁止出现数字开头, 禁止两个下划线中间只出现数字</li>
<li>[强制] 禁止使用保留字</li>
<li>[强制] 表必备三字段: id, gmt_create, gmt_modified<ul>
<li>其中id必为主键, 类型为BIGINT UNSIGNED, 单表时自增, 步长为1. gmt_create, gmt_modified 类型必须为DATETIME类型, 前者现在时表示主动式创建, 后者过去分词表示被动式更新</li>
</ul>
</li>
<li>[推荐] 表的命名最好是遵守 “业务名称_表的作用”</li>
<li>[推荐] 库名和应用名称尽量一致</li>
</ul>
<h3 id="如何理解清空表-删除表等操作需谨慎"><a href="#如何理解清空表-删除表等操作需谨慎" class="headerlink" title="如何理解清空表, 删除表等操作需谨慎"></a>如何理解清空表, 删除表等操作需谨慎</h3><p>MySQL删除表的时候, 不会有任何确认信息, 因此执行删除操作时应当慎重, 在删除表钱, 最好对表的数据进行备份, 这样能有利于数据的恢复, 避免造成无法挽回的后果</p>
<p>在使用<strong>ALTER TABLE</strong> 进行表的基本修改操作时, 在执行操作过程之前, 也应该确保对数据进行<strong>完整的备份</strong>, 因为数据的改变时<strong>无法撤销</strong>的. </p>
<h3 id="MySQL8新特性-DDL原子化"><a href="#MySQL8新特性-DDL原子化" class="headerlink" title="MySQL8新特性-DDL原子化"></a>MySQL8新特性-DDL原子化</h3><p>DDL操作要么成功, 要么回滚</p>
<p>比如我现在要删除book1, book2两张表, 但是后一张表是不存在的, 我现在执行<code>DROP TABLE book1, book2</code>, MySQL5.7就会执行后报错, 但是仍然删除了book1, 而MySQL8.x就会保留book1, 因为这是一次失败的操作, 会直接回滚</p>
<h2 id="作业-5"><a href="#作业-5" class="headerlink" title="作业"></a>作业</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">1</span></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE test02_market;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> DATABASE();</span><br><span class="line"></span><br><span class="line">USE test02_market;</span><br><span class="line"></span><br><span class="line"># <span class="number">2</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> customers(</span><br><span class="line">    c_num <span class="type">INT</span>,</span><br><span class="line">    c_name <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    c_contact <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    c_city <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    c_birth <span class="type">DATE</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"># <span class="number">3</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> customers</span><br><span class="line">MODIFY c_contact <span class="type">VARCHAR</span>(<span class="number">50</span>) AFTER c_birth;</span><br><span class="line"></span><br><span class="line"># <span class="number">5</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> customers</span><br><span class="line">CHANGE c_contact c_phone <span class="type">VARCHAR</span>(<span class="number">50</span>);</span><br><span class="line"></span><br><span class="line"># <span class="number">6</span> </span><br><span class="line"><span class="keyword">ALTER TABLE</span> customers</span><br><span class="line"><span class="keyword">ADD</span> c_gender <span class="type">CHAR</span>(<span class="number">1</span>) AFTER c_name;</span><br><span class="line"></span><br><span class="line"># <span class="number">7</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> customers</span><br><span class="line">RENAME customers_info;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SHOW</span> TABLES;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DESC</span> customers_info;</span><br></pre></td></tr></table></figure>

<h1 id="数据处理之增删改"><a href="#数据处理之增删改" class="headerlink" title="数据处理之增删改"></a>数据处理之增删改</h1><h2 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a>插入数据</h2><h3 id="方式1-VALUES的方式增加数据"><a href="#方式1-VALUES的方式增加数据" class="headerlink" title="方式1: VALUES的方式增加数据"></a>方式1: VALUES的方式增加数据</h3><p>这种语法一次只能向表中插入一条数据, 即插入一行数据</p>
<p>情况1:  为表的<strong>所有字段</strong>按<strong>默认顺序</strong>插入数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT INTO</span> 表名</span><br><span class="line"><span class="keyword">VALUES</span> (value1, value2)</span><br></pre></td></tr></table></figure>

<p>值列表中需要为表的<strong>每一个字段指定值</strong>, 并且值的顺序必须和数据表中字段定义时的顺序相同</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT INTO</span> departments</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="number">280</span>, <span class="string">&#x27;Pub&#x27;</span>, <span class="number">100</span>, <span class="number">1700</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT INTO</span> departments</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="number">290</span>, <span class="string">&#x27;Finance&#x27;</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>);</span><br></pre></td></tr></table></figure>

<p>情况2 : 为表的<strong>指定字段</strong>插入数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT INTO</span> 表名 (column1, column2...)</span><br><span class="line"><span class="keyword">VALUES</span> (value1, ....)</span><br></pre></td></tr></table></figure>

<p>只为表的指定字段插入数据, INSERT语句只向部分字段插入值, 其他未指定的字段会填充上默认值</p>
<p>在INSERT子句中随意列出列名, 但是一旦列出, VALUES中要插入的value1,…valuen需要和column1,column2,…一一对应, 如果类型不同, 将无法插入</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT INTO</span> departments(department_id, department_name) </span><br><span class="line"><span class="keyword">VALUES</span> (<span class="number">80</span>, <span class="string">&#x27;IT&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>情况3: <strong>同时插入多条数据</strong></p>
<p>在VALUES子句上加上逗号即可</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT INTO</span> table_name</span><br><span class="line"><span class="keyword">VALUES</span> </span><br><span class="line">(value1 [,value2, …, valuen]), </span><br><span class="line">(value1 [,value2, …, valuen]),</span><br><span class="line">……</span><br><span class="line">(value1 [,value2, …, valuen]);</span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT INTO</span> table_name(column1 [, column2, …, columnn]) </span><br><span class="line"><span class="keyword">VALUES</span> </span><br><span class="line">(value1 [,value2, …, valuen]), </span><br><span class="line">(value1 [,value2, …, valuen]),</span><br><span class="line">……</span><br><span class="line">(value1 [,value2, …, valuen]);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">INSERT INTO</span> emp(emp_id,emp_name)</span><br><span class="line"><span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">VALUES</span> (<span class="number">1001</span>,<span class="string">&#x27;shkstart&#x27;</span>),</span><br><span class="line"><span class="operator">-</span><span class="operator">&gt;</span> (<span class="number">1002</span>,<span class="string">&#x27;atguigu&#x27;</span>),</span><br><span class="line"><span class="operator">-</span><span class="operator">&gt;</span> (<span class="number">1003</span>,<span class="string">&#x27;Tom&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>在使用INSERT插入多行数据的时候, MySQL会返回一些在执行单行插入的时候, 没有的额外的信息 </p>
<ul>
<li>Records: 表名插入的记录条数</li>
<li>Duplicates: 表明插入时被忽略的记录, 原因是这些记录包含了重复的主键</li>
<li>Warnings: 表明有问题的数据值, 例如发生了数据类型的转换</li>
</ul>
<blockquote>
<p>多行的INSERT语句在处理的过程中的 <strong>效率更高</strong>, 因为MySQL执行单条INSERT语句插入多行数据比使用多条INSERT语句快, 所以在插入多条记录时最好选择使用单挑INSERT语句的方式插入</p>
</blockquote>
<h3 id="方式2-将查询结果插入到表中"><a href="#方式2-将查询结果插入到表中" class="headerlink" title="方式2: 将查询结果插入到表中"></a>方式2: 将查询结果插入到表中</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT INTO</span> 表名</span><br><span class="line">(tar_column1, ...)</span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">(src_column1, ...)</span><br><span class="line"><span class="keyword">FROM</span> 源表名</span><br><span class="line">[WHRER <span class="keyword">condition</span>]</span><br></pre></td></tr></table></figure>

<ul>
<li>子查询的值列表应与INSERT子句中的列名对应</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT INTO</span> dept80 (employee_id, hire_date, job_id)</span><br><span class="line"><span class="keyword">SELECT</span> employee_id, hire_date, job_id</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<h2 id="更新数据-修改数据"><a href="#更新数据-修改数据" class="headerlink" title="更新数据 (修改数据)"></a>更新数据 (修改数据)</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> table_name</span><br><span class="line"><span class="keyword">SET</span> column1<span class="operator">=</span>value1, column2<span class="operator">=</span>value2,....</span><br><span class="line">[<span class="keyword">WHERE</span> <span class="keyword">condition</span>]</span><br></pre></td></tr></table></figure>

<ul>
<li>可以一次更新多条数据</li>
<li>如果需要回滚数据, 需要保证在DML之前, 进行设置: SET AUTOCOMMIT &#x3D; FALSE</li>
<li>使用WHERE指定需要更新的数据</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> employees</span><br><span class="line"><span class="keyword">SET</span> department_id <span class="operator">=</span> <span class="number">70</span></span><br><span class="line"><span class="keyword">WHERE</span> employee_id <span class="operator">=</span> <span class="number">113</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>如果忽略WHERE子句, 则表中的所有数据将被更新</p>
</li>
<li><p><strong>更新中的数据完整性错误</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> employees </span><br><span class="line"><span class="keyword">SET</span> department_id <span class="operator">=</span> <span class="number">55</span> </span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="operator">=</span> <span class="number">110</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>外键约束冲突</li>
<li>检查约束冲突</li>
<li>触发器问题</li>
<li>这些都是在更新数据的时候, 会导致数据完整性冲突的因素</li>
</ul>
</li>
</ul>
<h2 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> <span class="operator">&lt;</span>table_name<span class="operator">&gt;</span> [<span class="keyword">WHERE</span> <span class="operator">&lt;</span><span class="keyword">condition</span><span class="operator">&gt;</span>];</span><br></pre></td></tr></table></figure>

<p>table_name指定要执行删除操作的表, 如果没有WHERE子句, DELETE将删除表中的所有记录</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> departments</span><br><span class="line"><span class="keyword">WHERE</span> department_name <span class="operator">=</span> <span class="string">&#x27;Finance&#x27;</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>删除中的数据完整性错误</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> departments</span><br><span class="line"><span class="keyword">WHERE</span>		department_id <span class="operator">=</span> <span class="number">60</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">错误代码</span><br><span class="line">错误代码： <span class="number">1451</span></span><br><span class="line">Cannot <span class="keyword">delete</span> <span class="keyword">or</span> <span class="keyword">update</span> a parent <span class="type">row</span>: </span><br><span class="line">a <span class="keyword">foreign key</span> <span class="keyword">constraint</span> fails (`atguigudb`.`employees`, <span class="keyword">CONSTRAINT</span> `emp_dept_fk` </span><br><span class="line">                                <span class="keyword">FOREIGN KEY</span> (`department_id`) <span class="keyword">REFERENCES</span> `departments` (`department_id`))</span><br></pre></td></tr></table></figure>

<blockquote>
<p>说明: You cannot delete a row that contains a primary key that is used as a foreign key in another table</p>
</blockquote>
<h2 id="计算列"><a href="#计算列" class="headerlink" title="计算列"></a>计算列</h2><p>某一列的值是通过别的列计算得来的, 例如a列值为1, b列值为2, 那么c列值不需要手动赋值, 可以由c&#x3D;a+b计算得来, 这样的c列就是计算列</p>
<p>MySQL8.0中, CREATE TABLE和ALTER TABLE都支持计算列</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> tb1(</span><br><span class="line">	id <span class="type">INT</span>,</span><br><span class="line">    a <span class="type">INT</span>,</span><br><span class="line">    b <span class="type">INT</span>,</span><br><span class="line">    c <span class="type">INT</span> HENERATED ALWAYS <span class="keyword">AS</span> (a <span class="operator">+</span> b) VIRTUAL</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="作业-6"><a href="#作业-6" class="headerlink" title="作业"></a>作业</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE test01_library;</span><br><span class="line"></span><br><span class="line">USE test01_library;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE TABLE</span> books(</span><br><span class="line">    id <span class="type">INT</span>,</span><br><span class="line">    b_name <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    b_authors <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    price <span class="type">FLOAT</span>,</span><br><span class="line">    pubdate <span class="keyword">YEAR</span>,</span><br><span class="line">    note <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    num <span class="type">INT</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> books</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;Tal of AAA&#x27;</span>, <span class="string">&#x27;Dickes&#x27;</span>, <span class="number">23</span>, <span class="string">&#x27;1995&#x27;</span>, <span class="string">&#x27;novel&#x27;</span>, <span class="number">11</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> books (id, b_name, b_authors, price, pubdate, note, num)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="number">2</span>, <span class="string">&#x27;EmmaT&#x27;</span>, <span class="string">&#x27;Jane lura&#x27;</span>, <span class="number">35</span>, <span class="string">&#x27;1993&#x27;</span>, <span class="string">&#x27;joke&#x27;</span>, <span class="number">22</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> books</span><br><span class="line"><span class="keyword">VALUES</span> </span><br><span class="line">    (<span class="number">3</span>, <span class="string">&#x27;Stroy of Jane&#x27;</span>, <span class="string">&#x27;Jane Tim&#x27;</span>, <span class="number">40</span>, <span class="string">&#x27;2001&#x27;</span>, <span class="string">&#x27;novel&#x27;</span>, <span class="number">0</span>),</span><br><span class="line">    (<span class="number">4</span>, <span class="string">&#x27;Lovey Day&#x27;</span>, <span class="string">&#x27;George Byron&#x27;</span>, <span class="number">20</span> , <span class="string">&#x27;2005&#x27;</span>, <span class="string">&#x27;novel&#x27;</span>, <span class="number">30</span>),</span><br><span class="line">    (<span class="number">5</span>, <span class="string">&#x27;Old land&#x27;</span>, <span class="string">&#x27;Honore Blade&#x27;</span>, <span class="number">30</span>, <span class="string">&#x27;2010&#x27;</span>, <span class="string">&#x27;law&#x27;</span>, <span class="number">0</span>),</span><br><span class="line">    (<span class="number">6</span>, <span class="string">&#x27;The Battle&#x27;</span>, <span class="string">&#x27;Upton Sara&#x27;</span>, <span class="number">30</span>, <span class="string">&#x27;1999&#x27;</span>, <span class="string">&#x27;medicine&#x27;</span>, <span class="number">40</span>),</span><br><span class="line">    (<span class="number">7</span>, <span class="string">&#x27;Rose Hood&#x27;</span>, <span class="string">&#x27;Richard haggard&#x27;</span>, <span class="number">28</span>, <span class="string">&#x27;2008&#x27;</span>, <span class="string">&#x27;cartoon&#x27;</span>, <span class="number">28</span>);</span><br><span class="line">    </span><br><span class="line"><span class="keyword">UPDATE</span> books</span><br><span class="line"><span class="keyword">SET</span> price <span class="operator">=</span> price <span class="operator">+</span> <span class="number">5</span></span><br><span class="line"><span class="keyword">WHERE</span> note <span class="operator">=</span> <span class="string">&#x27;novel&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> books;</span><br><span class="line"></span><br><span class="line"><span class="keyword">UPDATE</span> books</span><br><span class="line"><span class="keyword">SET</span> price <span class="operator">=</span> <span class="number">40</span>, note<span class="operator">=</span><span class="string">&#x27;drama&#x27;</span></span><br><span class="line"><span class="keyword">WHERE</span> b_name <span class="operator">=</span> <span class="string">&#x27;EmmaT&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> books</span><br><span class="line"><span class="keyword">WHERE</span> num <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> b_name</span><br><span class="line"><span class="keyword">FROM</span> books</span><br><span class="line"><span class="keyword">WHERE</span> b_name REGEXP <span class="string">&#x27;[a]&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>), <span class="built_in">SUM</span>(num)</span><br><span class="line"><span class="keyword">FROM</span> books</span><br><span class="line"><span class="keyword">WHERE</span> b_name REGEXP <span class="string">&#x27;[a]&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> books</span><br><span class="line"><span class="keyword">WHERE</span> note <span class="operator">=</span> <span class="string">&#x27;novel&#x27;</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> price <span class="keyword">DESC</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> books</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> num <span class="keyword">DESC</span>, note <span class="keyword">ASC</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">FROM</span> books</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> note;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUM</span>(num)</span><br><span class="line"><span class="keyword">FROM</span> books</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> note</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">SUM</span>(num) <span class="operator">&gt;</span> <span class="number">30</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> books</span><br><span class="line">LIMIT <span class="number">5</span>, <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"># <span class="number">1</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUM</span>(num)</span><br><span class="line"><span class="keyword">FROM</span> books</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> note</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">SUM</span>(num) <span class="operator">&gt;=</span> <span class="keyword">ALL</span>(</span><br><span class="line">        <span class="keyword">SELECT</span> <span class="built_in">SUM</span>(num)</span><br><span class="line">        <span class="keyword">FROM</span> books</span><br><span class="line">        <span class="keyword">GROUP</span> <span class="keyword">BY</span> note);</span><br><span class="line"></span><br><span class="line"># <span class="number">2</span> </span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MAX</span>(sum_num)</span><br><span class="line"><span class="keyword">FROM</span> (<span class="keyword">SELECT</span> <span class="built_in">SUM</span>(num) sum_num</span><br><span class="line">       <span class="keyword">FROM</span> books</span><br><span class="line">       <span class="keyword">GROUP</span> <span class="keyword">BY</span> note) sum_nums;</span><br><span class="line">       </span><br><span class="line"># <span class="number">3</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUM</span>(num) sum_num</span><br><span class="line"><span class="keyword">FROM</span> books</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> note</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> sum_num <span class="keyword">DESC</span></span><br><span class="line">LIMIT <span class="number">0</span>,<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> b_name</span><br><span class="line"><span class="keyword">FROM</span> books</span><br><span class="line"><span class="keyword">WHERE</span>  LENGTH(REPLACE(b_name, <span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;&#x27;</span>)) <span class="operator">&gt;=</span> <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> b_name, note, (<span class="keyword">CASE</span> note</span><br><span class="line">            <span class="keyword">WHEN</span> <span class="string">&#x27;novel&#x27;</span> <span class="keyword">THEN</span> <span class="string">&#x27;小说&#x27;</span></span><br><span class="line">            <span class="keyword">WHEN</span> <span class="string">&#x27;law&#x27;</span>  <span class="keyword">THEN</span> <span class="string">&#x27;法律&#x27;</span></span><br><span class="line">            <span class="keyword">WHEN</span> <span class="string">&#x27;medicine&#x27;</span> <span class="keyword">THEN</span> <span class="string">&#x27;医药&#x27;</span></span><br><span class="line">            <span class="keyword">WHEN</span> <span class="string">&#x27;cartoon&#x27;</span>  <span class="keyword">THEN</span> <span class="string">&#x27;卡通&#x27;</span></span><br><span class="line">            <span class="keyword">WHEN</span> <span class="string">&#x27;joke&#x27;</span> <span class="keyword">THEN</span> <span class="string">&#x27;笑话&#x27;</span></span><br><span class="line">            <span class="keyword">END</span>) type_cn</span><br><span class="line"><span class="keyword">FROM</span> books;</span><br></pre></td></tr></table></figure>

<h1 id="MySQL数据类型精讲"><a href="#MySQL数据类型精讲" class="headerlink" title="MySQL数据类型精讲"></a>MySQL数据类型精讲</h1><h2 id="整型"><a href="#整型" class="headerlink" title="整型"></a>整型</h2><h3 id="可选属性"><a href="#可选属性" class="headerlink" title="可选属性"></a>可选属性</h3><h4 id="M"><a href="#M" class="headerlink" title="M"></a>M</h4><p>M -&gt; 显示宽度, 这个属性已经是不再被推荐使用的属性</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> test01_int (</span><br><span class="line">	x <span class="type">INT</span>(M))</span><br></pre></td></tr></table></figure>

<p>这个属性不影响存储, 只影响显示</p>
<h4 id="UNSIGNED"><a href="#UNSIGNED" class="headerlink" title="UNSIGNED"></a>UNSIGNED</h4><p>无符号</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> test01_int (</span><br><span class="line">	x <span class="type">INT</span> UNSIGNED</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h4 id="ZEROFILL"><a href="#ZEROFILL" class="headerlink" title="ZEROFILL"></a>ZEROFILL</h4><p>0填充, 某列有ZEROFILL属性, 也会自动加上UNSIGNED这个属性</p>
<p>表示显示不够M位的时候, 用0在左边填充, 超过了M位, 就不会填充了</p>
<p>也就是说只有 <strong>ZEROFILL 和 M 两个属性连用的时候才有意义</strong></p>
<h3 id="各个类型的整型的适用场所和字节数"><a href="#各个类型的整型的适用场所和字节数" class="headerlink" title="各个类型的整型的适用场所和字节数"></a>各个类型的整型的适用场所和字节数</h3><table>
<thead>
<tr>
<th>类型名</th>
<th>字节数</th>
<th>适用场景</th>
</tr>
</thead>
<tbody><tr>
<td>TINYINT</td>
<td>1</td>
<td>一般用于枚举类型, 适用于系统设置取值范围很小, 且取值固定的场景</td>
</tr>
<tr>
<td>SMALLINT</td>
<td>2</td>
<td>少用, 用于小范围的数据统计, 比如工厂的固定资产库存数等</td>
</tr>
<tr>
<td>MEDIUMINT</td>
<td>3</td>
<td>少用, 用于较大整数的计算，比如车站每日的客流量等。</td>
</tr>
<tr>
<td>INT, INTEGER</td>
<td>4</td>
<td>用的最多, 一般不需要考虑越界问题</td>
</tr>
<tr>
<td>BIGINT</td>
<td>8</td>
<td>特别大的整数才需要用到, 比如双十一的交易数, 大型门户网站的点击数….</td>
</tr>
</tbody></table>
<blockquote>
<p>选择策略 : 优先保证稳定性 -&gt; 优先确保这个范围不会超, 其次考虑大小</p>
</blockquote>
<h2 id="浮点类型"><a href="#浮点类型" class="headerlink" title="浮点类型"></a>浮点类型</h2><table>
<thead>
<tr>
<th>类型</th>
<th>占用字节</th>
</tr>
</thead>
<tbody><tr>
<td>FLOAT</td>
<td>4</td>
</tr>
<tr>
<td>DOUBLE</td>
<td>8</td>
</tr>
</tbody></table>
<ul>
<li>无符号的属性在浮点类型上已经要被弃用了, 因为它并不能扩大取值范围, 只会让取值范围变成正常浮点数的正数的那一半</li>
</ul>
<h3 id="M-D属性"><a href="#M-D属性" class="headerlink" title="M, D属性"></a>M, D属性</h3><p>用于指定浮点数的精度, 这种语法是非标准语法, 其他数据库不一定支持, 涉及到数据迁移, 就尽量不要这么写</p>
<ul>
<li><p>FLOAT(M, D) -&gt;</p>
<ul>
<li>M指明整数位 + 小数位</li>
<li>D指明小数位</li>
<li>(3, 2) -&gt; 整数位加上小数位一共是个3位数, 小数位是0位数 -&gt; 实际存储范围就是 (-9.99 ~ 9.99)</li>
</ul>
</li>
<li><p>会影响存储</p>
<ul>
<li>存储的时候, 整数部分超出了范围是会报错的</li>
<li>小数部分超出了范围, 会进行四舍五入, 如果舍入后, 整数部分没有超出范围就不报错, 只是警告, 相反就会报错</li>
</ul>
</li>
<li><p>这个属性也不推荐使用了</p>
</li>
</ul>
<h2 id="定点数"><a href="#定点数" class="headerlink" title="定点数"></a>定点数</h2><p>底层是用字符串存储, 很精确, 可以用 &#x3D;&#x3D; 判断</p>
<table>
<thead>
<tr>
<th>数据类型</th>
<th>字节数</th>
</tr>
</thead>
<tbody><tr>
<td>DECIMAL(M,D),DEC,NUMERIC</td>
<td>M+2字节</td>
</tr>
</tbody></table>
<ul>
<li><p>DECIMAL最大取值范围与DOUBLE一致, 但是有效数据范围由M和D决定</p>
</li>
<li><p>当DECIMAL类型不指定精度和标度的时候, 默认为DECIMAL(10, 0), 数据精度超出范围的时候, MySQL做出的舍入和浮点数一样</p>
</li>
</ul>
<h3 id="适用范围的讨论"><a href="#适用范围的讨论" class="headerlink" title="适用范围的讨论"></a>适用范围的讨论</h3><ul>
<li>浮点数更适用于数字取值范围大,  可以容忍微小误差的科学计算场景</li>
<li>适用于精度有要求极高的场景 (涉及金额计算的场景)</li>
</ul>
<h2 id="位类型"><a href="#位类型" class="headerlink" title="位类型"></a>位类型</h2><table>
<thead>
<tr>
<th>二进制类型</th>
<th>长度</th>
<th>长度范围</th>
<th>占用空间</th>
</tr>
</thead>
<tbody><tr>
<td>BIT(M)</td>
<td>M</td>
<td>1&lt;&#x3D;M&lt;&#x3D;64</td>
<td>约为(M+7)&#x2F;8字节</td>
</tr>
</tbody></table>
<p>在使用SELECT语句查询的时候, 可以使用BIN(), HEC()函数, 读取出二进制数据和十六进制数据</p>
<h2 id="日期与时间类型"><a href="#日期与时间类型" class="headerlink" title="日期与时间类型"></a>日期与时间类型</h2><ul>
<li>YEAR 类型通常用来表示年</li>
<li>DATE 类型通常用来表示年、月、日</li>
<li>TIME 类型通常用来表示时、分、秒</li>
<li>DATETIME 类型通常用来表示年、月、日、时、分、秒</li>
<li>TIMESTAMP 类型通常用来表示带时区的年、月、日、时、分、秒</li>
</ul>
<h4 id=""><a href="#" class="headerlink" title=""></a><img src="E:\Desktop\imgs\date.png" alt="date"></h4><h3 id="YEAR"><a href="#YEAR" class="headerlink" title="YEAR"></a>YEAR</h3><p>以四位字符串或数字格式表示YEAR类型, 格式为YYYY, 最小值为1901, 最大值为2155</p>
<h3 id="DATE类型"><a href="#DATE类型" class="headerlink" title="DATE类型"></a>DATE类型</h3><ul>
<li><p>没有时间部分</p>
</li>
<li><p>格式为<code>YYYY-MM-DD</code>, 需要<strong>三个字节</strong>的存储空间</p>
</li>
<li><p>以 <code>YYYY-MM-DD</code> 格式或者 <code>YYYYMMDD</code> 格式表示的字符串日期，其最小取值为1000-01-01，最大取值为</p>
<p>9999-12-03。YYYYMMDD格式会被转化为YYYY-MM-DD格式。</p>
</li>
<li><p>以 <code>YY-MM-DD</code> 格式或者 <code>YYMMDD</code> 格式表示的字符串日期，此格式中，年份为两位数值或字符串满足</p>
<p>YEAR类型的格式条件为：当年份取值为00到69时，会被转化为2000到2069；当年份取值为70到99</p>
<p>时，会被转化为1970到1999。</p>
</li>
<li><p>使用<code>NOW()</code>会插入系统日期</p>
</li>
</ul>
<h3 id="TIME类型"><a href="#TIME类型" class="headerlink" title="TIME类型"></a>TIME类型</h3><ul>
<li><p>三个字节</p>
</li>
<li><p>不包含日期</p>
</li>
<li><p>使用<code>NOW()</code>会插入系统时间</p>
</li>
</ul>
<h4 id="插入格式"><a href="#插入格式" class="headerlink" title="插入格式"></a>插入格式</h4><ol>
<li>可以使用带有冒号的字符串，比如’ D HH:MM:SS’ 、’ HH:MM:SS ‘、’ HH:MM ‘、’ D HH:MM ‘、’ D HH ‘或’ SS ‘格式，都能被正确地插入TIME类型的字段中。其中D表示天，其最小值为0，最大值为34。如果使用带有D格式的字符串插入TIME类型的字段时，D会被转化为小时，计算格式为D*24+HH。当使用带有冒号并且不带D的字符串表示时间时，表示当天的时间，比如12:10表示12:10:00，而不是00:12:10。 -&gt; <strong>也可以存入D, 但是实际上会发生转化</strong></li>
<li>可以使用不带有冒号的字符串或者数字，格式为’ HHMMSS ‘或者 HHMMSS 。如果插入一个不合法的字符串或者数字，MySQL在存储数据时，会将其自动转化为00:00:00进行存储。比如1210，MySQL会将最右边的两位解析成秒，表示00:12:10，而不是12:10:00。 -&gt; <strong>不合法的时间会取其中正常的, 然后用0填充, 而且默认从右往左取正常值</strong></li>
</ol>
<h3 id="DATETIME"><a href="#DATETIME" class="headerlink" title="DATETIME"></a>DATETIME</h3><ul>
<li><strong>8个字节</strong></li>
</ul>
<h4 id="存储的格式条件"><a href="#存储的格式条件" class="headerlink" title="存储的格式条件"></a>存储的格式条件</h4><ol>
<li><p>以<code> YYYY-MM-DD HH:MM:SS</code> 格式或者 <code>YYYYMMDDHHMMSS</code> 格式的字符串插入DATETIME类型的字段时，最小值为1000-01-01 00:00:00，最大值为9999-12-03 23:59:59。 以<code>YYYYMMDDHHMMSS</code>格式的数字插入DATETIME类型的字段时，会被转化为&#96;格式。</p>
</li>
<li><p>以 <code>YY-MM-DD HH:MM:SS</code> 格式或者 <code>YYMMDDHHMMSS</code> 格式的字符串插入DATETIME类型的字段时，两位数的年份规则符合YEAR类型的规则，00到69表示2000到2069；70到99表示1970到1999。</p>
</li>
<li><p>使用函数 <code>CURRENT_TIMESTAMP()</code> 和 <code>NOW()</code> ，可以向DATETIME类型的字段插入系统的当前日期和时间。</p>
</li>
</ol>
<h2 id="TIMESTAMP类型"><a href="#TIMESTAMP类型" class="headerlink" title="TIMESTAMP类型"></a>TIMESTAMP类型</h2><ul>
<li>取值范围小, 包含时区信息</li>
<li><strong>4个字节</strong></li>
<li>会根据用户时区的不同, 显示不同的结果</li>
<li>存储数据的时候需要对当前时间所在的时区进行转换, 查询数据的时候, 再将时间转换回当前的时区.</li>
</ul>
<h3 id="开发中经验"><a href="#开发中经验" class="headerlink" title="开发中经验"></a>开发中经验</h3><ul>
<li>用的最多的就是DATETIME, 存储的信息最完整, 范围也大</li>
<li>存注册时间, 商品发布时间等, 不建议使用DATETIEM存储, 使用<code>时间戳</code>, DATETIME虽然直观, 但是不便于计算</li>
</ul>
<h2 id="文本字符类型"><a href="#文本字符类型" class="headerlink" title="文本字符类型"></a>文本字符类型</h2><h3 id="CHAR-和-VARCHAR"><a href="#CHAR-和-VARCHAR" class="headerlink" title="CHAR 和 VARCHAR"></a>CHAR 和 VARCHAR</h3><table>
<thead>
<tr>
<th>类型</th>
<th>特点</th>
<th>长度</th>
<th>长度范围</th>
<th>存储空间</th>
</tr>
</thead>
<tbody><tr>
<td>CAHR</td>
<td>固定长度</td>
<td>M</td>
<td>0 &lt;&#x3D; M &lt;&#x3D; 255</td>
<td>M个字节</td>
</tr>
<tr>
<td>VARCHAR</td>
<td>可变长度</td>
<td>M</td>
<td>0 &lt;&#x3D; M &lt;&#x3D; 65535</td>
<td>(实际长度 + 1)个字节</td>
</tr>
</tbody></table>
<h4 id="那种情况使用CHAR-或-VARCHAR-更好"><a href="#那种情况使用CHAR-或-VARCHAR-更好" class="headerlink" title="那种情况使用CHAR 或 VARCHAR 更好"></a>那种情况使用CHAR 或 VARCHAR 更好</h4><p>情况1 : 存储很短的信息, 这个时候, 使用CHAR, 因为 VARCHAR还要额外占用一个字节</p>
<p>情况2 : 固定长度的, 比如uuid作为主键, 那使用char应该更合适</p>
<p>情况3 : 十分频繁更改的列, 因为varchar每次存储需要额外的计算</p>
<p>情况4 : 视引擎而定</p>
<ul>
<li><code>MyISAM</code>数据存储引擎和数据列: 最好使用固定长度(CHAR), 这样使整个表静态化, 加快数据检索</li>
<li><code>MEMORY</code>存储引擎和数据列 : 两个都一样</li>
<li><code>InnoDB</code>存储引擎 : 建议使用VARCHAR, <strong>主要影响性能的因素是数据行使用的存储量</strong>, 而char平均占用的空间多余varchar</li>
</ul>
<h3 id="TEXT类型"><a href="#TEXT类型" class="headerlink" title="TEXT类型"></a>TEXT类型</h3><p><img src="E:\Desktop\imgs\TEXT.png" alt="TEXT"></p>
<ul>
<li>由于实际存储的长度不确定, MySQL不允许 TEXT 类型做主键</li>
</ul>
<h4 id="开发中的经验"><a href="#开发中的经验" class="headerlink" title="开发中的经验"></a>开发中的经验</h4><p><strong>TEXT文本类型，可以存比较大的文本段</strong>，搜索速度稍慢，因此如果不是特别大的内容，建议使用CHAR， VARCHAR来代替。还有TEXT类型不用加默认值，加了也没用。<strong>而且text和blob类型的数据删除后容易导致“空洞”，使得文件碎片比较多</strong>，所以频繁使用的表不建议包含TEXT类型字段，建议单独分出去，单独用一个表</p>
<h2 id="ENUM类型"><a href="#ENUM类型" class="headerlink" title="ENUM类型"></a>ENUM类型</h2><table>
<thead>
<tr>
<th>类型</th>
<th>长度</th>
<th>长度范围</th>
<th>占用的存储空间</th>
</tr>
</thead>
<tbody><tr>
<td>ENUM</td>
<td>L</td>
<td>1 &lt;&#x3D; L &lt;&#x3D; 65535</td>
<td>1或2个字节</td>
</tr>
</tbody></table>
<ul>
<li>当ENUM类型包含1～255个成员时，需要1个字节的存储空间；</li>
<li>当ENUM类型包含256～65535个成员时，需要2个字节的存储空间。</li>
<li>ENUM类型的成员个数的上限为65535个。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> test01_enum(</span><br><span class="line">	season ENUM (<span class="string">&#x27;春&#x27;</span>, <span class="string">&#x27;夏&#x27;</span>, <span class="string">&#x27;秋&#x27;</span>, <span class="string">&#x27;冬&#x27;</span>, <span class="string">&#x27;unknow&#x27;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># 允许按照角标的方式获取指定索引位置的枚举值 </span><br><span class="line"><span class="keyword">INSERT INTO</span> test01_enum </span><br><span class="line"><span class="keyword">VALUES</span>(<span class="string">&#x27;1&#x27;</span>),(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"># 忽略大小写 </span><br><span class="line"><span class="keyword">INSERT INTO</span> test_enum </span><br><span class="line"><span class="keyword">VALUES</span>(<span class="string">&#x27;UNKNOW&#x27;</span>);</span><br><span class="line"></span><br><span class="line"># 插入不存在的值的时候的报错 : Data truncated <span class="keyword">for</span> <span class="keyword">column</span> <span class="string">&#x27;season&#x27;</span> <span class="keyword">at</span> <span class="type">row</span> <span class="number">1</span> </span><br><span class="line"><span class="keyword">INSERT INTO</span> test_enum </span><br><span class="line"><span class="keyword">VALUES</span>(<span class="string">&#x27;ab&#x27;</span>);</span><br><span class="line"></span><br><span class="line"># 当ENUM类型的字段没有声明为<span class="keyword">NOT NULL</span>时，插入<span class="keyword">NULL</span>也是有效的 </span><br><span class="line"><span class="keyword">INSERT INTO</span> test_enum </span><br><span class="line"><span class="keyword">VALUES</span>(<span class="keyword">NULL</span>);</span><br></pre></td></tr></table></figure>

<h2 id="SET类型"><a href="#SET类型" class="headerlink" title="SET类型"></a>SET类型</h2><ul>
<li>集合类型</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> test_set( </span><br><span class="line">    s <span class="keyword">SET</span> (<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>) </span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT INTO</span> test_set (s) <span class="keyword">VALUES</span> (<span class="string">&#x27;A&#x27;</span>), (<span class="string">&#x27;A,B&#x27;</span>); </span><br><span class="line"></span><br><span class="line">#插入重复的<span class="keyword">SET</span>类型成员时，MySQL会自动删除重复的成员 </span><br><span class="line"><span class="keyword">INSERT INTO</span> test_set (s) <span class="keyword">VALUES</span> (<span class="string">&#x27;A,B,C,A&#x27;</span>); </span><br><span class="line"></span><br><span class="line">#向<span class="keyword">SET</span>类型的字段插入<span class="keyword">SET</span>成员中不存在的值时，MySQL会抛出错误。 </span><br><span class="line"><span class="keyword">INSERT INTO</span> test_set (s) <span class="keyword">VALUES</span> (<span class="string">&#x27;A,B,C,D&#x27;</span>); <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> test_set;</span><br></pre></td></tr></table></figure>

<h2 id="二进制字符串类型"><a href="#二进制字符串类型" class="headerlink" title="二进制字符串类型"></a>二进制字符串类型</h2><p>MySQL中的二进制字符串类型主要存储一些二进制数据，比如可以存储图片、音频和视频等二进制数据。</p>
<h3 id="BINARY与VARBINARY类型"><a href="#BINARY与VARBINARY类型" class="headerlink" title="BINARY与VARBINARY类型"></a>BINARY与VARBINARY类型</h3><p>这两个类似于CHAR和VARCHAR的关系, 一个是固定的, 一个是变长的</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>特点</th>
<th>值的长度</th>
<th>占用空间</th>
</tr>
</thead>
<tbody><tr>
<td>BINARY(M)</td>
<td>固定长度</td>
<td>M (0 &lt;&#x3D; M &lt;&#x3D; 255)</td>
<td>M个字节</td>
</tr>
<tr>
<td>VARBINARY(M)</td>
<td>可变长度</td>
<td>M (0 &lt;&#x3D; M &lt;&#x3D; 65535)</td>
<td>M+1个字节</td>
</tr>
</tbody></table>
<ul>
<li>BINARY类型如果未指定(M), 表示只能存储一个字节</li>
<li>VARBINARY必须指定(M)</li>
</ul>
<h4 id="BLOB类型"><a href="#BLOB类型" class="headerlink" title="BLOB类型"></a>BLOB类型</h4><ul>
<li>二进制大对象, 可以容纳可变数量的数据</li>
<li>和INT一样, 分有TINYBLOB, BLOB, MEDIUMBLOB, LONGBLOB四种类型</li>
<li>可以用来存储一个二进制大对象, 比如图片, 音频, 视频等</li>
<li>实际工作中, 往往不会在MySQL数据库中使用BLOB类型存储大对象数据, 通常会将图片, 音频, 视频文件存储到服务器的磁盘上, 在MySQL中存储访问路径</li>
</ul>
<h4 id="TEXT和BLOB的使用注意事项"><a href="#TEXT和BLOB的使用注意事项" class="headerlink" title="TEXT和BLOB的使用注意事项"></a>TEXT和BLOB的使用注意事项</h4><ol>
<li>BLOB和TEXT值, 在执行了大量的删除和更新操作后. 删除这种大值后很容易留下来数据空洞, 而后面填入数据空洞的数据的大小不同, 会出现碎片化, 建议定期对这类表 <code>OPIMIZE TABLE</code>进行碎片整理</li>
<li>不要通过SELECT *这种方式查询这类大的数据类型, 会导致资源的大幅度浪费, 针对大文本字段进行模糊查询, MySQL提供了<code>前缀索引</code></li>
<li>把BLOB或TEXT列<code>分离到单独的表</code>中, 如果将这些数据列移动到另一张表后, 可以使原先的表中的数据列转化为固定长度的数据列格式. 这会<code>减少主表中的碎片</code>, 获得到固定长度数据行的性能优势. 而且还会在我们SELECT * 主表的时候, 不会通过网络传输大量的BLOB或TEXT值</li>
</ol>
<h2 id="JSON类型"><a href="#JSON类型" class="headerlink" title="JSON类型"></a>JSON类型</h2><p>将整个JSON文件的内容, 作为一个数据对象存储</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT INTO</span> test_json (js) </span><br><span class="line"><span class="keyword">VALUES</span> </span><br><span class="line">(<span class="string">&#x27;&#123;&quot;name&quot;:&quot;songhk&quot;, &quot;age&quot;:18, &quot;address&quot;:&#123;&quot;province&quot;:&quot;beijing&quot;, &quot;city&quot;:&quot;beijing&quot;&#125;&#125;&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>检索的时候, 需要查询某个具体的值的时候可以通过”-&gt;”, “-&gt;&gt;”符号获取</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> js <span class="operator">-</span><span class="operator">&gt;</span> <span class="string">&#x27;$.name&#x27;</span> <span class="keyword">AS</span> NAME</span><br><span class="line"></span><br><span class="line"><span class="operator">-</span><span class="operator">&gt;</span> &quot;songhk&quot;</span><br></pre></td></tr></table></figure>

<h2 id="空间类型"><a href="#空间类型" class="headerlink" title="空间类型"></a>空间类型</h2><p>没用的东西</p>
<h2 id="小结及选择建议"><a href="#小结及选择建议" class="headerlink" title="小结及选择建议"></a>小结及选择建议</h2><ul>
<li>整数 -&gt; <code>INT</code></li>
<li>小数 -&gt; <code>DICIMAL</code></li>
<li>日期和时间 -&gt; <code>TEXT</code></li>
<li>字符串的选择<ul>
<li>如果存储的数据范围超过DECIMAL范围, 建议将数据拆分为整数部分和小数部分分开存储</li>
<li>存储的字符串长度几乎相等 -&gt; CHAR</li>
<li>VARCHAR长度不要超过 5000, 存储长度大于此值, 定义字段类型为 TEXT, 并独立出来一张表, 用主键来对应, 避免影响其它字段索引效率</li>
</ul>
</li>
</ul>
<h1 id="13-约束"><a href="#13-约束" class="headerlink" title="13. 约束"></a>13. 约束</h1><h2 id="约束概述"><a href="#约束概述" class="headerlink" title="约束概述"></a>约束概述</h2><h3 id="为什么需要约束"><a href="#为什么需要约束" class="headerlink" title="为什么需要约束"></a>为什么需要约束</h3><ul>
<li>为了保证数据的完整性, 对表数据进行的额外的条件限制<ul>
<li><code>实体完整性 </code> -&gt; 同一张表中不能存在两条完全相同无法区分的记录</li>
<li><code>域完整性</code> -&gt;年龄 0 ~ 120</li>
<li><code>引用完整性</code> -&gt; 员工所在部门, 在部门表中要能找到那个部门</li>
<li><code>用户自定义完整性</code> -&gt; 用户唯一, 密码不能为空等</li>
</ul>
</li>
</ul>
<h3 id="约束的创建时机"><a href="#约束的创建时机" class="headerlink" title="约束的创建时机"></a>约束的创建时机</h3><ul>
<li>在创建表的时候 ( CREATE TABLE )</li>
<li>表创建后通过 ( ALTER TABLE) 修改规定约束</li>
</ul>
<h3 id="约束的分类"><a href="#约束的分类" class="headerlink" title="约束的分类"></a>约束的分类</h3><ul>
<li>根据约束数据里的限制<ul>
<li>单列约束: 只约束一列</li>
<li>多列约束: 可约束多行数据</li>
</ul>
</li>
<li>约束的作用范围<ul>
<li>列级约束: 只作用在一个列上, 跟在列的定义后面</li>
<li>表级约束: 可以作用在多个列上, 不与表一起定义, 单独定义</li>
</ul>
</li>
<li>根据约束起的作用:<ul>
<li><code>NOT NULL</code> 非空约束, 规定某个字段不能为空</li>
<li><code>UNIQUE</code> 唯一约束, 规定某个字段在整张表中式唯一的</li>
<li><code>PRIMARY KEY</code>主键约束 (非空且唯一)</li>
<li><code>FOREIGN KEY</code> 外键约束</li>
<li><code>CHECK</code> 检查约束</li>
<li><code>DEFAULT</code> 默认值约束</li>
</ul>
</li>
</ul>
<blockquote>
<p>MySQL不支持check约束, 但可以使用check约束, 但是没有任何效果</p>
</blockquote>
<ul>
<li><p>查看某个表已有的约束</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># information_schema数据库名 (系统库)</span><br><span class="line"># table_constraints表名称 (专门存储各个表的约束)</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> information_schema.table_constrains</span><br><span class="line"><span class="keyword">WHERE</span> table_name <span class="operator">=</span> <span class="string">&#x27;&lt;table-name&gt;&#x27;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="非空约束-NOT-NULL"><a href="#非空约束-NOT-NULL" class="headerlink" title="非空约束 NOT NULL"></a>非空约束 <code>NOT NULL</code></h2><h4 id="添加非空约束"><a href="#添加非空约束" class="headerlink" title="添加非空约束"></a>添加非空约束</h4><ol>
<li>建表时</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> <span class="operator">&lt;</span><span class="keyword">table</span><span class="operator">-</span>name<span class="operator">&gt;</span>(</span><br><span class="line">	字段名 数据类型 <span class="keyword">NOT NULL</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>建表后的修改, 加上约束</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> <span class="operator">&lt;</span><span class="keyword">table</span><span class="operator">-</span>name<span class="operator">&gt;</span></span><br><span class="line">MODIFY 字段名 数据类型 <span class="keyword">NOT NULL</span></span><br></pre></td></tr></table></figure>

<h4 id="删除约束"><a href="#删除约束" class="headerlink" title="删除约束"></a>删除约束</h4><ol>
<li><p>设置为NULL</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> <span class="operator">&lt;</span><span class="keyword">table</span><span class="operator">-</span>name<span class="operator">&gt;</span></span><br><span class="line">MODIFY 字段名 数据类型 <span class="keyword">NULL</span></span><br><span class="line"># 设置为<span class="keyword">NULL</span>说明允许为<span class="keyword">NULL</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>去掉NOT NULL</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> <span class="operator">&lt;</span><span class="keyword">table</span><span class="operator">-</span>name<span class="operator">&gt;</span></span><br><span class="line">MODIFY 字段名 数据类型</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="唯一性约束-UNIQUE"><a href="#唯一性约束-UNIQUE" class="headerlink" title="唯一性约束 UNIQUE"></a>唯一性约束 <code>UNIQUE</code></h2><h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><ul>
<li>约束后的列, 值没有重复</li>
<li>可以时某一列的值唯一, 也可以是多个列组合的值唯一</li>
<li>允许列值为空</li>
<li>创建唯一约束的时候, 如果不给唯一约束命名, 就默认和列名相同</li>
</ul>
<h3 id="复合唯一约束"><a href="#复合唯一约束" class="headerlink" title="复合唯一约束"></a>复合唯一约束</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unique</span> key(字段列表) </span><br><span class="line">#字段列表中写的是多个字段名，多个字段名用逗号分隔，表示那么是复合唯一，即多 个字段的组合是唯一的</span><br></pre></td></tr></table></figure>

<h3 id="添加唯一约束"><a href="#添加唯一约束" class="headerlink" title="添加唯一约束"></a>添加唯一约束</h3><ol>
<li>建表时</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> <span class="operator">&lt;</span><span class="keyword">table</span><span class="operator">-</span>name<span class="operator">&gt;</span>(</span><br><span class="line">	字段名 数据类型,</span><br><span class="line">    字段名 数据类型 <span class="keyword">UNIQUE</span>,</span><br><span class="line">    字段名 数据类型 <span class="keyword">UNIQUE</span> KEY</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE TABLE</span> <span class="operator">&lt;</span><span class="keyword">table</span><span class="operator">-</span>name<span class="operator">&gt;</span>(</span><br><span class="line">	字段名 数据类型,</span><br><span class="line">    ...,</span><br><span class="line">    [<span class="keyword">constraint</span> 约束名] <span class="keyword">UNIQUE</span> KEY(字段名)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> <span class="keyword">USER</span>(</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">    <span class="comment">-- 列级约束语法</span></span><br><span class="line">    NAME <span class="type">VARCHAR</span>(<span class="number">25</span>), <span class="keyword">UNIQUE</span></span><br><span class="line">    PASSWORD <span class="type">VARCHAR</span>(<span class="number">16</span>),</span><br><span class="line">    <span class="comment">-- 表级约束语法</span></span><br><span class="line">    <span class="keyword">CONSTRAINT</span> uk_name_pwd <span class="keyword">UNIQUE</span>(NAME, PASSWORD)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>用户名和密码的组合不能重合</p>
</blockquote>
<ol start="2">
<li>建表后指定唯一键约束</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 列级约束的添加</span><br><span class="line"><span class="keyword">ALTER TABLE</span> <span class="operator">&lt;</span><span class="keyword">table</span><span class="operator">-</span>name<span class="operator">&gt;</span></span><br><span class="line">MODIFY 字段名 字段类型 <span class="keyword">UNIQUE</span>;</span><br><span class="line"></span><br><span class="line"># 表级约束的添加</span><br><span class="line"><span class="keyword">ALTER TABLE</span> <span class="operator">&lt;</span><span class="keyword">table</span><span class="operator">-</span>name<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">UNIQUE</span> KEY(字段名称);</span><br><span class="line"># <span class="keyword">or</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> <span class="operator">&lt;</span><span class="keyword">table</span><span class="operator">-</span>name<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">ADD CONSTRAINT</span> uk_name_ped <span class="keyword">UNIQUE</span>(NAME, PASSWORD)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>列级的就是对一个列的修改</p>
<p>表级的就是添加一个列了</p>
</blockquote>
<h3 id="删除唯一约束"><a href="#删除唯一约束" class="headerlink" title="删除唯一约束"></a>删除唯一约束</h3><ul>
<li>添加唯一性约束的列上会自动创建唯一索引</li>
<li>删除唯一性约束只能通过删除唯一索引的方式删除</li>
<li>删除时需要指定唯一索引名, 唯一索引名和唯一约束名一样</li>
<li>如果创建唯一约束时未指定名称, 如果是单列, 就默认和列名相同, 如果是组合列, 那就默认和()中排在第一个的列名相同, 也可以是自定义唯一性约束名</li>
<li>主键的索引名都是 <strong>PRIMARY</strong>, 就算自己命名了主键约束也没用</li>
<li><strong>不要修改主键字段的值</strong>, 因为主键是数据的唯一标识, 修改了以后会破坏数据的完整性</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> information_schema.table_constraints </span><br><span class="line"><span class="keyword">WHERE</span> table_name <span class="operator">=</span> <span class="string">&#x27;&lt;table-name&gt;&#x27;</span></span><br><span class="line"># 查看有哪些约束</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> <span class="keyword">USER</span></span><br><span class="line"><span class="keyword">DROP</span> INDEX uk_name_pwd;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>可以通过show index from 表名称; 来查看到索引</p>
</blockquote>
<h2 id="主键约束-PRIMARY-KEY"><a href="#主键约束-PRIMARY-KEY" class="headerlink" title="主键约束 PRIMARY KEY"></a>主键约束 <code>PRIMARY KEY</code></h2><h3 id="特点-1"><a href="#特点-1" class="headerlink" title="特点"></a>特点</h3><ul>
<li>每个表有且仅有一个主键</li>
<li>主键 &lt;&#x3D;&gt; 唯一性约束 + 非空约束</li>
<li>主键有列级的主键 -&gt; 在创建列的时候添加后缀, 表级主键 -&gt; 新建一列, 用于写约束</li>
<li>主键有复合主键和单列主键<ul>
<li>复合主键<ul>
<li>每个属性都非空</li>
<li>组合不重复</li>
</ul>
</li>
</ul>
</li>
<li>一张表只能有一个主键</li>
</ul>
<h3 id="创建主键约束"><a href="#创建主键约束" class="headerlink" title="创建主键约束"></a>创建主键约束</h3><p>和唯一性约束的创建模式相同</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 列级</span><br><span class="line"><span class="keyword">CREATE TABLE</span> <span class="operator">&lt;</span><span class="keyword">table</span><span class="operator">-</span>name<span class="operator">&gt;</span>(</span><br><span class="line">	id <span class="type">INT</span> PEIMARY KEY</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"># 表级</span><br><span class="line"><span class="keyword">CREATE TABLE</span> <span class="operator">&lt;</span><span class="keyword">table</span><span class="operator">-</span>name<span class="operator">&gt;</span>(</span><br><span class="line">	id <span class="type">INT</span>,</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> pk_id <span class="keyword">PRIMARY KEY</span>(id)</span><br><span class="line">)</span><br><span class="line"><span class="keyword">CREATE TABLE</span> <span class="operator">&lt;</span><span class="keyword">table</span><span class="operator">-</span>name<span class="operator">&gt;</span>(</span><br><span class="line">	id <span class="type">INT</span>,</span><br><span class="line">    <span class="keyword">PRIMARY KEY</span>(id)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ul>
<li>复合主键和唯一性约束相同</li>
</ul>
<h3 id="添加主键"><a href="#添加主键" class="headerlink" title="添加主键"></a>添加主键</h3><ul>
<li>同样和唯一性主键相同<ul>
<li>列级主键就当MODIFY一列就行</li>
<li>表级主键就当ADD一列就行</li>
</ul>
</li>
</ul>
<h3 id="删除主键约束"><a href="#删除主键约束" class="headerlink" title="删除主键约束"></a>删除主键约束</h3><p>因为一张表只有一个主键, 所以不需要指定索引</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> <span class="operator">&lt;</span><span class="keyword">table</span><span class="operator">-</span>name<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">PRIMARY KEY</span>;</span><br></pre></td></tr></table></figure>

<h2 id="自增-AUTO-INCREMENT"><a href="#自增-AUTO-INCREMENT" class="headerlink" title="自增 AUTO_INCREMENT"></a>自增 <code>AUTO_INCREMENT</code></h2><h3 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h3><ul>
<li>只有键列 (主键列, 唯一键列) 后可加上<code>AUTO_INCREMENT</code></li>
<li>如果指定键列的值为0或NULL的时候, 就会执行自增长, 自增长的值为<code>max(当前列) + 1</code>, 如果指定其他值, 那么就会是其他值</li>
<li>一个表最多只有一个自增长列</li>
<li>自增长的列数据类型必须是整数类型</li>
</ul>
<h3 id="创建自增长约束"><a href="#创建自增长约束" class="headerlink" title="创建自增长约束"></a>创建自增长约束</h3><p>在键值列后添加后缀</p>
<h3 id="添加自增长约束"><a href="#添加自增长约束" class="headerlink" title="添加自增长约束"></a>添加自增长约束</h3><p>当成一个列修改他的属性即可</p>
<p><code>ALTER TABLE &lt;table-name&gt; MODIFY</code></p>
<h3 id="删除自增长约束"><a href="#删除自增长约束" class="headerlink" title="删除自增长约束"></a>删除自增长约束</h3><p>和删除NOT NULL约束一样, 直接覆盖就行</p>
<h3 id="MySQL8新特性-自增长持久化"><a href="#MySQL8新特性-自增长持久化" class="headerlink" title="MySQL8新特性-自增长持久化"></a>MySQL8新特性-自增长持久化</h3><ul>
<li>MySQL5.7版本, 我INSERT数据后, 假设id为主键它的值为1,2,3,4, 我删除4后, 再插入, 主键序列为1,2,3,5. 删除后重启数据库, 这个时候插入数据, 得到的序列却会是1,2,3,4<ul>
<li>这是因为在5.7中, 计数器的维护是在内存中, 重启后就会重置</li>
</ul>
</li>
<li>而在8后, 会符合预期的获得1,2,3,5, 因为自增主键的计数器持久化到<code>重做日志</code></li>
</ul>
<h2 id="FOREIGN-KEY-约束"><a href="#FOREIGN-KEY-约束" class="headerlink" title="FOREIGN KEY 约束"></a>FOREIGN KEY 约束</h2><h3 id="特点-2"><a href="#特点-2" class="headerlink" title="特点"></a>特点</h3><ul>
<li>分为主表和从表, 从表references主表</li>
<li>从表的外键列, 必须参考主表的主键列或唯一约束键列</li>
<li>创建的时候, 如果需要在创建表的时候指定外键, 得先创建主表, 从表才能在创建的时候指定外键<ul>
<li>如果是后续添加外键, 则不会有创建顺序上的限制</li>
</ul>
</li>
<li>创建时, 如果不给外键约束命名, 默认名不是列名, 而是自动产生的一个外键名</li>
<li>删除的时候, 需要先删除从表中依赖的主表的数据, 才能删除主表中对应的数据</li>
<li>一个表可以有多个外键</li>
<li>从表的外键列与主表的被参照的列的名字可以相同或不同, 但是数据类型必须一样, 逻辑意义一致(NOT NUL等)</li>
<li>删除外键约束的时候, 还需要手动删除外键索引</li>
</ul>
<h3 id="创建外键"><a href="#创建外键" class="headerlink" title="创建外键"></a>创建外键</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> <span class="operator">&lt;</span><span class="keyword">table</span><span class="operator">-</span>name<span class="operator">&gt;</span>(</span><br><span class="line">	id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> fk_id_name <span class="keyword">FOREIGN KEY</span> (从表的字段) <span class="keyword">REFERENCES</span> 主表名(主表的字段)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="添加外键"><a href="#添加外键" class="headerlink" title="添加外键"></a>添加外键</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> 从表名</span><br><span class="line"><span class="keyword">ADD</span></span><br><span class="line">[<span class="keyword">CONSTRAINT</span> 约束名] <span class="keyword">FOREIGN KEY</span> (从表的字段) <span class="keyword">REFERENCES</span> 主表名(主表的字段) [<span class="keyword">on</span> <span class="keyword">update</span> xx][<span class="keyword">on</span> <span class="keyword">delete</span> xx];</span><br></pre></td></tr></table></figure>

<h3 id="删除外键约束"><a href="#删除外键约束" class="headerlink" title="删除外键约束"></a>删除外键约束</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 先查看约束名和删除外键的约束</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> information_schema.table_constraints <span class="keyword">WHERE</span> table_name <span class="operator">=</span> &quot;表名&quot;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER TABLE</span> 从表名 <span class="keyword">DROP</span> <span class="keyword">FOREIGN KEY</span> 外键名</span><br><span class="line"></span><br><span class="line"># 查看索引名和删除索引</span><br><span class="line"><span class="keyword">SHOW</span> INDEX <span class="keyword">FROM</span> 表名称;</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER TABLE</span> 表名称 <span class="keyword">DROP</span> INDEX 索引名;</span><br></pre></td></tr></table></figure>

<h3 id="约束等级"><a href="#约束等级" class="headerlink" title="约束等级"></a>约束等级</h3><ul>
<li><code>Cascade</code>: 父表上update&#x2F;delete记录时, 同步update&#x2F;delete从表的匹配记录</li>
<li><code>Set null</code>: 父表上update&#x2F;delete记录时, 将子表匹配记录的列设为null, 这个时候, 从表的外键列不能为NOT NULL</li>
<li><code>No action</code>: 如果子表中有匹配的记录, 则不允许对父表对应键进行update&#x2F;delete操作</li>
<li><code>Restrict</code>: 和No action一致</li>
<li><code>Set default</code>: 父表有变更的时候, 子表将外键列设置为一个默认的值, 但Innodb不能识别</li>
<li>没有指定, 默认为Restrict方式</li>
<li>对于外键约束, 最好采用: <code>ON UPDATE CASCADE ON DELETE</code>的方式</li>
</ul>
<h3 id="开发规范"><a href="#开发规范" class="headerlink" title="开发规范"></a>开发规范</h3><ol>
<li>[强制]: 不得使用外键与级联, 一切外键概念必须在应用层解决</li>
</ol>
<h2 id="CHECK约束"><a href="#CHECK约束" class="headerlink" title="CHECK约束"></a>CHECK约束</h2><h3 id="特点-3"><a href="#特点-3" class="headerlink" title="特点"></a>特点</h3><ul>
<li>在5.7版本是没有用的属性</li>
<li>8版本后开始有效</li>
</ul>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> <span class="operator">&lt;</span><span class="keyword">table</span><span class="operator">-</span>name<span class="operator">&gt;</span>(</span><br><span class="line">	age <span class="type">INT</span> <span class="keyword">CHECK</span>(age <span class="operator">&gt;</span> <span class="number">20</span>),</span><br><span class="line">    gender <span class="type">CHAR</span>(<span class="number">5</span>) <span class="keyword">check</span> (gender <span class="keyword">IN</span>(<span class="string">&#x27;男&#x27;</span> <span class="keyword">OR</span> <span class="string">&#x27;女&#x27;</span>))</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"># 如果插入不合规的值, 就会报错</span><br></pre></td></tr></table></figure>

<h2 id="DEFAULT约束"><a href="#DEFAULT约束" class="headerlink" title="DEFAULT约束"></a>DEFAULT约束</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 用于指定默认值</span><br><span class="line"><span class="keyword">CREATE TABLE</span> <span class="operator">&lt;</span><span class="keyword">table</span><span class="operator">-</span>name<span class="operator">&gt;</span>(</span><br><span class="line">	字段名 数据类型 <span class="keyword">default</span> 默认值</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="面试"><a href="#面试" class="headerlink" title="面试"></a>面试</h2><ol>
<li>为什么要在建表的时候, 加上not null default 或 defualt 0<ul>
<li>不想让表中出现null值</li>
</ul>
</li>
<li>为什么不想要null<ul>
<li>不好比较</li>
<li>效率不高, 影响索引</li>
</ul>
</li>
<li>并不是每个表可以选择任意存储引擎<ul>
<li>外键约束不能跨引擎使用</li>
</ul>
</li>
</ol>
<h1 id="14-视图"><a href="#14-视图" class="headerlink" title="14. 视图"></a>14. 视图</h1><blockquote>
<p>视图的使用就当一张正常的虚拟表就行</p>
</blockquote>
<h2 id="视图的意义"><a href="#视图的意义" class="headerlink" title="视图的意义"></a>视图的意义</h2><ul>
<li>相当于对于数据和操作的封装, <ul>
<li>对于数据的封装 -&gt; 使数据具有隔离性, 我们可以通过视图, 让用户只能访问到有限的, 我们想提供的数据</li>
<li>对于操作的封装 -&gt; 就像函数一样, 我们把一些复杂的频繁使用的查询, 直接封装为视图, 下次需要查询的时候, 直接调用视图就能获取了</li>
</ul>
</li>
<li>视图在执行逻辑上, 也像一个无传参函数, 每次调用视图就是会执行视图里定义的语句, 然后给出返回, 所以视图的返回结果是会根据基表动态变化的, 因为实质上, 就是进行了查询</li>
</ul>
<h2 id="创建视图"><a href="#创建视图" class="headerlink" title="创建视图"></a>创建视图</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> 视图名称(字段名)</span><br><span class="line"><span class="keyword">AS</span> 查询语句</span><br><span class="line"></span><br><span class="line"># 如果创建视图的时候指定了字段名, 那<span class="keyword">SELECT</span>返回的结果的字段名, 就会按照设置字段名别名给出, </span><br><span class="line"># 如果没有, 就会默认按照<span class="keyword">SELECT</span>语句中的字段名</span><br></pre></td></tr></table></figure>

<ul>
<li>使用情景 : 利用视图进行格式化</li>
</ul>
<p>我们经常需要输出某个格式的内容, 我们就可以把他封装为一个视图</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> emp_depart</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> CONCAT(last_name, <span class="string">&#x27;(&#x27;</span>, department_name ,<span class="string">&#x27;)&#x27;</span>) <span class="keyword">AS</span> emp_dept</span><br><span class="line"><span class="keyword">FROM</span> employees e <span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">WHERE</span> e.departemnt_id <span class="operator">=</span> d.department_id</span><br></pre></td></tr></table></figure>

<ul>
<li>我们也可以基于视图创建视图</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> emp_dept_ysalary </span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> emp_dept.ename,dname,year_salary </span><br><span class="line"><span class="keyword">FROM</span> emp_dept <span class="keyword">INNER</span> <span class="keyword">JOIN</span> emp_year_salary </span><br><span class="line"><span class="keyword">ON</span> emp_dept.ename <span class="operator">=</span> emp_year_salary.ename;</span><br></pre></td></tr></table></figure>

<h2 id="查看视图"><a href="#查看视图" class="headerlink" title="查看视图"></a>查看视图</h2><ul>
<li><p>就和查看TABLE时一样的</p>
</li>
<li><p>查看视图的属性信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">TABLE</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;视图名称&#x27;</span>\G</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看视图的详细定义信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">VIEW</span> 视图名称;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="通过视图更新数据"><a href="#通过视图更新数据" class="headerlink" title="通过视图更新数据"></a>通过视图更新数据</h2><ul>
<li>在且仅在视图只是隔离了部分原表的数据的时候可以UPDATE, DELETE</li>
<li>在且仅在视图包含了基表中所有被定义为非空又未指认默认值的列, 可以执行INSERT操作</li>
<li>形式化的定义 : 视图中的行和底层基本表中的行之间必须存在<code>一对一</code>的关系, 才能执行更新操作</li>
</ul>
<blockquote>
<p>通过视图来更新数据是一种不推荐的行为, 因为视图作为虚拟表, 主要是为了方便查询, 所以没必要将不属于它的职责强加</p>
</blockquote>
<h2 id="修改视图"><a href="#修改视图" class="headerlink" title="修改视图"></a>修改视图</h2><ol>
<li><p>使用<code>CREATE OR REPLACE VIEW</code>子句<strong>覆盖式</strong>地修改视图</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE <span class="keyword">VIEW</span> <span class="operator">&lt;</span><span class="keyword">view</span><span class="operator">-</span>name<span class="operator">&gt;</span></span><br><span class="line">(字段...)</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> ...</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>ALTER VIEW</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">VIEW</span> 视图名称</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line">查询语句</span><br></pre></td></tr></table></figure></li>
</ol>
<blockquote>
<p>别名要和子查询中的各列一一对应</p>
</blockquote>
<h2 id="删除视图"><a href="#删除视图" class="headerlink" title="删除视图"></a>删除视图</h2><ul>
<li><p>删除只是删除视图的定义, 不会删除基表的数据</p>
</li>
<li><p>语法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">VIEW</span> IF <span class="keyword">EXISTS</span> 视图名称;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="作业-7"><a href="#作业-7" class="headerlink" title="作业"></a>作业</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">USE atguigudb;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE TABLE</span> emps</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> atguigudb.employees;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE <span class="keyword">VIEW</span> emp_v1</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name, salary, email, phone_number</span><br><span class="line"><span class="keyword">FROM</span> emps</span><br><span class="line"><span class="keyword">WHERE</span> emps.`phone_number` REGEXP <span class="string">&#x27;^011&#x27;</span></span><br><span class="line"><span class="keyword">AND</span> email REGEXP <span class="string">&#x27;[e]&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp_v1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DESC</span> emp_v1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">TO</span> emp_v1</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="string">&#x27;方&#x27;</span>, <span class="number">12000</span>, <span class="string">&#x27;email&#x27;</span>, <span class="string">&#x27;198&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">TABLE</span> emp_v1</span><br><span class="line"><span class="keyword">SET</span> salary <span class="operator">=</span> salary <span class="operator">+</span> <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> emp_v1</span><br><span class="line"><span class="keyword">WHERE</span> emp_v1.`last_name` <span class="operator">=</span> <span class="string">&#x27;Olsen&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE <span class="keyword">VIEW</span> emp_v2</span><br><span class="line"><span class="keyword">AS</span> </span><br><span class="line"><span class="keyword">SELECT</span> department_id, <span class="built_in">MAX</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">MAX</span>(salary) <span class="operator">&gt;</span> <span class="number">12000</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp_v2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> DATABASE();</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">VIEW</span> emp_v1, emp_v2;</span><br></pre></td></tr></table></figure>

<h3 id="剩下部分暂不观看-没什么用-都是在应用层实现的内容"><a href="#剩下部分暂不观看-没什么用-都是在应用层实现的内容" class="headerlink" title="剩下部分暂不观看, 没什么用, 都是在应用层实现的内容"></a>剩下部分暂不观看, 没什么用, 都是在应用层实现的内容</h3></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://fang-tech.github.io">Fun</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://fang-tech.github.io/2025/07/08/Computer_Science/Database/MySQL/MySQLbase/SQL/">https://fang-tech.github.io/2025/07/08/Computer_Science/Database/MySQL/MySQLbase/SQL/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://fang-tech.github.io" target="_blank">窄门</a>！</span></div></div><div class="tag_share"><div class="post-share"><div class="social-share" data-image="/img/butterfly-icon.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/07/08/Computer_Science/Database/MySQL/MySQL%E5%8E%9F%E7%90%86/0_MySQL%E4%BC%98%E5%8C%96/" title=""><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2"></div></div><div class="info-2"><div class="info-item-1">MySQL优化1. MySQL分页优化MySQL是怎么完成一次分页查询的, 性能问题在哪里有两种分页查询语句 1select * from t_user order by id limit offset, size  1select * from t_user order by id limit size  第二种查询语句, 其实相当于offset &#x3D;&#x3D; 0的情况 每次执行分页查询的时候, 引擎层首先根据where条件筛选出来符合条件的所有记录, 然后对这些已经筛选的记录order by, 最后应用LIMIT, 从已经筛选出来和排序的结果中取出来指定的offset到offset + size范围的记录  性能问题出在哪里  这里的问题就是, 我们不管size是多少, 我们都需要额外取出来offset条冗余的数据, 这就造成了当offset越来越来的时候, 执行分页查询的开销就越大, 也造成了 limit 1000, 10的开销比limit 100, 10的开销更大 从where筛选 -&gt; order by 排序 -&gt; limit分页, 其中需要做对...</div></div></div></a><a class="pagination-related" href="/2025/07/08/Computer_Science/Computer_network/%E8%AE%A1%E7%BD%91%E5%85%AB%E8%82%A1/2_TCP/6_TCP%E7%9A%84%E7%BC%BA%E7%82%B9/" title=""><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2"></div></div><div class="info-2"><div class="info-item-1">为什么要基于UDP实现可靠传输 (TCP的缺点)最大的原因就是TCP不是没有缺点的, 只是看似完美, 甚至正是TCP的缺点导致了HTTP2的瓶颈 TCP有四大缺点 升级TCP的工作困难TCP协议是在内核中实现的, 应用程序只能使用不能修改, 如果想升级TCP协议, 只能升级内核, 升级内核的成本是很高的(升级, 测试, 考虑兼容性….), 并且如果想使用升级的TCP协议, 需要通信双端都升级, 进一步加大了升级TCP的难度 TCP建立连接的延迟基于TCP实现的应用层协议, 都需要经过三次握手后 常用的HTTPS, 甚至需要在TCP三次握手以后, 还需要经过TLS四次握手, 才能进行HTTP数据的传输, 增加了数据传输的延迟  最后最少需要6次握手环节才能开始HTTP数据的传输 TCP存在队头堵塞TCP队头堵塞的原因 : TCP需要保证数据按序交付  如果TCP发送端发送的某条数据丢失了, 会导致接收窗口的左边界堵塞在丢失的数据上, 不能滑动(右边界还是可以继续滑动的, 使窗口保持原有的大小或根据接收缓冲区空间调整),  同时使序列号更高的数据接收到了, 但是因为低序列的数据没有接...</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/butterfly-icon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Fun</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">239</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">27</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%A6%82%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">1. 数据库概述</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5"><span class="toc-number">1.1.</span> <span class="toc-text">数据库相关概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1%E8%A7%84%E5%88%99"><span class="toc-number">1.2.</span> <span class="toc-text">关系型数据库设计规则</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8%E7%9A%84%E5%85%B3%E8%81%94%E5%85%B3%E7%B3%BB"><span class="toc-number">1.2.1.</span> <span class="toc-text">表的关联关系</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-MySQL%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">2.</span> <span class="toc-text">2. MySQL环境搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E5%92%8C%E5%85%B3%E9%97%AD%E6%9C%8D%E5%8A%A1"><span class="toc-number">2.1.</span> <span class="toc-text">启动和关闭服务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%99%BB%E5%BD%95"><span class="toc-number">2.2.</span> <span class="toc-text">登录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E6%9D%A5%E5%B0%B1%E6%9C%89%E7%9A%84%E5%BA%93"><span class="toc-number">2.3.</span> <span class="toc-text">原来就有的库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8"><span class="toc-number">2.4.</span> <span class="toc-text">数据库的简单使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E7%A0%81%E9%97%AE%E9%A2%98%E7%9A%84%E8%A7%A3%E5%86%B3"><span class="toc-number">2.5.</span> <span class="toc-text">编码问题的解决</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E5%9F%BA%E7%A1%80%E7%9A%84SELECT%E8%AF%AD%E5%8F%A5"><span class="toc-number">3.</span> <span class="toc-text">3. 基础的SELECT语句</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL%E5%88%86%E7%B1%BB"><span class="toc-number">3.0.1.</span> <span class="toc-text">SQL分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL%E8%AF%AD%E8%A8%80%E7%9A%84%E8%A7%84%E5%88%99%E5%92%8C%E8%A7%84%E8%8C%83"><span class="toc-number">3.0.2.</span> <span class="toc-text">SQL语言的规则和规范</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%A7%E5%B0%8F%E8%A7%84%E8%8C%83"><span class="toc-number">3.0.2.1.</span> <span class="toc-text">大小规范</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E9%87%8A"><span class="toc-number">3.0.2.2.</span> <span class="toc-text">注释</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%91%BD%E5%90%8D%E8%A7%84%E5%88%99"><span class="toc-number">3.0.2.3.</span> <span class="toc-text">命名规则</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%85%A5%E6%8C%87%E4%BB%A4"><span class="toc-number">3.0.2.4.</span> <span class="toc-text">数据导入指令</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E7%9A%84SELECT%E8%AF%AD%E5%8F%A5"><span class="toc-number">3.1.</span> <span class="toc-text">基本的SELECT语句</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SELECT%E2%80%A6"><span class="toc-number">3.1.0.1.</span> <span class="toc-text">SELECT….</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SELECT-%E2%80%A6-FROM"><span class="toc-number">3.1.0.2.</span> <span class="toc-text">SELECT … FROM</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%97%E7%9A%84%E5%88%AB%E5%90%8D"><span class="toc-number">3.1.0.3.</span> <span class="toc-text">列的别名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%BB%E9%99%A4%E9%87%8D%E5%A4%8D%E8%A1%8C"><span class="toc-number">3.1.0.4.</span> <span class="toc-text">去除重复行</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A9%BA%E5%80%BC%E5%8F%82%E4%B8%8E%E8%BF%90%E7%AE%97"><span class="toc-number">3.1.0.5.</span> <span class="toc-text">空值参与运算</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%B8%B8%E6%95%B0"><span class="toc-number">3.1.0.6.</span> <span class="toc-text">查询常数</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%98%BE%E7%A4%BA%E8%A1%A8%E7%BB%93%E6%9E%84"><span class="toc-number">3.2.</span> <span class="toc-text">显示表结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E6%95%B0%E6%8D%AE"><span class="toc-number">3.3.</span> <span class="toc-text">过滤数据</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">4.</span> <span class="toc-text">4. 运算符</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AF%94%E8%BE%83%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">4.1.</span> <span class="toc-text">比较运算符</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AF%94%E8%BE%83%E7%BB%93%E6%9E%9C%E4%B8%BANULL"><span class="toc-number">4.1.1.</span> <span class="toc-text">比较结果为NULL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E7%AD%89%E4%BA%8E%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">4.1.2.</span> <span class="toc-text">安全等于运算符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A9%BA%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">4.1.3.</span> <span class="toc-text">空运算符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%9E%E7%A9%BA%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">4.1.4.</span> <span class="toc-text">非空运算符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E5%B0%8F%E5%80%BC%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">4.1.5.</span> <span class="toc-text">最小值运算符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E5%A4%A7%E5%80%BC%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">4.1.6.</span> <span class="toc-text">最大值运算符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BETWEEN-AND%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">4.1.7.</span> <span class="toc-text">BETWEEN AND运算符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IN%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">4.1.8.</span> <span class="toc-text">IN运算符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NOT-IN-%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">4.1.9.</span> <span class="toc-text">NOT IN 运算符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LIKE-%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">4.1.10.</span> <span class="toc-text">LIKE 运算符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ESCAPE"><span class="toc-number">4.1.11.</span> <span class="toc-text">ESCAPE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#REGEXP%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">4.1.12.</span> <span class="toc-text">REGEXP运算符</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">4.2.</span> <span class="toc-text">逻辑运算符</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%8D%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">4.3.</span> <span class="toc-text">位运算符</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-%E6%8E%92%E5%BA%8F%E5%92%8C%E5%88%86%E9%A1%B5"><span class="toc-number">5.</span> <span class="toc-text">5. 排序和分页</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%8E%92%E5%BA%8F%E6%95%B0%E6%8D%AE"><span class="toc-number">5.1.</span> <span class="toc-text">1. 排序数据</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%92%E5%BA%8F%E8%A7%84%E5%88%99"><span class="toc-number">5.1.1.</span> <span class="toc-text">排序规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E5%88%97%E6%8E%92%E5%BA%8F"><span class="toc-number">5.1.2.</span> <span class="toc-text">单列排序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E5%88%97%E6%8E%92%E5%BA%8F"><span class="toc-number">5.1.3.</span> <span class="toc-text">多列排序</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%88%86%E9%A1%B5"><span class="toc-number">5.2.</span> <span class="toc-text">2. 分页</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E8%83%8C%E6%99%AF"><span class="toc-number">5.2.1.</span> <span class="toc-text">问题背景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E8%A7%84%E5%88%99"><span class="toc-number">5.2.2.</span> <span class="toc-text">实现规则</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%9C%E4%B8%9A"><span class="toc-number">5.3.</span> <span class="toc-text">作业</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.</span> <span class="toc-text">6. 多表查询</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%A4%9A%E8%A1%A8%E8%BF%9E%E6%8E%A5-%E6%A1%88%E4%BE%8B"><span class="toc-number">6.1.</span> <span class="toc-text">1. 多表连接 (案例)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E8%AF%B4%E6%98%8E"><span class="toc-number">6.1.1.</span> <span class="toc-text">案例说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%9B%E5%8D%A1%E5%B0%94%E7%A7%AF"><span class="toc-number">6.1.2.</span> <span class="toc-text">笛卡尔积</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90%E5%92%8C%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3"><span class="toc-number">6.1.3.</span> <span class="toc-text">案例分析和问题解决</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2%E5%88%86%E7%B1%BB%E8%AE%B2%E8%A7%A3"><span class="toc-number">6.2.</span> <span class="toc-text">2. 多表查询分类讲解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%B1%BB1-%E7%AD%89%E5%80%BC%E8%BF%9E%E6%8E%A5-vs-%E9%9D%9E%E7%AD%89%E5%80%BC%E8%BF%9E%E6%8E%A5"><span class="toc-number">6.2.1.</span> <span class="toc-text">分类1: 等值连接 vs 非等值连接</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AD%89%E5%80%BC%E8%BF%9E%E6%8E%A5"><span class="toc-number">6.2.1.1.</span> <span class="toc-text">等值连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%9E%E7%AD%89%E5%80%BC%E8%BF%9E%E6%8E%A5"><span class="toc-number">6.2.1.2.</span> <span class="toc-text">非等值连接</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%B1%BB2-%E8%87%AA%E8%BF%9E%E6%8E%A5-vs-%E9%9D%9E%E8%87%AA%E8%BF%9E%E6%8E%A5"><span class="toc-number">6.2.2.</span> <span class="toc-text">分类2 : 自连接 vs 非自连接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%B1%BB3-%E5%86%85%E8%BF%9E%E6%8E%A5-vs-%E5%A4%96%E8%BF%9E%E6%8E%A5"><span class="toc-number">6.2.3.</span> <span class="toc-text">分类3 : 内连接 vs 外连接</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SQL92-%E4%BD%BF%E7%94%A8-%E5%88%9B%E5%BB%BA%E8%BF%9E%E6%8E%A5"><span class="toc-number">6.2.3.1.</span> <span class="toc-text">SQL92: 使用(+)创建连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SQL99%E8%AF%AD%E6%B3%95%E5%AE%9E%E7%8E%B0%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.2.3.2.</span> <span class="toc-text">SQL99语法实现多表查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95"><span class="toc-number">6.2.3.3.</span> <span class="toc-text">基本语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E8%BF%9E%E6%8E%A5%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-number">6.2.3.4.</span> <span class="toc-text">内连接的实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%96%E8%BF%9E%E6%8E%A5"><span class="toc-number">6.2.3.5.</span> <span class="toc-text">外连接</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B7%A6%E5%A4%96%E8%BF%9E%E6%8E%A5"><span class="toc-number">6.2.3.5.1.</span> <span class="toc-text">左外连接</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%B3%E5%A4%96%E8%BF%9E%E6%8E%A5"><span class="toc-number">6.2.3.5.2.</span> <span class="toc-text">右外连接</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%BB%A1%E5%A4%96%E8%BF%9E%E6%8E%A5-FULL-OUTER-JOIN"><span class="toc-number">6.2.3.6.</span> <span class="toc-text">满外连接 ( FULL OUTER JOIN)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-UNUON%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">6.3.</span> <span class="toc-text">7. UNUON的使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-7%E7%A7%8DSQL-JOINS%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-number">6.4.</span> <span class="toc-text">8. 7种SQL JOINS的实现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-SQL99%E8%AF%AD%E6%B3%95%E6%96%B0%E7%89%B9%E6%80%A7"><span class="toc-number">6.5.</span> <span class="toc-text">9. SQL99语法新特性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E7%84%B6%E8%BF%9E%E6%8E%A5"><span class="toc-number">6.5.1.</span> <span class="toc-text">自然连接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#USING%E8%BF%9E%E6%8E%A5"><span class="toc-number">6.5.2.</span> <span class="toc-text">USING连接</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-%E7%AB%A0%E8%8A%82%E5%B0%8F%E7%BB%93"><span class="toc-number">6.6.</span> <span class="toc-text">10. 章节小结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%9C%E4%B8%9A-1"><span class="toc-number">6.7.</span> <span class="toc-text">作业</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-%E5%8D%95%E8%A1%8C%E5%87%BD%E6%95%B0"><span class="toc-number">7.</span> <span class="toc-text">7. 单行函数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%87%BD%E6%95%B0%E7%9A%84%E7%90%86%E8%A7%A3"><span class="toc-number">7.1.</span> <span class="toc-text">1. 函数的理解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-number">7.1.1.</span> <span class="toc-text">函数的分类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%95%B0%E5%80%BC%E5%87%BD%E6%95%B0"><span class="toc-number">7.2.</span> <span class="toc-text">2. 数值函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E5%87%BD%E6%95%B0"><span class="toc-number">7.2.1.</span> <span class="toc-text">基本函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%92%E5%BA%A6%E5%92%8C%E5%BC%A7%E5%BA%A6%E4%BA%92%E6%8D%A2%E5%87%BD%E6%95%B0"><span class="toc-number">7.2.2.</span> <span class="toc-text">角度和弧度互换函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E8%A7%92%E5%87%BD%E6%95%B0"><span class="toc-number">7.2.3.</span> <span class="toc-text">三角函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%87%E6%95%B0%E4%B8%8E%E5%AF%B9%E6%95%B0"><span class="toc-number">7.2.4.</span> <span class="toc-text">指数与对数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E5%88%B6%E4%B9%8B%E9%97%B4%E7%9A%84%E8%BD%AC%E6%8D%A2"><span class="toc-number">7.2.5.</span> <span class="toc-text">进制之间的转换</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%87%BD%E6%95%B0"><span class="toc-number">7.3.</span> <span class="toc-text">3. 字符串函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E6%97%A5%E6%9C%9F%E5%92%8C%E6%97%B6%E9%97%B4%E5%87%BD%E6%95%B0"><span class="toc-number">7.4.</span> <span class="toc-text">4. 日期和时间函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%97%A5%E6%9C%9F-%E6%97%B6%E9%97%B4"><span class="toc-number">7.4.1.</span> <span class="toc-text">获取日期, 时间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F%E5%92%8C%E6%97%B6%E9%97%B4%E6%88%B3%E7%9A%84%E8%BD%AC%E6%8D%A2"><span class="toc-number">7.4.2.</span> <span class="toc-text">日期和时间戳的转换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%9C%88%E4%BB%BD-%E6%98%9F%E6%9C%9F-%E6%98%9F%E6%9C%9F%E6%95%B0-%E5%A4%A9%E6%95%B0%E7%AD%89%E5%87%BD%E6%95%B0"><span class="toc-number">7.4.3.</span> <span class="toc-text">获取月份, 星期, 星期数, 天数等函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F%E7%9A%84%E6%93%8D%E4%BD%9C%E5%87%BD%E6%95%B0"><span class="toc-number">7.4.4.</span> <span class="toc-text">日期的操作函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E5%92%8C%E7%A7%92%E9%92%9F%E8%BD%AC%E6%8D%A2%E7%9A%84%E5%87%BD%E6%95%B0"><span class="toc-number">7.4.5.</span> <span class="toc-text">时间和秒钟转换的函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E6%97%A5%E6%9C%9F%E5%92%8C%E6%97%B6%E9%97%B4%E7%9A%84%E5%87%BD%E6%95%B0"><span class="toc-number">7.4.6.</span> <span class="toc-text">计算日期和时间的函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F%E7%9A%84%E6%A0%BC%E5%BC%8F%E5%8C%96%E4%B8%8E%E8%A7%A3%E6%9E%90"><span class="toc-number">7.4.7.</span> <span class="toc-text">日期的格式化与解析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6%E5%87%BD%E6%95%B0"><span class="toc-number">7.5.</span> <span class="toc-text">5. 流程控制函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E5%8A%A0%E5%AF%86%E5%92%8C%E8%A7%A3%E5%AF%86%E5%87%BD%E6%95%B0"><span class="toc-number">7.6.</span> <span class="toc-text">6. 加密和解密函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-MySQL%E4%BF%A1%E6%81%AF%E5%87%BD%E6%95%B0"><span class="toc-number">7.7.</span> <span class="toc-text">7. MySQL信息函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E5%85%B6%E4%BB%96%E5%87%BD%E6%95%B0"><span class="toc-number">7.8.</span> <span class="toc-text">8. 其他函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%9C%E4%B8%9A-2"><span class="toc-number">7.9.</span> <span class="toc-text">作业</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0"><span class="toc-number">8.</span> <span class="toc-text">8. 聚合函数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0%E4%BB%8B%E7%BB%8D"><span class="toc-number">8.1.</span> <span class="toc-text">聚合函数介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#AVG-SUM"><span class="toc-number">8.1.1.</span> <span class="toc-text">AVG, SUM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MIN%E5%92%8CMAX%E5%87%BD%E6%95%B0"><span class="toc-number">8.1.2.</span> <span class="toc-text">MIN和MAX函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#COUNT%E5%87%BD%E6%95%B0"><span class="toc-number">8.1.3.</span> <span class="toc-text">COUNT函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GROUP-BY"><span class="toc-number">8.2.</span> <span class="toc-text">GROUP BY</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">8.2.1.</span> <span class="toc-text">基本使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%A4%9A%E4%B8%AA%E5%88%97%E5%88%86%E7%BB%84"><span class="toc-number">8.2.2.</span> <span class="toc-text">使用多个列分组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GROUP-BY%E4%B8%AD%E4%BD%BF%E7%94%A8WITH-ROLLUP"><span class="toc-number">8.2.3.</span> <span class="toc-text">GROUP BY中使用WITH ROLLUP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HAVING%E8%AF%AD%E5%8F%A5"><span class="toc-number">8.3.</span> <span class="toc-text">HAVING语句</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8-1"><span class="toc-number">8.3.1.</span> <span class="toc-text">基本使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WHERE%E5%92%8CHAVING%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="toc-number">8.3.2.</span> <span class="toc-text">WHERE和HAVING的对比</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SELECT%E7%9A%84%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B"><span class="toc-number">8.4.</span> <span class="toc-text">SELECT的执行过程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E7%9A%84%E7%BB%93%E6%9E%84"><span class="toc-number">8.4.1.</span> <span class="toc-text">查询的结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SELECT-%E7%9A%84%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F"><span class="toc-number">8.4.2.</span> <span class="toc-text">SELECT 的执行顺序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL%E7%9A%84%E6%89%A7%E8%A1%8C%E5%8E%9F%E7%90%86"><span class="toc-number">8.4.3.</span> <span class="toc-text">SQL的执行原理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%9C%E4%B8%9A-3"><span class="toc-number">8.5.</span> <span class="toc-text">作业</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#9-%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">9.</span> <span class="toc-text">9. 子查询</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E4%B8%8E%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3"><span class="toc-number">9.1.</span> <span class="toc-text">需求分析与问题解决</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E9%97%AE%E9%A2%98"><span class="toc-number">9.1.1.</span> <span class="toc-text">实际问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%90%E6%9F%A5%E8%AF%A2%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">9.1.2.</span> <span class="toc-text">子查询的基本使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%90%E6%9F%A5%E8%AF%A2%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-number">9.1.3.</span> <span class="toc-text">子查询的分类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%95%E8%A1%8C%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">9.2.</span> <span class="toc-text">单行子查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#HAVING-%E4%B8%AD%E7%9A%84%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">9.2.1.</span> <span class="toc-text">HAVING 中的子查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CASE%E4%B8%AD%E7%9A%84%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">9.2.2.</span> <span class="toc-text">CASE中的子查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%90%E6%9F%A5%E8%AF%A2%E4%B8%AD%E7%9A%84%E7%A9%BA%E5%80%BC%E9%97%AE%E9%A2%98"><span class="toc-number">9.2.3.</span> <span class="toc-text">子查询中的空值问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%9E%E6%B3%95%E4%BD%BF%E7%94%A8%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">9.2.4.</span> <span class="toc-text">非法使用子查询</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E8%A1%8C%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">9.3.</span> <span class="toc-text">多行子查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E8%A1%8C%E6%AF%94%E8%BE%83%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-number">9.3.1.</span> <span class="toc-text">多行比较操作符</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%AD%90%E6%9F%A5%E8%AF%A2%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B"><span class="toc-number">9.4.</span> <span class="toc-text">相关子查询执行流程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#EXISTS-%E4%B8%8E-NOT-EXISTS%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">9.4.1.</span> <span class="toc-text">EXISTS 与 NOT EXISTS关键字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E6%9B%B4%E6%96%B0"><span class="toc-number">9.4.2.</span> <span class="toc-text">相关更新</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%88%A0%E9%99%A4"><span class="toc-number">9.4.3.</span> <span class="toc-text">相关删除</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%9D%E8%80%83%E9%A2%98"><span class="toc-number">9.5.</span> <span class="toc-text">思考题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%9C%E4%B8%9A-4"><span class="toc-number">9.6.</span> <span class="toc-text">作业</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%92%8C%E7%AE%A1%E7%90%86%E8%A1%A8"><span class="toc-number">10.</span> <span class="toc-text">创建和管理表</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-number">10.1.</span> <span class="toc-text">基础知识</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E6%9D%A1%E6%95%B0%E6%8D%AE%E7%9A%84%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">10.1.1.</span> <span class="toc-text">一条数据的存储过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%87%E8%AF%86%E7%AC%A6%E5%91%BD%E5%90%8D%E8%A7%84%E5%88%99"><span class="toc-number">10.1.2.</span> <span class="toc-text">标识符命名规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">10.1.3.</span> <span class="toc-text">数据类型</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%92%8C%E7%AE%A1%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">10.2.</span> <span class="toc-text">创建和管理数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">10.2.1.</span> <span class="toc-text">创建数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">10.2.2.</span> <span class="toc-text">使用数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">10.2.3.</span> <span class="toc-text">修改数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">10.2.4.</span> <span class="toc-text">删除数据库</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%A1%A8"><span class="toc-number">10.3.</span> <span class="toc-text">创建表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%96%B9%E5%BC%8F"><span class="toc-number">10.3.1.</span> <span class="toc-text">创建方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%96%B9%E5%BC%8F2"><span class="toc-number">10.3.2.</span> <span class="toc-text">创建方式2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%95%B0%E6%8D%AE%E8%A1%A8%E7%BB%93%E6%9E%84"><span class="toc-number">10.3.3.</span> <span class="toc-text">查看数据表结构</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E8%A1%A8"><span class="toc-number">10.4.</span> <span class="toc-text">修改表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%BD%E5%8A%A0%E4%B8%80%E4%B8%AA%E5%88%97"><span class="toc-number">10.4.1.</span> <span class="toc-text">追加一个列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E4%B8%80%E4%B8%AA%E5%88%97"><span class="toc-number">10.4.2.</span> <span class="toc-text">修改一个列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E5%91%BD%E5%90%8D%E4%B8%80%E4%B8%AA%E5%88%97"><span class="toc-number">10.4.3.</span> <span class="toc-text">重命名一个列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E4%B8%80%E4%B8%AA%E5%88%97"><span class="toc-number">10.4.4.</span> <span class="toc-text">删除一个列</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%87%8D%E5%91%BD%E5%90%8D%E8%A1%A8"><span class="toc-number">10.5.</span> <span class="toc-text">重命名表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%A1%A8"><span class="toc-number">10.6.</span> <span class="toc-text">删除表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B8%85%E7%A9%BA%E8%A1%A8"><span class="toc-number">10.7.</span> <span class="toc-text">清空表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E5%AE%B9%E6%8B%93%E5%B1%95"><span class="toc-number">10.8.</span> <span class="toc-text">内容拓展</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E5%8F%91%E6%89%8B%E5%86%8C%E4%B9%8BMySQL%E5%AD%97%E6%AE%B5%E5%91%BD%E5%90%8D"><span class="toc-number">10.8.1.</span> <span class="toc-text">阿里巴巴开发手册之MySQL字段命名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3%E6%B8%85%E7%A9%BA%E8%A1%A8-%E5%88%A0%E9%99%A4%E8%A1%A8%E7%AD%89%E6%93%8D%E4%BD%9C%E9%9C%80%E8%B0%A8%E6%85%8E"><span class="toc-number">10.8.2.</span> <span class="toc-text">如何理解清空表, 删除表等操作需谨慎</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MySQL8%E6%96%B0%E7%89%B9%E6%80%A7-DDL%E5%8E%9F%E5%AD%90%E5%8C%96"><span class="toc-number">10.8.3.</span> <span class="toc-text">MySQL8新特性-DDL原子化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%9C%E4%B8%9A-5"><span class="toc-number">10.9.</span> <span class="toc-text">作业</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E4%B9%8B%E5%A2%9E%E5%88%A0%E6%94%B9"><span class="toc-number">11.</span> <span class="toc-text">数据处理之增删改</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE"><span class="toc-number">11.1.</span> <span class="toc-text">插入数据</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F1-VALUES%E7%9A%84%E6%96%B9%E5%BC%8F%E5%A2%9E%E5%8A%A0%E6%95%B0%E6%8D%AE"><span class="toc-number">11.1.1.</span> <span class="toc-text">方式1: VALUES的方式增加数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F2-%E5%B0%86%E6%9F%A5%E8%AF%A2%E7%BB%93%E6%9E%9C%E6%8F%92%E5%85%A5%E5%88%B0%E8%A1%A8%E4%B8%AD"><span class="toc-number">11.1.2.</span> <span class="toc-text">方式2: 将查询结果插入到表中</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE-%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE"><span class="toc-number">11.2.</span> <span class="toc-text">更新数据 (修改数据)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE"><span class="toc-number">11.3.</span> <span class="toc-text">删除数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E5%88%97"><span class="toc-number">11.4.</span> <span class="toc-text">计算列</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%9C%E4%B8%9A-6"><span class="toc-number">11.5.</span> <span class="toc-text">作业</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MySQL%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E7%B2%BE%E8%AE%B2"><span class="toc-number">12.</span> <span class="toc-text">MySQL数据类型精讲</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B4%E5%9E%8B"><span class="toc-number">12.1.</span> <span class="toc-text">整型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E9%80%89%E5%B1%9E%E6%80%A7"><span class="toc-number">12.1.1.</span> <span class="toc-text">可选属性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#M"><span class="toc-number">12.1.1.1.</span> <span class="toc-text">M</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UNSIGNED"><span class="toc-number">12.1.1.2.</span> <span class="toc-text">UNSIGNED</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ZEROFILL"><span class="toc-number">12.1.1.3.</span> <span class="toc-text">ZEROFILL</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%84%E4%B8%AA%E7%B1%BB%E5%9E%8B%E7%9A%84%E6%95%B4%E5%9E%8B%E7%9A%84%E9%80%82%E7%94%A8%E5%9C%BA%E6%89%80%E5%92%8C%E5%AD%97%E8%8A%82%E6%95%B0"><span class="toc-number">12.1.2.</span> <span class="toc-text">各个类型的整型的适用场所和字节数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%AE%E7%82%B9%E7%B1%BB%E5%9E%8B"><span class="toc-number">12.2.</span> <span class="toc-text">浮点类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#M-D%E5%B1%9E%E6%80%A7"><span class="toc-number">12.2.1.</span> <span class="toc-text">M, D属性</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E7%82%B9%E6%95%B0"><span class="toc-number">12.3.</span> <span class="toc-text">定点数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%82%E7%94%A8%E8%8C%83%E5%9B%B4%E7%9A%84%E8%AE%A8%E8%AE%BA"><span class="toc-number">12.3.1.</span> <span class="toc-text">适用范围的讨论</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%8D%E7%B1%BB%E5%9E%8B"><span class="toc-number">12.4.</span> <span class="toc-text">位类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F%E4%B8%8E%E6%97%B6%E9%97%B4%E7%B1%BB%E5%9E%8B"><span class="toc-number">12.5.</span> <span class="toc-text">日期与时间类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link"><span class="toc-number">12.5.0.1.</span> <span class="toc-text"></span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#YEAR"><span class="toc-number">12.5.1.</span> <span class="toc-text">YEAR</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DATE%E7%B1%BB%E5%9E%8B"><span class="toc-number">12.5.2.</span> <span class="toc-text">DATE类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TIME%E7%B1%BB%E5%9E%8B"><span class="toc-number">12.5.3.</span> <span class="toc-text">TIME类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8F%92%E5%85%A5%E6%A0%BC%E5%BC%8F"><span class="toc-number">12.5.3.1.</span> <span class="toc-text">插入格式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DATETIME"><span class="toc-number">12.5.4.</span> <span class="toc-text">DATETIME</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E7%9A%84%E6%A0%BC%E5%BC%8F%E6%9D%A1%E4%BB%B6"><span class="toc-number">12.5.4.1.</span> <span class="toc-text">存储的格式条件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TIMESTAMP%E7%B1%BB%E5%9E%8B"><span class="toc-number">12.6.</span> <span class="toc-text">TIMESTAMP类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E4%B8%AD%E7%BB%8F%E9%AA%8C"><span class="toc-number">12.6.1.</span> <span class="toc-text">开发中经验</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E6%9C%AC%E5%AD%97%E7%AC%A6%E7%B1%BB%E5%9E%8B"><span class="toc-number">12.7.</span> <span class="toc-text">文本字符类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CHAR-%E5%92%8C-VARCHAR"><span class="toc-number">12.7.1.</span> <span class="toc-text">CHAR 和 VARCHAR</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%82%A3%E7%A7%8D%E6%83%85%E5%86%B5%E4%BD%BF%E7%94%A8CHAR-%E6%88%96-VARCHAR-%E6%9B%B4%E5%A5%BD"><span class="toc-number">12.7.1.1.</span> <span class="toc-text">那种情况使用CHAR 或 VARCHAR 更好</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TEXT%E7%B1%BB%E5%9E%8B"><span class="toc-number">12.7.2.</span> <span class="toc-text">TEXT类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E4%B8%AD%E7%9A%84%E7%BB%8F%E9%AA%8C"><span class="toc-number">12.7.2.1.</span> <span class="toc-text">开发中的经验</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ENUM%E7%B1%BB%E5%9E%8B"><span class="toc-number">12.8.</span> <span class="toc-text">ENUM类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SET%E7%B1%BB%E5%9E%8B"><span class="toc-number">12.9.</span> <span class="toc-text">SET类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%B1%BB%E5%9E%8B"><span class="toc-number">12.10.</span> <span class="toc-text">二进制字符串类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#BINARY%E4%B8%8EVARBINARY%E7%B1%BB%E5%9E%8B"><span class="toc-number">12.10.1.</span> <span class="toc-text">BINARY与VARBINARY类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#BLOB%E7%B1%BB%E5%9E%8B"><span class="toc-number">12.10.1.1.</span> <span class="toc-text">BLOB类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#TEXT%E5%92%8CBLOB%E7%9A%84%E4%BD%BF%E7%94%A8%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">12.10.1.2.</span> <span class="toc-text">TEXT和BLOB的使用注意事项</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JSON%E7%B1%BB%E5%9E%8B"><span class="toc-number">12.11.</span> <span class="toc-text">JSON类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A9%BA%E9%97%B4%E7%B1%BB%E5%9E%8B"><span class="toc-number">12.12.</span> <span class="toc-text">空间类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93%E5%8F%8A%E9%80%89%E6%8B%A9%E5%BB%BA%E8%AE%AE"><span class="toc-number">12.13.</span> <span class="toc-text">小结及选择建议</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#13-%E7%BA%A6%E6%9D%9F"><span class="toc-number">13.</span> <span class="toc-text">13. 约束</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%A6%E6%9D%9F%E6%A6%82%E8%BF%B0"><span class="toc-number">13.1.</span> <span class="toc-text">约束概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E7%BA%A6%E6%9D%9F"><span class="toc-number">13.1.1.</span> <span class="toc-text">为什么需要约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%A6%E6%9D%9F%E7%9A%84%E5%88%9B%E5%BB%BA%E6%97%B6%E6%9C%BA"><span class="toc-number">13.1.2.</span> <span class="toc-text">约束的创建时机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%A6%E6%9D%9F%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-number">13.1.3.</span> <span class="toc-text">约束的分类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%9E%E7%A9%BA%E7%BA%A6%E6%9D%9F-NOT-NULL"><span class="toc-number">13.2.</span> <span class="toc-text">非空约束 NOT NULL</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E9%9D%9E%E7%A9%BA%E7%BA%A6%E6%9D%9F"><span class="toc-number">13.2.0.1.</span> <span class="toc-text">添加非空约束</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E7%BA%A6%E6%9D%9F"><span class="toc-number">13.2.0.2.</span> <span class="toc-text">删除约束</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%94%AF%E4%B8%80%E6%80%A7%E7%BA%A6%E6%9D%9F-UNIQUE"><span class="toc-number">13.3.</span> <span class="toc-text">唯一性约束 UNIQUE</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E7%82%B9"><span class="toc-number">13.3.1.</span> <span class="toc-text">特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%8D%E5%90%88%E5%94%AF%E4%B8%80%E7%BA%A6%E6%9D%9F"><span class="toc-number">13.3.2.</span> <span class="toc-text">复合唯一约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E5%94%AF%E4%B8%80%E7%BA%A6%E6%9D%9F"><span class="toc-number">13.3.3.</span> <span class="toc-text">添加唯一约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%94%AF%E4%B8%80%E7%BA%A6%E6%9D%9F"><span class="toc-number">13.3.4.</span> <span class="toc-text">删除唯一约束</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BB%E9%94%AE%E7%BA%A6%E6%9D%9F-PRIMARY-KEY"><span class="toc-number">13.4.</span> <span class="toc-text">主键约束 PRIMARY KEY</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E7%82%B9-1"><span class="toc-number">13.4.1.</span> <span class="toc-text">特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E4%B8%BB%E9%94%AE%E7%BA%A6%E6%9D%9F"><span class="toc-number">13.4.2.</span> <span class="toc-text">创建主键约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E4%B8%BB%E9%94%AE"><span class="toc-number">13.4.3.</span> <span class="toc-text">添加主键</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E4%B8%BB%E9%94%AE%E7%BA%A6%E6%9D%9F"><span class="toc-number">13.4.4.</span> <span class="toc-text">删除主键约束</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%A2%9E-AUTO-INCREMENT"><span class="toc-number">13.5.</span> <span class="toc-text">自增 AUTO_INCREMENT</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E6%80%A7"><span class="toc-number">13.5.1.</span> <span class="toc-text">特性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%87%AA%E5%A2%9E%E9%95%BF%E7%BA%A6%E6%9D%9F"><span class="toc-number">13.5.2.</span> <span class="toc-text">创建自增长约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E8%87%AA%E5%A2%9E%E9%95%BF%E7%BA%A6%E6%9D%9F"><span class="toc-number">13.5.3.</span> <span class="toc-text">添加自增长约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%87%AA%E5%A2%9E%E9%95%BF%E7%BA%A6%E6%9D%9F"><span class="toc-number">13.5.4.</span> <span class="toc-text">删除自增长约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MySQL8%E6%96%B0%E7%89%B9%E6%80%A7-%E8%87%AA%E5%A2%9E%E9%95%BF%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">13.5.5.</span> <span class="toc-text">MySQL8新特性-自增长持久化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#FOREIGN-KEY-%E7%BA%A6%E6%9D%9F"><span class="toc-number">13.6.</span> <span class="toc-text">FOREIGN KEY 约束</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E7%82%B9-2"><span class="toc-number">13.6.1.</span> <span class="toc-text">特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%A4%96%E9%94%AE"><span class="toc-number">13.6.2.</span> <span class="toc-text">创建外键</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E5%A4%96%E9%94%AE"><span class="toc-number">13.6.3.</span> <span class="toc-text">添加外键</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%A4%96%E9%94%AE%E7%BA%A6%E6%9D%9F"><span class="toc-number">13.6.4.</span> <span class="toc-text">删除外键约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%A6%E6%9D%9F%E7%AD%89%E7%BA%A7"><span class="toc-number">13.6.5.</span> <span class="toc-text">约束等级</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E8%A7%84%E8%8C%83"><span class="toc-number">13.6.6.</span> <span class="toc-text">开发规范</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CHECK%E7%BA%A6%E6%9D%9F"><span class="toc-number">13.7.</span> <span class="toc-text">CHECK约束</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E7%82%B9-3"><span class="toc-number">13.7.1.</span> <span class="toc-text">特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-number">13.7.2.</span> <span class="toc-text">使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DEFAULT%E7%BA%A6%E6%9D%9F"><span class="toc-number">13.8.</span> <span class="toc-text">DEFAULT约束</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95"><span class="toc-number">13.9.</span> <span class="toc-text">面试</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#14-%E8%A7%86%E5%9B%BE"><span class="toc-number">14.</span> <span class="toc-text">14. 视图</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E7%9A%84%E6%84%8F%E4%B9%89"><span class="toc-number">14.1.</span> <span class="toc-text">视图的意义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%A7%86%E5%9B%BE"><span class="toc-number">14.2.</span> <span class="toc-text">创建视图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E8%A7%86%E5%9B%BE"><span class="toc-number">14.3.</span> <span class="toc-text">查看视图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E8%A7%86%E5%9B%BE%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE"><span class="toc-number">14.4.</span> <span class="toc-text">通过视图更新数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E8%A7%86%E5%9B%BE"><span class="toc-number">14.5.</span> <span class="toc-text">修改视图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%A7%86%E5%9B%BE"><span class="toc-number">14.6.</span> <span class="toc-text">删除视图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%9C%E4%B8%9A-7"><span class="toc-number">14.7.</span> <span class="toc-text">作业</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%A9%E4%B8%8B%E9%83%A8%E5%88%86%E6%9A%82%E4%B8%8D%E8%A7%82%E7%9C%8B-%E6%B2%A1%E4%BB%80%E4%B9%88%E7%94%A8-%E9%83%BD%E6%98%AF%E5%9C%A8%E5%BA%94%E7%94%A8%E5%B1%82%E5%AE%9E%E7%8E%B0%E7%9A%84%E5%86%85%E5%AE%B9"><span class="toc-number">14.7.1.</span> <span class="toc-text">剩下部分暂不观看, 没什么用, 都是在应用层实现的内容</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/08/Project/wrench/%E8%BF%87%E7%A8%8B%E7%AC%94%E8%AE%B0/3-%E5%8A%A8%E6%80%81%E9%99%90%E6%B5%81/" title="无标题">无标题</a><time datetime="2025-07-08T15:03:04.870Z" title="发表于 2025-07-08 23:03:04">2025-07-08</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/08/Project/wrench/%E8%BF%87%E7%A8%8B%E7%AC%94%E8%AE%B0/1-DCC/" title="无标题">无标题</a><time datetime="2025-07-08T15:03:04.868Z" title="发表于 2025-07-08 23:03:04">2025-07-08</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/08/Project/Big-Market/%E8%BF%87%E7%A8%8B%E7%AC%94%E8%AE%B0/%E6%9C%AA%E7%90%86%E8%A7%A3%E7%9A%84%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/" title="无标题">无标题</a><time datetime="2025-07-08T15:03:04.857Z" title="发表于 2025-07-08 23:03:04">2025-07-08</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/08/Project/Big-Market/%E8%BF%87%E7%A8%8B%E7%AC%94%E8%AE%B0/deployment/" title="无标题">无标题</a><time datetime="2025-07-08T15:03:04.856Z" title="发表于 2025-07-08 23:03:04">2025-07-08</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/08/Project/Big-Market/%E8%BF%87%E7%A8%8B%E7%AC%94%E8%AE%B0/9.%20%E4%BD%BF%E7%94%A8%E8%B4%A3%E4%BB%BB%E9%93%BE%E5%A4%84%E7%90%86%E6%8A%BD%E5%A5%96%E8%A7%84%E5%88%99/" title="无标题">无标题</a><time datetime="2025-07-08T15:03:04.855Z" title="发表于 2025-07-08 23:03:04">2025-07-08</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;2025 By Fun</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.4.1</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>