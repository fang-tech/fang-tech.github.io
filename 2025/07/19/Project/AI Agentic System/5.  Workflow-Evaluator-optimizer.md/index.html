<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>工作流-Evaluator-optimizer | Function's Blog</title><meta name="author" content="Function"><meta name="copyright" content="Function"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="工作流-评估优化器流程说明在评估-优化器中, 一个LLM调用生成响应, 另一个在循环中提供评估和反馈  用户输入task LLM生成第一轮的回复 对LLM的回复生成评估 检查评估的结果是不是PASS, 如果是, 直接返回最终结果   将所有的历史memory都添加到上下文中, 以及将回复评估添加到上下文中 进行下一次循环  代码 loop  1234567891011121314151617181">
<meta property="og:type" content="article">
<meta property="og:title" content="工作流-Evaluator-optimizer">
<meta property="og:url" content="https://fang-tech.github.io/2025/07/19/Project/AI%20Agentic%20System/5.%20%20Workflow-Evaluator-optimizer.md/index.html">
<meta property="og:site_name" content="Function&#39;s Blog">
<meta property="og:description" content="工作流-评估优化器流程说明在评估-优化器中, 一个LLM调用生成响应, 另一个在循环中提供评估和反馈  用户输入task LLM生成第一轮的回复 对LLM的回复生成评估 检查评估的结果是不是PASS, 如果是, 直接返回最终结果   将所有的历史memory都添加到上下文中, 以及将回复评估添加到上下文中 进行下一次循环  代码 loop  1234567891011121314151617181">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/fang-tech/Pic/img/202507101117002.jpg">
<meta property="article:published_time" content="2025-07-18T16:46:58.786Z">
<meta property="article:modified_time" content="2025-07-18T17:08:12.029Z">
<meta property="article:author" content="Function">
<meta property="article:tag" content="Project">
<meta property="article:tag" content="AI Agentic System">
<meta property="article:tag" content="Workflow">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/fang-tech/Pic/img/202507101117002.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "工作流-Evaluator-optimizer",
  "url": "https://fang-tech.github.io/2025/07/19/Project/AI%20Agentic%20System/5.%20%20Workflow-Evaluator-optimizer.md/",
  "image": "https://cdn.jsdelivr.net/gh/fang-tech/Pic/img/202507101117002.jpg",
  "datePublished": "2025-07-18T16:46:58.786Z",
  "dateModified": "2025-07-18T17:08:12.029Z",
  "author": [
    {
      "@type": "Person",
      "name": "Function",
      "url": "https://fang-tech.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/fang-tech/Pic/img/202507101117002.jpg"><link rel="canonical" href="https://fang-tech.github.io/2025/07/19/Project/AI%20Agentic%20System/5.%20%20Workflow-Evaluator-optimizer.md/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const mediaQueryDark = window.matchMedia('(prefers-color-scheme: dark)')
          const mediaQueryLight = window.matchMedia('(prefers-color-scheme: light)')

          if (theme === undefined) {
            if (mediaQueryLight.matches) activateLightMode()
            else if (mediaQueryDark.matches) activateDarkMode()
            else {
              const hour = new Date().getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            mediaQueryDark.addEventListener('change', () => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else {
            theme === 'light' ? activateLightMode() : activateDarkMode()
          }
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.json","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '工作流-Evaluator-optimizer',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://cdn.jsdelivr.net/gh/fang-tech/Pic/img/202507101117002.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">18</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">20</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">24</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/categories/Interview/"><i class="fa-fw fa-solid fa-clipboard-question"></i><span> Interview</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-folder"></i><span> Project</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/Project/AI-Agentic-System/"><i class="fa-fw fa-solid fa-robot"></i><span> AI Agentic System</span></a></li><li><a class="site-page child" href="/categories/Project/Lottery/"><i class="fa-fw fa-solid fa-ticket"></i><span> Lottery</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-gear"></i><span> Middleware</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/Middleware/MySQL/"><i class="fa-fw fa-solid fa-database"></i><span> MySQL</span></a></li><li><a class="site-page child" href="/categories/Middleware/Redis/"><i class="fa-fw fa-solid fa-memory"></i><span> Redis</span></a></li><li><a class="site-page child" href="/categories/Middleware/MQ/"><i class="fa-fw fa-solid fa-comments"></i><span> MQ</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-j"></i><span> Java</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/Java/JUC/"><i class="fa-fw fa-brands fa-threads"></i><span> JUC</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-leaf"></i><span> Spring</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/Spring/Spring-AI/"><i class="fa-fw fa-solid fa-brain"></i><span> Spring AI</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-code"></i><span> Algorithm</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/Computer-Fundamentals/Algorithm/Binary-Sort/"><i class="fa-fw fas fa-code"></i><span> Binary Sort</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://cdn.jsdelivr.net/gh/fang-tech/Pic/img/202507101117129.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Function's Blog</span></a><a class="nav-page-title" href="/"><span class="site-name">工作流-Evaluator-optimizer</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/categories/Interview/"><i class="fa-fw fa-solid fa-clipboard-question"></i><span> Interview</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-folder"></i><span> Project</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/Project/AI-Agentic-System/"><i class="fa-fw fa-solid fa-robot"></i><span> AI Agentic System</span></a></li><li><a class="site-page child" href="/categories/Project/Lottery/"><i class="fa-fw fa-solid fa-ticket"></i><span> Lottery</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-gear"></i><span> Middleware</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/Middleware/MySQL/"><i class="fa-fw fa-solid fa-database"></i><span> MySQL</span></a></li><li><a class="site-page child" href="/categories/Middleware/Redis/"><i class="fa-fw fa-solid fa-memory"></i><span> Redis</span></a></li><li><a class="site-page child" href="/categories/Middleware/MQ/"><i class="fa-fw fa-solid fa-comments"></i><span> MQ</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-j"></i><span> Java</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/Java/JUC/"><i class="fa-fw fa-brands fa-threads"></i><span> JUC</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-leaf"></i><span> Spring</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/Spring/Spring-AI/"><i class="fa-fw fa-solid fa-brain"></i><span> Spring AI</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-code"></i><span> Algorithm</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/Computer-Fundamentals/Algorithm/Binary-Sort/"><i class="fa-fw fas fa-code"></i><span> Binary Sort</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">工作流-Evaluator-optimizer</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-07-18T16:46:58.786Z" title="发表于 2025-07-19 00:46:58">2025-07-19</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-07-18T17:08:12.029Z" title="更新于 2025-07-19 01:08:12">2025-07-19</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Project/">Project</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Project/AI-Agentic-System/">AI Agentic System</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Project/AI-Agentic-System/Workflow/">Workflow</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">858</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>4分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="工作流-评估优化器"><a href="#工作流-评估优化器" class="headerlink" title="工作流-评估优化器"></a>工作流-评估优化器</h1><h2 id="流程说明"><a href="#流程说明" class="headerlink" title="流程说明"></a>流程说明</h2><p>在评估-优化器中, 一个LLM调用生成响应, 另一个在循环中提供评估和反馈</p>
<ol>
<li>用户输入task</li>
<li>LLM生成第一轮的回复</li>
<li>对LLM的回复生成评估<ol>
<li>检查评估的结果是不是PASS, 如果是, 直接返回最终结果</li>
</ol>
</li>
<li>将所有的历史memory都添加到上下文中, 以及将回复评估添加到上下文中</li>
<li>进行下一次循环</li>
</ol>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><blockquote>
<p>loop</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> RefinedResponse <span class="title function_">loop</span><span class="params">(String task, String context, List&lt;String&gt; memory,</span></span><br><span class="line"><span class="params">                             List&lt;Generation&gt; chainOfThought)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">Generation</span> <span class="variable">generation</span> <span class="operator">=</span> generate(task, context);</span><br><span class="line">    memory.add(generation.response());</span><br><span class="line">    chainOfThought.add(generation);</span><br><span class="line"></span><br><span class="line">    <span class="type">EvaluationResponse</span> <span class="variable">evaluationResponse</span> <span class="operator">=</span> evalute(generation.response(), task);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (evaluationResponse.evaluation().equals(EvaluationResponse.Evaluation.PASS)) &#123;</span><br><span class="line">        <span class="comment">// Solution is accepted!</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RefinedResponse</span>(generation.response(), chainOfThought);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Accumulated new context including the last and the previous attempts and</span></span><br><span class="line">    <span class="comment">// feedbacks.</span></span><br><span class="line">    <span class="type">StringBuilder</span> <span class="variable">newContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">    newContext.append(<span class="string">&quot;Previous attempts:&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (String m : memory) &#123;</span><br><span class="line">        newContext.append(<span class="string">&quot;\n- &quot;</span>).append(m);</span><br><span class="line">    &#125;</span><br><span class="line">    newContext.append(<span class="string">&quot;\nFeedback: &quot;</span>).append(evaluationResponse.feedback());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> loop(task, newContext.toString(), memory, chainOfThought);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>generate</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Generation <span class="title function_">generate</span><span class="params">(String task, String context)</span> &#123;</span><br><span class="line">    <span class="type">Generation</span> <span class="variable">generationResponse</span> <span class="operator">=</span> chatClient.prompt()</span><br><span class="line">        .user(u -&gt; u.text(<span class="string">&quot;&#123;prompt&#125;\n&#123;context&#125;\nTask: &#123;task&#125;&quot;</span>)</span><br><span class="line">              .param(<span class="string">&quot;prompt&quot;</span>, <span class="built_in">this</span>.generatorPrompt)</span><br><span class="line">              .param(<span class="string">&quot;context&quot;</span>, context)</span><br><span class="line">              .param(<span class="string">&quot;task&quot;</span>, task))</span><br><span class="line">        .call()</span><br><span class="line">        .entity(Generation.class);</span><br><span class="line"></span><br><span class="line">    System.out.println(String.format(<span class="string">&quot;\n=== GENERATOR OUTPUT ===\nTHOUGHTS: %s\n\nRESPONSE:\n %s\n&quot;</span>,</span><br><span class="line">                                     generationResponse.thoughts(), generationResponse.response()));</span><br><span class="line">    <span class="keyword">return</span> generationResponse;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>evalute</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> EvaluationResponse <span class="title function_">evalute</span><span class="params">(String content, String task)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">EvaluationResponse</span> <span class="variable">evaluationResponse</span> <span class="operator">=</span> chatClient.prompt()</span><br><span class="line">        .user(u -&gt; u.text(<span class="string">&quot;&#123;prompt&#125;\nOriginal task: &#123;task&#125;\nContent to evaluate: &#123;content&#125;&quot;</span>)</span><br><span class="line">              .param(<span class="string">&quot;prompt&quot;</span>, <span class="built_in">this</span>.evaluatorPrompt)</span><br><span class="line">              .param(<span class="string">&quot;task&quot;</span>, task)</span><br><span class="line">              .param(<span class="string">&quot;content&quot;</span>, content))</span><br><span class="line">        .call()</span><br><span class="line">        .entity(EvaluationResponse.class);</span><br><span class="line"></span><br><span class="line">    System.out.println(String.format(<span class="string">&quot;\n=== EVALUATOR OUTPUT ===\nEVALUATION: %s\n\nFEEDBACK: %s\n&quot;</span>,</span><br><span class="line">                                     evaluationResponse.evaluation(), evaluationResponse.feedback()));</span><br><span class="line">    <span class="keyword">return</span> evaluationResponse;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>Generator prompt</p>
</blockquote>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&quot;&quot;&quot;</span><br><span class="line">Your goal is to complete the task based on the input. If there are feedback</span><br><span class="line">from your previous generations, you should reflect on them to improve your solution.</span><br><span class="line"></span><br><span class="line">CRITICAL: Your response must be a SINGLE LINE of valid JSON with NO LINE BREAKS except those explicitly escaped with <span class="keyword">\\</span>n.</span><br><span class="line">Here is the exact format to follow, including all quotes and braces:</span><br><span class="line"></span><br><span class="line">&#123;&quot;thoughts&quot;:&quot;Brief description here&quot;,&quot;response&quot;:&quot;public class Example &#123;<span class="keyword">\\</span>n    // Code here<span class="keyword">\\</span>n&#125;&quot;&#125;</span><br><span class="line"></span><br><span class="line">Rules for the response field:</span><br><span class="line">1. ALL line breaks must use <span class="keyword">\\</span>n</span><br><span class="line">2. ALL quotes must use <span class="keyword">\\</span>&quot;</span><br><span class="line">3. ALL backslashes must be doubled: <span class="keyword">\\</span></span><br><span class="line">4. NO actual line breaks or formatting - everything on one line</span><br><span class="line">5. NO tabs or special characters</span><br><span class="line">6. Java code must be complete and properly escaped</span><br><span class="line"></span><br><span class="line">Example of properly formatted response:</span><br><span class="line">&#123;&quot;thoughts&quot;:&quot;Implementing counter&quot;,&quot;response&quot;:&quot;public class Counter &#123;<span class="keyword">\\</span>n    private int count;<span class="keyword">\\</span>n    public Counter() &#123;<span class="keyword">\\</span>n        count = 0;<span class="keyword">\\</span>n    &#125;<span class="keyword">\\</span>n    public void increment() &#123;<span class="keyword">\\</span>n        count++;<span class="keyword">\\</span>n    &#125;<span class="keyword">\\</span>n&#125;&quot;&#125;</span><br><span class="line"></span><br><span class="line">Follow this format EXACTLY - your response must be valid JSON on a single line.</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Evaluator prompt</p>
</blockquote>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&quot;&quot;&quot;</span><br><span class="line">Evaluate this code implementation for correctness, time complexity, and best practices.</span><br><span class="line">Ensure the code have proper javadoc documentation.</span><br><span class="line">Respond with EXACTLY this JSON format on a single line:</span><br><span class="line"></span><br><span class="line">&#123;&quot;evaluation&quot;:&quot;PASS, NEEDS<span class="built_in">_</span>IMPROVEMENT, or FAIL&quot;, &quot;feedback&quot;:&quot;Your feedback here&quot;&#125;</span><br><span class="line"></span><br><span class="line">The evaluation field must be one of: &quot;PASS&quot;, &quot;NEEDS<span class="built_in">_</span>IMPROVEMENT&quot;, &quot;FAIL&quot;</span><br><span class="line">Use &quot;PASS&quot; only if all criteria are met with no improvements needed.</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>

<h2 id="适用场景"><a href="#适用场景" class="headerlink" title="适用场景"></a>适用场景</h2><p>在有<strong>清晰的评估标准</strong>, 并且<strong>迭代改进提供可衡量的价值</strong>. 良好契合的两个标志是</p>
<ol>
<li>当人类清晰地表达反馈时, LLM的答案可以得到显著的改进</li>
<li>LLM能表达这种反馈</li>
</ol>
<blockquote>
<p>原文:</p>
<p><strong>When to use this workflow:</strong> This workflow is particularly effective when we have clear evaluation criteria, and when iterative refinement provides measurable value. The two signs of good fit are, first, that LLM responses can be demonstrably improved when a human articulates their feedback; and second, that the LLM can provide such feedback. This is analogous to the iterative writing process a human writer might go through when producing a polished document.</p>
</blockquote>
<ul>
<li>复杂的搜索任务需要多轮搜索和分析才能收集全面的信息, 评估人员是否需要进一步搜索</li>
<li>生成代码的自优化</li>
</ul>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Project/">Project</a><a class="post-meta__tags" href="/tags/AI-Agentic-System/">AI Agentic System</a><a class="post-meta__tags" href="/tags/Workflow/">Workflow</a></div><div class="post-share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/fang-tech/Pic/img/202507101117002.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/07/20/MiddleWare/MySQL/MySQL%20%E6%97%A5%E5%BF%97/" title="MySQL 日志"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">MySQL 日志</div></div><div class="info-2"><div class="info-item-1">MySQL日志 参考文章:  小林coding-MySQL 日志  执行一条update语句, 期间会发生什么 1UPDATE t_user SET name = &#x27;xiaolin&#x27; WHERE id = 1;  首先是前面和查询语句相似的流程  客户端先通过连接器建立连接, 连接器判断用户的身份 查询缓存, 但是因为这是一条update语句, 所以不会走查询缓存的步骤, 相反会将对应的表的缓存给清空 通过解析器分析update语句, 拿到update关键字, 表名等信息, 构建出来语法树, 做语法检查 通过预处理器判断表和字段是否存在 优化器确定执行计划, 这里因为是通过id作为where的条件, 会通过id这个主键执行查询 将执行计划交给存储引擎执行, 找到这一行, 然后执行更新   而日志就在最后的更新步骤出现了  undo log: Innodb引擎层生成的日志, 实现了事务的原子性, 主要实现了事务回滚和MVCC redo log: Innodb引擎层生成的日志, 实现了事务的持久性, 主要实现了crush-safe binlog: Server层生...</div></div></div></a><a class="pagination-related" href="/2025/07/18/Project/AI%20Agentic%20System/4.%20Workflow-Orchestrator-workers/" title="工作流-Orchestrator-workers"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">工作流-Orchestrator-workers</div></div><div class="info-2"><div class="info-item-1">工作流-编排器-工人工作流流程说明这个工作流可以看作是ParallelizationWorkflow的自动分配任务版本 中央LLM动态分解任务, 并将其委派给工作者LLM, 并综合结果  用户输入任务描述input 将用户的任务和编排器prompt输入给LLM用于划分任务 将划分后的任务集合和工人prompt输入给LLM用于执行划分后的任务 返回所有的执行结果  代码 执行代码, process  1234567891011121314151617181920public FinalResponse process(String taskDescription) &#123;    // 获取编排器的编排结果    OrchestratorResponse orchestratorResponse = this.chatClient.prompt()        .user(u -&gt; u.text(this.orchestratorPrompt))        			.param(&quot;task&quot;, taskDescription)        .ca...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/07/18/Project/AI%20Agentic%20System/1.%20Workflow-ChainWorkflow/" title="工作流-Chain Workflow"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-07-18</div><div class="info-item-2">工作流-Chain Workflow</div></div><div class="info-2"><div class="info-item-1">工作流-lian’shi 参考  https://www.anthropic.com/engineering/building-effective-agents   流程说明对于链式工作流, 整体的呈现效果就是用户输入userInput以后, 这个userInput在输入以后会链式的向下执行, 在每个节点携带上一个节点的回答和使用当前节点的prompt来和LLM对话  填充systemPrompts数组, 在这种情况下, Chain Workflow也被称作Prompts Chain工作流 遍历每个prompt 将上一轮的回答和现在的prompt组成一个新的input 对话获取response   输出最后的response   代码 代码  123456789101112131415public String chain(String userInput) &#123;    String response = usertInput;        for (String promt : systemPrompts) &#123;        String input = S...</div></div></div></a><a class="pagination-related" href="/2025/07/18/Project/AI%20Agentic%20System/2.%20Workflow-RoutingWorkflow/" title="工作流-Routing Workflow"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-07-18</div><div class="info-item-2">工作流-Routing Workflow</div></div><div class="info-2"><div class="info-item-1">工作流-路由工作流流程说明用户输入userInput和可行的路由Map&lt;String, Object&gt; String是对这个路由的简介, Object就是实际的路由内容 这里以角色分配, 将不同的任务分配给不同的promt角色的使用方式举例  用户输入初始的userInput和Map&lt;String, String&gt; 根据userInput和Map的keySet让LLM决策当前任务使用的prompt角色, 给出原因和选择, 使用结构化的输出到RoutingResponse中 使用对应的prompt角色, 输出最后的结果   代码 route方法  1234567891011121314public String route(String userInput, Map&lt;String, Object&gt; routes, String mode) &#123;    RoutingResponse routingResponse = determineRoute(input, routes.keySet);        Object select = ...</div></div></div></a><a class="pagination-related" href="/2025/07/18/Project/AI%20Agentic%20System/3.%20Workflow-ParallelizationWorkflow/" title="工作流-Parallelization Workflow"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-07-18</div><div class="info-item-2">工作流-Parallelization Workflow</div></div><div class="info-2"><div class="info-item-1">工作流-并行工作流流程说明 用户输入input数组对应需要并行执行一系列任务, 适用于所有的任务的prompt, 以及线程池的数量 将每个input并行化运行LLM 等待所有的运行完毕后返回  代码123456789101112131415161718192021222324public List&lt;String&gt; parallel(String prompt, List&lt;String&gt; inputs, int nWorks) &#123;    ExecutorService executor = Executors.newFixedThreadPool(nWorkers);        try &#123;        List&lt;CompletableFuture&lt;String&gt;&gt; futures = input.stream()            .map(input -&gt; CompletableFuture.supplyAsync(() 0&gt; &#123;                try&#123; ...</div></div></div></a><a class="pagination-related" href="/2025/07/18/Project/AI%20Agentic%20System/4.%20Workflow-Orchestrator-workers/" title="工作流-Orchestrator-workers"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-07-18</div><div class="info-item-2">工作流-Orchestrator-workers</div></div><div class="info-2"><div class="info-item-1">工作流-编排器-工人工作流流程说明这个工作流可以看作是ParallelizationWorkflow的自动分配任务版本 中央LLM动态分解任务, 并将其委派给工作者LLM, 并综合结果  用户输入任务描述input 将用户的任务和编排器prompt输入给LLM用于划分任务 将划分后的任务集合和工人prompt输入给LLM用于执行划分后的任务 返回所有的执行结果  代码 执行代码, process  1234567891011121314151617181920public FinalResponse process(String taskDescription) &#123;    // 获取编排器的编排结果    OrchestratorResponse orchestratorResponse = this.chatClient.prompt()        .user(u -&gt; u.text(this.orchestratorPrompt))        			.param(&quot;task&quot;, taskDescription)        .ca...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="giscus-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://cdn.jsdelivr.net/gh/fang-tech/Pic/img/202507101117002.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Function</div><div class="author-info-description">Function的个人博客</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">18</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">20</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">24</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/fang-tech"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E6%B5%81-%E8%AF%84%E4%BC%B0%E4%BC%98%E5%8C%96%E5%99%A8"><span class="toc-number">1.</span> <span class="toc-text">工作流-评估优化器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%81%E7%A8%8B%E8%AF%B4%E6%98%8E"><span class="toc-number">1.1.</span> <span class="toc-text">流程说明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81"><span class="toc-number">1.2.</span> <span class="toc-text">代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.3.</span> <span class="toc-text">适用场景</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/25/Computer%20Fundamentals/Operating%20System/IO-%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8/" title="操作系统I/O - 多路复用">操作系统I/O - 多路复用</a><time datetime="2025-07-25T15:16:26.000Z" title="发表于 2025-07-25 23:16:26">2025-07-25</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/25/Computer%20Fundamentals/Operating%20System/IO-%E9%9B%B6%E6%8B%B7%E8%B4%9D/" title="操作系统I/O - 零拷贝">操作系统I/O - 零拷贝</a><time datetime="2025-07-25T08:56:26.000Z" title="发表于 2025-07-25 16:56:26">2025-07-25</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/25/Architecture/%E6%9E%B6%E6%9E%84%E6%BC%94%E8%BF%9B%E6%A6%82%E8%BF%B0/" title="分布式架构-架构演进概述">分布式架构-架构演进概述</a><time datetime="2025-07-24T16:53:26.000Z" title="发表于 2025-07-25 00:53:26">2025-07-25</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/24/Java/JUC/%E7%BA%BF%E7%A8%8B%E6%B1%A0-ThreadPoolExecutor/" title="线程池-ThreadPoolExecutor类详解">线程池-ThreadPoolExecutor类详解</a><time datetime="2025-07-24T10:14:11.490Z" title="发表于 2025-07-24 18:14:11">2025-07-24</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/23/Java/JUC/%E5%8E%9F%E5%AD%90%E7%B1%BB-AtomicInteger/" title="原子类-AtomicInteger类详解">原子类-AtomicInteger类详解</a><time datetime="2025-07-23T07:42:35.281Z" title="发表于 2025-07-23 15:42:35">2025-07-23</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(https://cdn.jsdelivr.net/gh/fang-tech/Pic/img/202507101117129.jpg);"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;2025 By Function</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.4.2</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = {"lang":"zh-CN","input_position":"top","emit_metadata":1,"reactions_enabled":1}

  const getGiscusTheme = theme => theme === 'dark' ? 'dark' : 'light'

  const createScriptElement = config => {
    const ele = document.createElement('script')
    Object.entries(config).forEach(([key, value]) => {
      ele.setAttribute(key, value)
    })
    return ele
  }

  const loadGiscus = (el = document, key) => {
    const mappingConfig = isShuoshuo
      ? { 'data-mapping': 'specific', 'data-term': key }
      : { 'data-mapping': (option && option['data-mapping']) || 'pathname' }

    const giscusConfig = {
      src: 'https://giscus.app/client.js',
      'data-repo': 'fang-tech/fang-tech.github.io',
      'data-repo-id': 'R_kgDOPJD8XA',
      'data-category-id': 'DIC_kwDOPJD8XM4CswtE',
      'data-theme': getGiscusTheme(document.documentElement.getAttribute('data-theme')),
      'data-reactions-enabled': '1',
      crossorigin: 'anonymous',
      async: true,
      ...option,
      ...mappingConfig
    }

    const scriptElement = createScriptElement(giscusConfig)

    el.querySelector('#giscus-wrap').appendChild(scriptElement)

    if (isShuoshuo) {
      window.shuoshuoComment.destroyGiscus = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }
  }

  const changeGiscusTheme = theme => {
    const iframe = document.querySelector('#giscus-wrap iframe')
    if (iframe) {
      const message = {
        giscus: {
          setConfig: {
            theme: getGiscusTheme(theme)
          }
        }
      }
      iframe.contentWindow.postMessage(message, 'https://giscus.app')
    }
  }

  btf.addGlobalFn('themeChange', changeGiscusTheme, 'giscus')

  if (isShuoshuo) {
    'Giscus' === 'Giscus'
      ? window.shuoshuoComment = { loadComment: loadGiscus }
      : window.loadOtherComment = loadGiscus
    return
  }

  if ('Giscus' === 'Giscus' || !false) {
    if (false) btf.loadComment(document.getElementById('giscus-wrap'), loadGiscus)
    else loadGiscus()
  } else {
    window.loadOtherComment = loadGiscus
  }
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>